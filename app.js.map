{"version":3,"sources":["webpack:///./src/app.js","webpack:///./src/asset.js","webpack:///./src/side-frame.js","webpack:///./src/market-data.js","webpack:///./src/orderbook.js","webpack:///./src/balance.js","webpack:///./src/order.js","webpack:///./src/portfolio.js","webpack:///./src/anchor.js","webpack:///./src/offers.js","webpack:///./src/activity-gui.js","webpack:///./src/portfolio-gui.js","webpack:///./src/asset-gui.js","webpack:///./src/settings-gui.js","webpack:///./src/share-gui.js","webpack:///./src/share.js","webpack:///./src/strategy.js","webpack:///./src/footer.js"],"names":["dom","require","Form","Gui","html","Tabs","params","__","global","Portfolio","ActivityGui","PortfolioGui","SettingsGui","ShareGui","license","welcome","tabs","nav","grab","view","main","add","loginForm","select","location","hash","selected","ledger","addValidator","login","_callee","_regeneratorRuntime","wrap","_context","prev","next","Promise","all","__webpack_require__","e","then","t","bind","default","sent","setInfo","connect","loginAddressBox","value","publicKey","t0","console","error","setError","stop","this","_callee2","address","_args2","arguments","_context2","length","undefined","Error","disconnect","$set","resolve","portfolio","listen","initGui","remove","replace","href","show","autocomplete","ledgerLoginButton","onclick","loginWithLedgerWallet","page","window","scrollTo","FIAT_BASEURL","FIAT_IMAGEFORMAT","Mirrorable","Projectable","marketData","Orderbook","Asset","module","exports","_Projectable","id","_this","_classCallCheck","_getPrototypeOf","call","table","_assertThisInitialized","image","info","code","Object","assign","type","fiats","push","concat","toLowerCase","cryptos","name","anchors","balances","offers","shares","mirror","balance","anchor","trap","compute","orderbook","forAsset","define","globalPrice","price","_inherits","_createClass","key","_getInfo","_asyncToGenerator","mark","abrupt","crypto","small","apply","addChild","reduce","sum","el","amount","rawLiabilities","entry","buying","selling","refreshPrices","_ref","array","refreshCryptoPrices","refreshFiatPrices","filter","asset","map","_x","_callee3","assets","prices","_args3","_context3","forEach","_callee4","_args4","_context4","fiat","USD","EUR","CNY","BTC","ETH","XRP","XLM","KIN","BAT","ZRX","BCH","STEEM","SBD","LINK","SLT","MOBI","SHX","RMT","TERN","PEDI","GRAT","REPO","currency","setInterval","log","SideFrame","url","current","close","domNode","create","title","src","sandbox","hidden","style","append","document","body","htmlOverflow","documentElement","overflow","bodyOverflow","shadow","hide","destroy","addEventListener","event","frameWindow","contentWindow","source","data","position","zIndex","right","top","width","maxWidth","height","border","background","backgroundImage","backgroundRepeat","backgroundPosition","padding","insertBefore","firstChild","axios","nice","day","coingeckoCall","get","exchangeratesCall","_callee8","symbols","_args8","_context8","base","x","join","response","start_at","rates","cacheHistory","localStorage","JSON","stringify","cachedHistory","json","parse","assetHistory","limit","history","list","symbol","toUpperCase","stellarNative","tickers","coin_id","_ref3","localization","market_data","community_data","developer_data","sparkline","_ref4","ids","quote","vs_currencies","assetData","_x2","_ref5","_callee5","_args5","_context5","vs_currency","days","record","index","time","volume","total_volumes","_x3","_ref6","_callee6","_context6","_x6","_ref7","_callee7","cached","end_at","today","_args7","_context7","Date","toISOString","slice","setDate","getDate","keys","sort","date","getTime","_x7","cosmicLib","StellarSdk","_possibleConstructorReturn","updateOffersPrices","childs","addOrderbook","baseAsset","quoteAsset","native","callBuilder","server","streamOptions","onmessage","ingest","stream","areOffersEquals","bids","normalizeOffers","asks","set","merged","arr","sortOffers","a","b","cumul","row","mergedRow","_this2","mergeOffers","array1","array2","side","baseAmount","basePrice","bestBid","bestAsk","spread","prototype","findOffer","last","childsNum","offer","findAsk","findBid","Anchor","Balance","entryId","asset_code","asset_issuer","known","buying_liabilities","selling_liabilities","project","forBalance","issuer","CosmicLink","Order","method","algorithm","operations","_len","parameters","Array","_key","refresh","share","order","rebalancingStrategy","splice","trigger","_toConsumableArray","make","operation","find","newOperation","getOperation","setOperation","Number","cost","operationDirection","op","minMax","min","max","Math","tightenSpread","percentage","clone","diff","refPrice","floorPrice","significant","price_r","n","d","operationsToCosmicLink","operationsToDescription","cosmicLink","memo","accountId","addOperation","odesc","abs","toFixed","offerId","operationToOdesc","desc","liabilities","outdated","description","target","tmp1","ask","sellAmount","bid","buyAmount","size","_len2","_key2","_construct","_loop","Offers","testNetwork","horizon","isSupported","new","_resolve","destination","config","isAccountEmpty","account_id","accounts","account","_ingest","indexOf","getInfo","t1","done","delegateYield","forPortfolio","total","aliases","helpers","alias","shorter","USD:GDUKMGUGDZQK6YHYA5Z6AY2G4XDSZPSZ3SW5UN3ARVMO6QSRDWP5YLEX","WSD:GDSVWEA7XV6M5XNLODVTPCGMAJTNBLZBXOFNQD3BNPNYALEYBNT6CE2V","USD:GDSRCV5VTM3U7Y3L6DFRP3PEGBNQMGOWSRTGSBWX6Z3H6C7JHRI4XFJP","USD:GBUYUAI75XXWDZEKLY66CFYKQPET5JR4EENXZBUZ3YXZ7DS56Z4OKOFU","USD:GBSTRUSD7IRX73RQZBL3RQUH6KS3O4NYFY3QCALDLZD77XMZOPWAVTUK","CNY:GAREELUB43IRHWEASCFBLKHURCGMHE5IF6XSE7EXDLACYHGRHM43RFOX","XCN:GCNY5OXYSY4FKHOPT2SPOQZAOEIGXB5LBYW3HVU3OWSTQITS65M5RCNY","BCNY:GBCNYBHAAPDSU3UIHXXQTHYZVSBJBI4YUNWXMKJBCPDHTVYR75G6NFHD","EURT:GAP5LETOV6YIE62YAM56STDANPRDO7ZFDBGSNHJQIYGGKSMOZAHOOS2S","SLT:GCKA6K5PCQ6PNF5RQBF7PQDJWRHO6UOGFMRLK3DYHDOI244V47XKQ4GP","MOBI:GA6HCMBLTZS5VYYBCATRBRZ3BZJMAFUDKYYF6AH6MVCMGWMRDNSWJPIH","SHX:GDSTRSHXHGJ7ZIVRBXEYE5Q74XUVCUSEKEBR7UCHEUUEK72N7I7KJ6JH","RMT:GDEGOXPCHXWFYY234D2YZSPEJ24BX42ESJNVHY5H7TWWQSYRN5ZKZE3N","TERN:GDGQDVO6XPFSY4NMX75A7AOVYCF5JYGW2SHCJJNWCQWIDGOZB53DGP6C","PEDI:GBVUDZLMHTLMZANLZB6P4S4RYF52MVWTYVYXTQ2EJBPBX4DZI2SDOLLY","GRAT:GAJ7V3EMD3FRWAPBEJAP7EC4223XI5EACDZ46RFMY5DYOMCIMWEFR5II","REPO:GCZNF24HPMYTV6NOEHI7Q5RJFFUI23JKUKY3H3XTQAFBQIBOHD5OXG3B","BTC:GBSTRH4QOTWNSVA6E4HFERETX4ZLSR3CIUBLK7AXYII277PFJC4BBYOG","BTC:GATEMHCCKCY67ZUCKTROYN24ZYT5GK4EQZ65JJLDHKHRUZI3EUEKMTCH","BTC:GAUTUYY2THLF7SGITDFMXJVYH3LHDSMGEAKSBU267M2K7A3W543CKUEF","BTC:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P","BTC:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5","ETH:GBSTRH4QOTWNSVA6E4HFERETX4ZLSR3CIUBLK7AXYII277PFJC4BBYOG","ETH:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P","ETH:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5","ETH:GBETHKBL5TCUTQ3JPDIYOZ5RDARTMHMEKIO2QZQ7IOZ4YC5XV3C2IKYU","ETH:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","LTC:GC5LOR3BK6KIOK7GKAUD5EGHQCMFOGHJTC7I3ELB66PTDFXORC2VM5LP","LTC:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5","LTC:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P","XRP:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5","XRP:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P","KIN:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","BAT:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","ZRX:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","BCH:GAEGOS7I6TYZSVHPSN76RSPIVL3SELATXZWLFO4DIAFYJF7MPAHFE7H4","STEEM:GB3KBOFUCVTWEZ7YIZ7PAKLQMKPCTGWU3LOMANMCT7V6I3AAK4USTEEM","SBD:GB3KBOFUCVTWEZ7YIZ7PAKLQMKPCTGWU3LOMANMCT7V6I3AAK4USTEEM","LINK:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","loopcall","Offer","intern","recordToId","rawPrice","update","opened","records","rawAmount","last_modified_time","assetToId","_Gui2","ActivityOffers","globalCurrency","network","uri","_Gui3","ActivityOffer","_this3","toLocaleDateString","number","Orders","_Gui4","ActivityOrders","_this4","Transfers","_Gui5","ActivityTransfers","_this5","Highcharts","AssetGui","summary","Summary","coingecko","chart","Chart","makeAssetPoint","assetPoint","y","niceAmount","nicePrice","PortfolioSummary","parent","Table","Graph","PortfolioTable","assetsGui","assetGui","className","simpleView","detailledView","PortfolioGraph","setTimeout","makePie","container","backgroundColor","colors","tooltip","fontSize","pointFormat","plotOptions","pie","allowPointSelect","animation","cursor","dataLabels","enabled","format","point","events","options","series","colorByPoint","ignoreHiddenPoint","credits","PortfolioChart","_this6","makeChart","stockChart","rangeSelector","yAxis","labels","align","resize","offset","msg","cell","amounts","node","object","priceDetails","values","link","feed","anchorName","simple","class","anchorTotal","anchorHeader","func","reload","i18n","Share","RebalanceGui","template","errors","modified","hideRebalance","hideApply","setupGui","Setup","toString","child","listOperations","remaining","pop","RebalanceTable","sortShares","shareGui","goal","descriptionToList","ShareSetup","assetName","mode","switchMode","strategy","rebalance","fromString","isValid","findIndex","hasChanged","beautify","toTemplate","group","root","string","fromTemplate","delta","used","computed","strat","targets","space","makeTotal100","MYPUBKEY","Footer","icons","links","Icon","svg","donateIcon","prompt","isNaN","confirm","demoConfig","footer","displayDemo"],"mappings":"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","file":"app.js","sourcesContent":["\"use_strict\"\n/**\n * Login interface\n */\nconst dom = require(\"@cosmic-plus/jsutils/dom\")\nconst Form = require(\"@cosmic-plus/jsutils/form\")\nconst Gui = require(\"@cosmic-plus/jsutils/gui\")\nconst html = require(\"@cosmic-plus/jsutils/html\")\nconst Tabs = require(\"@cosmic-plus/jsutils/tabs\")\nconst params = require(\"@cosmic-plus/jsutils/params\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./global\")\nconst Portfolio = require(\"./portfolio\")\n\nconst ActivityGui = require(\"./activity-gui\")\nconst PortfolioGui = require(\"./portfolio-gui\")\nconst SettingsGui = require(\"./settings-gui\")\nconst ShareGui = require(\"./share-gui\")\n\nrequire(\"./footer\")\n\n/**\n * License\n */\n\nconst license = new Gui(`\n<section><h2>License</h2>\n  <section><h3>MIT Licence</h3>\n\n  <p>Copyright (c) 2019 Antoine Bodin &lt;<a\n  href=\"mailto:mister.ticot@cosmic.plus\">mister.ticot@cosmic.plus</a>&gt;</p>\n\n  <p>Permission is hereby granted, free of charge, to any person obtaining a\n  copy of this software and associated documentation files (the \"Software\"), to\n  deal in the Software without restriction, including without limitation the\n  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n  sell copies of the Software, and to permit persons to whom the Software is\n  furnished to do so, subject to the following conditions:</p>\n\n  <p>The above copyright notice and this permission notice shall be included in\n  all copies or substantial portions of the Software.</p>\n\n  <p>THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\n  FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n  COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\n  IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\n  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>\n`)\n\n/**\n * Beta 1 Welcome\n */\n\nconst welcome = new Gui(`\n<section><h2>February, 16th − Beta 1 Release</h2>\n  <section><h3>Welcome!</h3>\n\n    <p>Equilibre.io is a portfolio balancer for the Stellar Decentralized\n    EXchange. Define how you want to split your portfolio, and it will help you\n    maintaining the balance. (i.e.: 1/4 Bitcoin, 1/4 Lumens, 1/4 US Dollars, 1/4\n    Renmibi)</p>\n\n    <p>Regularly balancing an investment portfolio is known to boost its\n    performances, providing you choose wisely the assets to bet on. Equilibre.io\n    also let you spread your position over several anchors, for a better fund\n    safety.</p>\n\n    <p>Equilibre.io is still under testing & development. If you use it now,\n    I'll ask you to consider yourself as a tester. Please report any bug you\n    could encounter, and double-check transactions before signing them.</p>\n\n    <p>Your feedback matters to me and will be listened to.</p>\n\n    <p>Respectfully, <br>MisterTicot</p>\n\n  </section>\n\n  <section><h3>To Be Implemented</h3>\n    <ul>\n      <li>Small screen interface</li>\n      <li>Interface to add/remove assets</li>\n      <li>Portfolio historic value</li>\n      <li>Customizable rebalancing periodicity</li>\n      <li>Better position spreading over anchors</li>\n      <li>Pie graph for rebalancing tab</li>\n    </ul>\n  </section>\n\n  <section><h3>Known Limitations</h3>\n    <ul>\n\n      <li>It is required to \"Cancel All\" offers between applying a new balance\n      setup</li>\n\n      <li>When setting up a position \"by amount\", the algorithm will not pick\n      the exact amount but will try to make profit by providing small amount of\n      liquidity. (Which is bad)</li>\n\n      <li>There may be a delay between validating a rebalancing operation &\n      having the interface reflecting it.</li>\n\n    </ul>\n  </section>\n</section>\n`)\n\n/**\n * Init\n */\nconst tabs = global.tabs = new Tabs({\n  nav: html.grab(\"header\"),\n  view: dom.main\n})\ntabs.add(\"#welcome\", __(\"Welcome\"), welcome)\ntabs.add(\"#license\", __(\"License\"), license)\ntabs.add(\"#login\", __(\"Login\"), dom.loginForm)\ntabs.select(location.hash)\nif (!tabs.selected) tabs.select(\"#welcome\")\n\nconst loginForm = new Form(dom.loginForm).addValidator(login)\nhtml.show(dom.loginForm)\ndom.loginForm.autocomplete = \"on\"\nif (params.address) {\n  tabs.select(\"#login\")\n  dom.loginAddressBox.value = params.address\n  login()\n} else {\n  dom.ledgerLoginButton.onclick = () => loginWithLedgerWallet()\n}\n\ntabs.listen(\"select\", page => {\n  location.hash = page\n  window.scrollTo(0, 0)\n})\n\n/**\n * Functions\n */\n\nlet ledger\nasync function loginWithLedgerWallet () {\n  ledger = await getLedgerModule()\n  loginForm.setInfo(__(\"Please open the Stellar App in your Ledger Wallet\"))\n  try {\n    await ledger.connect()\n    dom.loginAddressBox.value = ledger.publicKey\n    login()\n  } catch (error) {\n    console.error(error)\n    loginForm.setError(error)\n  }\n}\n\nasync function login (address = dom.loginAddressBox.value) {\n  if (!address) throw new Error(__(\"Please enter an address.\"))\n  if (ledger) ledger.disconnect()\n\n  loginForm.setInfo(__(\"Connecting to your account...\"))\n  params.$set({ address })\n\n  try {\n    global.portfolio = await Portfolio.resolve(address)\n    global.portfolio.listen(\"open\", initGui)\n  } catch (error) {\n    console.error(error)\n    loginForm.setError(error)\n  }\n}\n\nfunction initGui () {\n  const portfolio = global.portfolio\n\n  const selected = location.hash\n  tabs.remove(\"#welcome\")\n  tabs.remove(\"#login\")\n  tabs.remove(\"#license\")\n  tabs.add(\"#portfolio\", __(\"Portfolio\"), new PortfolioGui(portfolio))\n  tabs.add(\"#rebalance\", __(\"Rebalance\"), new ShareGui(portfolio))\n  tabs.add(\"#activity\", __(\"Activity\"), new ActivityGui(portfolio))\n  tabs.add(\"#settings\", __(\"Settings\"), new SettingsGui())\n  tabs.add(\"#logout\", __(\"Logout\"), () => {\n    location.replace(location.href.replace(/\\?.*$/, \"#login\"))\n  })\n\n  tabs.select(selected)\n  if (!tabs.selected) tabs.select(\"#portfolio\")\n}\n\n/**\n * Module loading\n */\n\nfunction getLedgerModule () {\n  return import(/* webpackChunkName: \"ledger\" */ \"@cosmic-plus/ledger-wallet\").then(\n    ledger => ledger.default\n  )\n}\n","\"use_strict\"\n/**\n * Asset class\n */\n\nconst AUTO_REFRESH_PRICES = true\nconst CRYPTO_PRICES_REFRESH_DELAY = 60 * 1000\nconst FIAT_PRICES_REFRESH_DELAY = 60 * 60 * 1000\nconst FIAT_BASEURL = \"https://www.xe.com/themes/xe/images/flags/svg/\"\nconst FIAT_IMAGEFORMAT = \".svg\"\n\nconst Mirrorable = require(\"@cosmic-plus/jsutils/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/projectable\")\n\nconst global = require(\"./global\")\nconst marketData = require(\"./market-data\")\nconst Orderbook = require(\"./orderbook\")\n\n/**\n * Class\n */\n\nconst Asset = module.exports = class Asset extends Projectable {\n  static resolve (id) {\n    return Asset.table[id] || new Asset(id)\n  }\n\n  constructor (id) {\n    super()\n\n    this.id = id\n    Asset.table[id] = this\n\n    // Empty image by default\n    this.image = \"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=\"\n\n    if (Asset.info[id]) {\n      this.code = id\n      Object.assign(this, Asset.info[id])\n      if (this.type === \"fiat\") {\n        Asset.fiats.push(this)\n        this.image = `${FIAT_BASEURL}${id.toLowerCase()}${FIAT_IMAGEFORMAT}`\n      } else {\n        Asset.cryptos.push(this)\n        this.type = \"crypto\"\n      }\n    } else {\n      this.code = id.replace(/:.*/, \"\")\n      this.name = this.code\n      this.type = \"unknown\"\n    }\n\n    this.anchors = new Mirrorable()\n    this.balances = new Mirrorable()\n    this.offers = new Mirrorable()\n    this.shares = new Mirrorable()\n\n    this.balances.mirror(balance => {\n      this.anchors.push(balance.anchor)\n      balance.trap(\"amount\", () => this.compute(\"amount\"))\n      balance.trap([\"buying\", \"selling\"], () => this.compute(\"liabilities\"))\n    })\n\n    this.orderbook = Orderbook.forAsset(this)\n    this.define(\"price\", \"globalPrice\", () => {\n      return this.globalPrice || this.orderbook.price\n    })\n    this.orderbook.trap(\"price\", () => this.compute(\"price\"))\n  }\n\n  async getInfo () {\n    // Happens once & only for cryptos.\n    if (this.name || this.type !== \"crypto\") return\n    this.info = await marketData.crypto.info(this)\n    this.name = this.info.name\n    this.image = this.info.image.small\n  }\n\n  addOrderbook (orderbook) {\n    this.orderbook.addChild(orderbook)\n  }\n}\n\nAsset.define(\"amount\", \"balances\", function () {\n  return this.balances && this.balances.reduce((sum, el) => sum + el.amount, 0)\n})\n\nAsset.define(\"value\", [\"amount\", \"price\"], function () {\n  return this.amount === 0 ? 0 : this.amount * this.price\n})\n\nAsset.define(\"liabilities\", [\"balances\", \"price\"], function () {\n  if (this.balances) {\n    const rawLiabilities = this.balances.reduce(\n      (sum, entry) => sum + entry.buying - entry.selling,\n      0\n    )\n    return this.price * rawLiabilities\n  }\n})\n\nAsset.define(\"isSupported\", [\"type\", \"price\"], function () {\n  return this.type !== \"unknown\" || this.price\n})\n\n/**\n * Utilities\n */\n\nAsset.refreshPrices = async function (array) {\n  if (!array) {\n    await Asset.refreshCryptoPrices()\n    await Asset.refreshFiatPrices()\n  } else {\n    await Asset.refreshCryptoPrices(\n      array.filter(asset => asset.type === \"crypto\").map(asset => asset.code)\n    )\n    await Asset.refreshFiatPrices(\n      array.filter(asset => asset.type === \"fiat\").map(asset => asset.code)\n    )\n  }\n}\n\nAsset.refreshCryptoPrices = async function (assets = Asset.cryptos) {\n  if (!assets.length) return\n  const prices = await marketData.crypto.prices(assets)\n  assets.forEach(asset => asset.globalPrice = prices[asset.code])\n}\n\nAsset.refreshFiatPrices = async function (fiats = Asset.fiats) {\n  if (!fiats.length) return\n  const prices = await marketData.fiat.prices(fiats)\n  fiats.forEach(asset => asset.price = asset.globalPrice = prices[asset.code])\n}\n\n/**\n * Known Assets\n */\n\nAsset.info = {\n  USD: { type: \"fiat\", name: \"US Dollar\" },\n  EUR: { type: \"fiat\", name: \"Euro\" },\n  CNY: { type: \"fiat\", name: \"Renminbi\" },\n\n  BTC: { id: \"bitcoin\" },\n  ETH: { id: \"ethereum\" },\n  XRP: { id: \"ripple\" },\n  XLM: { id: \"stellar\" },\n  KIN: { id: \"kin\" },\n  BAT: { id: \"basic-attention-token\" },\n  ZRX: { id: \"0x\" },\n  BCH: { id: \"bitcoin-cash\" },\n  STEEM: { id: \"steem\" },\n  SBD: { id: \"steem-dollar\" },\n  LINK: { id: \"chainlink\" },\n\n  SLT: { id: \"smartlands\" },\n  MOBI: { id: \"mobius\" },\n  SHX: { id: \"stronghold-token\" },\n  RMT: { id: \"sureremit\" },\n  TERN: { id: \"ternio\" },\n  PEDI: { id: \"pedity\" },\n  GRAT: { id: \"gratz\" },\n  REPO: { id: \"repo\" }\n}\n\n/**\n * Init\n */\n\nAsset.table = {}\nAsset.cryptos = []\nAsset.fiats = []\nnew Asset(global.currency)\n\n// Automatic global price refresh\nif (AUTO_REFRESH_PRICES) {\n  setInterval(Asset.refreshCryptoPrices, CRYPTO_PRICES_REFRESH_DELAY)\n  setInterval(Asset.refreshFiatPrices, FIAT_PRICES_REFRESH_DELAY)\n}\n\n// eslint-disable-next-line no-console\nconsole.log(Asset.table)\n","\"use_strict\"\n/**\n * Signing Side Frame\n */\nconst html = require(\"@cosmic-plus/jsutils/html\")\n\n/**\n * Class\n */\n\nclass SideFrame {\n  constructor (url) {\n    if (SideFrame.current) SideFrame.current.close()\n    SideFrame.current = this\n\n    this.domNode = html.create(\"iframe\", {\n      title: \"Signing Frame\",\n      src: url,\n      sandbox: \"allow-same-origin allow-scripts allow-forms allow-popups\",\n      hidden: true\n    })\n    Object.assign(this.domNode.style, SideFrame.style)\n    html.append(document.body, this.domNode)\n\n    this.show()\n  }\n\n  show () {\n    if (!this.domNode.hidden) return\n\n    this.htmlOverflow = document.documentElement.style.overflow\n    this.bodyOverflow = document.body.style.overflow\n    document.documentElement.style.overflow = \"hidden\"\n    document.body.style.overflow = \"hidden\"\n\n    SideFrame.shadow.onclick = () => this.close()\n    html.show(SideFrame.shadow, this.domNode)\n  }\n\n  hide () {\n    if (this.domNode.hidden) return\n\n    document.documentElement.style.overflow = this.htmlOverflow\n    document.body.style.overflow = this.bodyOverflow\n\n    SideFrame.shadow.onclick = null\n    html.hide(SideFrame.shadow, this.domNode)\n  }\n\n  close () {\n    SideFrame.current = null\n    this.hide()\n    html.destroy(this.domNode)\n  }\n}\n\n/**\n * Event\n */\n\nwindow.addEventListener(\"message\", event => {\n  const frameWindow =\n    SideFrame.current && SideFrame.current.domNode.contentWindow\n\n  if (event.source === frameWindow) {\n    switch (event.data) {\n    case \"show\":\n      SideFrame.current.show()\n      break\n    case \"hide\":\n      SideFrame.current.hide()\n      break\n    case \"close\":\n      SideFrame.current.close()\n      break\n    }\n  }\n})\n\n/**\n * Frame style\n */\n\nSideFrame.style = {\n  position: \"fixed\",\n  zIndex: 999,\n  right: 0,\n  top: 0,\n  width: \"30em\",\n  maxWidth: \"100%\",\n  height: \"100vh\",\n  border: \"0.1em solid hsl(240, 10%, 75%)\",\n  background: \"hsl(240, 40%, 98%)\",\n  backgroundImage: `url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12em\" height=\"12em\" viewBox=\"0 0 18055.55 18055.55\" shape-rendering=\"geometricPrecision\" text-rendering=\"geometricPrecision\" image-rendering=\"optimizeQuality\" fill-rule=\"evenodd\" clip-rule=\"evenodd\"><path d=\"M6184.01 6244.26l-5076.93 5077.09c-1542.18 1542.18-1542.18 4042.74 0 5584.91 1542.18 1542.18 4042.74 1542.18 5584.91 0l5050.06-5050.22c-946.39 926.55-2243.37 1281.63-3458.3 1065.06l-2788.46 2788.46c-881.29 881.29-2310.22 881.29-3191.52 0-881.29-881.29-881.29-2310.22 0-3191.51l2788.62-2788.62 2311.35-2311.19c883.05-858.58 2294.87-850.9 3168.48 22.71 880.17 880.17 881.29 2306.54 3.52 3188.31l2288.31-2288.47c-136.75-767.89-501.74-1503.15-1095.13-2096.54-593.23-593.23-1328.33-958.22-2096.22-1095.13-1271.39-226.64-2574.93 181.38-3488.69 1095.13z\" fill=\"#c1c1c1\"/><path d=\"M11772.44 11825.98l5076.93-5077.09c1542.18-1542.18 1542.18-4042.74 0-5584.91-1542.18-1542.18-4042.74-1542.18-5584.91 0L6214.4 6214.2c946.39-926.56 2243.37-1281.63 3458.3-1065.07l2788.46-2788.46c881.29-881.29 2310.22-881.29 3191.52 0 881.29 881.29 881.29 2310.22 0 3191.52l-2788.62 2788.62L10552.71 10652c-883.05 858.57-2294.87 850.9-3168.48-22.71-880.17-880.17-881.29-2306.55-3.52-3188.31L5092.4 9729.45c136.75 767.89 501.74 1503.15 1095.13 2096.54 593.23 593.23 1328.33 958.22 2096.22 1095.13 1271.39 226.64 2574.93-181.37 3488.69-1095.13z\" fill=\"#9f9f9f\"/><path d=\"M12651.33 7587.95l-1418.38 1418.38c7.84 577.72-204.89 1157.83-638.02 1603.44l2269.12-2268.96c-45.58-255.91-116.44-508.14-212.72-752.85zm-909.28 4268.09c-810.76 793.48-1919.32 1194.94-3038.77 1116.89-139.79-9.76-279.9-26.87-419.53-51.82l-509.1 509.1c365.47 95.48 749.17 146.35 1144.56 146.35 448 0 880.65-65.26 1289.15-186.81l1533.7-1533.7z\" fill=\"#a6a6a6\"/><path d=\"M6214.4 6214.2c810.76-793.48 1919.32-1194.94 3038.77-1116.89 139.79 9.76 279.9 26.87 419.53 51.82l439.2-439.2c-379.87-103.8-779.89-159.3-1192.7-159.3-416.81 0-820.35 56.46-1203.57 162.34L6214.4 6214.2zm509.1 2788.78c7.36-557.41 220.08-1112.57 638.02-1542.5L5092.4 9729.44c42.87 240.56 108.12 478.07 195.77 708.87L6723.5 9002.98z\" fill=\"#888888\"/></svg>')`,\n  backgroundRepeat: \"no-repeat\",\n  backgroundPosition: \"center\",\n  padding: 0\n}\n\n/**\n * Shadow Layer\n */\n\nSideFrame.shadow = html.create(\"div\", { hidden: true })\nObject.assign(SideFrame.shadow.style, {\n  position: \"fixed\",\n  zIndex: 998,\n  top: 0,\n  width: \"100%\",\n  height: \"100%\",\n  background: \"rgba(0,0,0,0.2)\"\n})\ndocument.body.insertBefore(SideFrame.shadow, document.body.firstChild)\n\n/**\n * Export\n */\n\nmodule.exports = SideFrame\n","\"use_strict\"\n/**\n * Markets statistics & data\n *\n * @exports marketData\n */\nconst marketData = exports\n\nconst axios = require(\"@cosmic-plus/base/axios\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst { day } = require(\"@cosmic-plus/jsutils/misc\")\n\nconst global = require(\"./global\")\n\n/**\n * Generic price/history\n */\n\nmarketData.assetHistory = function (asset, limit = 1000) {\n  if (asset.type === \"crypto\") return marketData.crypto.history(asset, limit)\n  else if (asset.type === \"fiat\") return marketData.fiat.history(asset, limit)\n}\n\n/**\n * Crypto price/history by \"https://www.coingecko.com\"\n */\n\nmarketData.crypto = {}\n\nfunction coingeckoCall (page, params) {\n  return axios.get(`https://api.coingecko.com/api/v3/${page}`, { params })\n}\n\nmarketData.crypto.list = async function () {\n  const response = await coingeckoCall(\"coins/list\")\n  const list = {}\n  response.data.forEach(entry => {\n    const symbol = entry.symbol.toUpperCase()\n    list[symbol] = { id: entry.id, name: entry.name }\n  })\n  return list\n}\n\nmarketData.crypto.stellarNative = async function () {\n  const response = await coingeckoCall(\"exchanges/stellar_term\")\n  return response.data.tickers.map(x => x.coin_id).filter(x => x)\n}\n\nmarketData.crypto.info = async function (asset) {\n  const response = await coingeckoCall(`coins/${asset.id}`, {\n    localization: false,\n    tickers: false,\n    market_data: false,\n    community_data: false,\n    developer_data: false,\n    sparkline: false\n  })\n  return response.data\n}\n\nmarketData.crypto.prices = async function (assets) {\n  const ids = assets.map(asset => asset.id).join(\",\")\n  const quote = global.currency.toLowerCase()\n  const response = await coingeckoCall(\"simple/price\", {\n    ids,\n    vs_currencies: quote\n  })\n  const prices = {}\n  assets.forEach(asset => {\n    const assetData = response.data[asset.id]\n    if (assetData) prices[asset.code] = assetData[quote]\n  })\n  return prices\n}\n\nmarketData.crypto.history = async function (asset, limit = 1000) {\n  const response = await coingeckoCall(`coins/${asset.id}/market_chart`, {\n    vs_currency: global.currency,\n    days: limit\n  })\n  const data = response.data.prices.map((record, index) => {\n    return {\n      time: record[0],\n      price: record[1],\n      // volume: response.data.total_volumes[index][1]\n      volume: +nice(response.data.total_volumes[index][1] / record[1])\n    }\n  })\n  return data\n}\n\n/**\n * Fiat prices / history by \"https://exchangeratesapi.io\"\n */\n\nmarketData.fiat = {}\n\nasync function exchangeratesCall (page, symbols, params = {}) {\n  params.base = global.currency\n  if (typeof symbols === \"string\") {\n    params.symbols = symbols\n  } else {\n    if (global.currency === \"EUR\") symbols = symbols.filter(x => x !== \"EUR\")\n    params.symbols = symbols.join(\",\")\n  }\n  params.source = \"equilibre.io\"\n\n  return axios\n    .get(`https://api.exchangeratesapi.io/${page}`, { params })\n    .then(response => {\n      if (global.currency === \"EUR\" && !response.data.start_at) {\n        response.data.rates.EUR = 1\n      }\n      return response\n    })\n}\n\nmarketData.fiat.prices = async function (assets) {\n  const symbols = assets.map(asset => asset.code)\n  const response = await exchangeratesCall(\"latest\", symbols)\n  const data = response.data.rates\n  for (let symbol in data) {\n    data[symbol] = nice(1 / data[symbol], 8)\n  }\n  return data\n}\n\nmarketData.fiat.history = async function (asset, limit = 1000) {\n  const cached = cachedHistory(asset)\n  if (cached) return cached\n\n  const end_at = new Date().toISOString().slice(0, 10)\n  const today = new Date(end_at)\n  today.setDate(today.getDate() - limit)\n  const start_at = today.toISOString().slice(0, 10)\n  const response = await exchangeratesCall(\"history\", asset.code, {\n    start_at,\n    end_at\n  })\n\n  const data = Object.keys(response.data.rates)\n    .sort()\n    .map(date => {\n      return {\n        time: new Date(date).getTime(),\n        price: +nice(1 / response.data.rates[date][asset.code], 8)\n      }\n    })\n  cacheHistory(asset, data)\n  return data\n}\n\n/**\n * Helpers\n */\n\nfunction cacheHistory (asset, data) {\n  localStorage[`prices.${asset.code}`] = JSON.stringify([day(), data])\n}\n\nfunction cachedHistory (asset) {\n  const json = localStorage[`prices.${asset.code}`]\n  if (!json) return\n  const data = JSON.parse(json)\n  if (data[0] === day()) return data[1]\n}\n","\"use_strict\"\n/**\n * Orderbook class\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/projectable\")\nconst StellarSdk = require(\"@cosmic-plus/base/stellar-sdk\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst Orderbook = module.exports = class Orderbook extends Projectable {\n  static forBalance (balance, quote) {\n    if (balance.asset === quote) return\n    const orderbook = new Orderbook(balance.asset, quote)\n    balance.orderbook = orderbook\n    balance.asset.addOrderbook(orderbook)\n    orderbook.balance = balance\n\n    const baseAsset = new StellarSdk.Asset(balance.code, balance.anchor.address)\n    const quoteAsset = StellarSdk.Asset.native()\n\n    const server = cosmicLib.resolve.server()\n    const callBuilder = server.orderbook(baseAsset, quoteAsset)\n    const streamOptions = { onmessage: offers => orderbook.ingest(offers) }\n    this.close = callBuilder.stream(streamOptions)\n\n    return orderbook\n  }\n\n  static forAsset (asset) {\n    return new Orderbook(asset)\n  }\n\n  constructor (base, quote) {\n    super()\n\n    this.base = base\n    this.quote = quote\n\n    if (quote) {\n      this.type = \"native\"\n      this.name = `${base.code}/${quote.code}`\n      this.quote.trap(\"price\", () => this.updateOffersPrices())\n    } else {\n      this.type = \"agregated\"\n      this.name = `${base.code} (${__(\"Agregated\")})`\n      this.childs = []\n    }\n  }\n\n  ingest (offers) {\n    if (!areOffersEquals(this.bids, offers.bids)) {\n      this.bids = normalizeOffers(offers.bids, this.quote, this.balance, \"bids\")\n    }\n    if (!areOffersEquals(this.asks, offers.asks)) {\n      this.asks = normalizeOffers(offers.asks, this.quote, this.balance, \"asks\")\n    }\n  }\n\n  updateOffersPrices () {\n    if (this.bids) {\n      this.set(\"bids\", updateOffersPrices(this.bids, this.quote))\n    }\n    if (this.asks) {\n      this.set(\"asks\", updateOffersPrices(this.asks, this.quote))\n    }\n  }\n\n  mergeOffers (type) {\n    if (this.childs.length < 2) {\n      this.set(type, this.childs[0] && this.childs[0][type])\n      return\n    }\n\n    /// Merge order books\n    const merged = this.childs.reduce((arr, x) => {\n      return x[type] ? arr.concat(x[type]) : arr\n    }, [])\n    if (!merged.length) {\n      this[type] = null\n      return\n    }\n\n    const sortOffers =\n      type === \"bids\"\n        ? (a, b) => b.price - a.price\n        : (a, b) => a.price - b.price\n\n    /// Update cumulative properties\n    let cumul = 0,\n      volume = 0\n    this.set(\n      type,\n      merged.sort(sortOffers).map(row => {\n        const mergedRow = Object.assign({}, row)\n        mergedRow.cumul = cumul += +row.amount\n        mergedRow.volume = volume += +row.amount * row.price\n        return mergedRow\n      })\n    )\n  }\n\n  addChild (orderbook) {\n    this.childs.push(orderbook)\n    orderbook.trap(\"bids\", () => this.mergeOffers(\"bids\"))\n    orderbook.trap(\"asks\", () => this.mergeOffers(\"asks\"))\n  }\n}\n\nOrderbook.define(\"bestBid\", \"bids\", function () {\n  return this.bids && this.bids[0] && this.bids[0].price\n})\nOrderbook.define(\"bestAsk\", \"asks\", function () {\n  return this.asks && this.asks[0] && this.asks[0].price\n})\nOrderbook.define(\"price\", [\"bestBid\", \"bestAsk\"], function () {\n  return (this.bestBid + this.bestAsk) / 2\n})\nOrderbook.define(\"spread\", [\"bestBid\", \"bestAsk\"], function () {\n  return this.bestAsk - this.bestBid\n})\nOrderbook.define(\"spread%\", [\"spread\", \"bestAsk\"], function () {\n  return 100 * this.spread / this.bestAsk\n})\n\n/**\n * Utilities\n */\n\n/**\n * Look for the best first offer in **orderbook** **side** that match **filter**\n * (if provided) among child orderbooks.\n *\n * @param  {Orderbook} orderbook [description]\n * @param  {String}    side      `bids` or `asks`\n * @param  {Function}  [filter]  A filter that is passed by the returned offer\n * @return {Object}    An orderbook offer\n */\nOrderbook.prototype.findOffer = function (side, filter) {\n  const offers = this[side]\n  const childsNum = this.childs.length || 1\n  const anchors = {}\n\n  let last\n  for (let index in offers) {\n    const offer = offers[index]\n    if (filter && !filter(offer)) continue\n    const anchor = offer.balance.anchor.address\n    if (!anchors[anchor]) {\n      anchors[anchor] = true\n      last = offer\n    }\n    if (Object.keys(anchors).length === childsNum) break\n  }\n  return last\n}\n\nOrderbook.prototype.findAsk = function (filter) {\n  return this.findOffer(\"asks\", filter)\n}\nOrderbook.prototype.findBid = function (filter) {\n  return this.findOffer(\"bids\", filter)\n}\n\n/**\n * Helpers\n */\n\nfunction areOffersEquals (array1, array2) {\n  if (!array1) return false\n  if (array1.length !== array2.length) return false\n  for (let index in array1.length) {\n    if (array1[index].amount !== array2[index].amount) return false\n    if (array1[index].price !== array2[index].price) return false\n  }\n  return true\n}\n\nfunction normalizeOffers (offers, quote, balance, side) {\n  offers.forEach(row => {\n    row.volume = undefined\n    row.cumul = undefined\n    row.baseAmount = +row.amount\n    row.basePrice = +row.price\n    row.balance = balance\n    row.side = side\n  })\n  return updateOffersPrices(offers, quote)\n}\n\nfunction updateOffersPrices (offers, quote) {\n  let cumul = 0,\n    volume = 0\n  offers.forEach(row => {\n    if (row.side === \"asks\") row.amount = row.baseAmount\n    else row.amount = +nice(row.baseAmount / row.basePrice, 7)\n    row.cumul = cumul += +row.amount\n    row.price = +nice(row.basePrice * quote.price, 7)\n    row.volume = volume += +nice(+row.amount * row.price, 7)\n  })\n  return offers\n}\n","\"use_strict\"\n/**\n * Balance entry\n */\nconst Mirrorable = require(\"@cosmic-plus/jsutils/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/projectable\")\n\nconst Anchor = require(\"./anchor\")\nconst Asset = require(\"./asset\")\nconst Orderbook = require(\"./orderbook\")\n\nconst Balance = module.exports = class Balance extends Projectable {\n  static resolve (code, issuer) {\n    const id = code ? `${code}:${issuer}` : \"XLM\"\n    return Balance.table[id]\n  }\n\n  static ingest (entry) {\n    const id = entryId(entry)\n    const balance = Balance.table[id]\n    if (!balance) return new Balance(entry, id)\n\n    balance.amount = +entry.balance\n    balance.buying = +entry.buying_liabilities\n    balance.selling = +entry.selling_liabilities\n    return balance\n  }\n\n  constructor (entry) {\n    super()\n\n    this.id = entryId(entry)\n    this.code = entry.asset_code || \"XLM\"\n    this.anchor = Anchor.resolve(entry.asset_issuer || \"stellar.org\")\n    Balance.table[this.id] = this\n\n    if (this.id === \"XLM\" || this.id in Anchor.known) {\n      this.asset = Asset.resolve(Anchor.known[this.id] || this.code)\n      this.known = true\n    } else {\n      this.asset = Asset.resolve(this.id)\n      this.known = false\n    }\n    this.amount = +entry.balance\n    this.buying = +entry.buying_liabilities\n    this.offers = new Mirrorable()\n    this.selling = +entry.selling_liabilities\n\n    this.asset.balances.push(this)\n\n    if (this.code === \"XLM\") {\n      this.asset.project(\"price\", this)\n    } else {\n      this.orderbook = Orderbook.forBalance(this, Asset.resolve(\"XLM\"))\n      this.orderbook.project(\"price\", this)\n    }\n  }\n}\n\nBalance.table = {}\nBalance.define(\"value\", [\"amount\", \"price\"], function () {\n  return this.amount === 0 ? 0 : this.amount * this.price\n})\n\n/**\n * Helpers\n */\n\nfunction entryId (entry) {\n  return entry.asset_code ? `${entry.asset_code}:${entry.asset_issuer}` : \"XLM\"\n}\n","\"use_strict\"\n/**\n * Order class\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst CosmicLink = cosmicLib.CosmicLink\nconst Mirrorable = require(\"@cosmic-plus/jsutils/mirrorable\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/projectable\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./global\")\n\nconst Order = module.exports = class Order extends Projectable {\n  static rebalance (share) {\n    if (share.asset.code === \"XLM\") return\n\n    const order = new Order(\n      global.rebalancingStrategy,\n      share.asset.orderbook,\n      share\n    )\n    share.trap([\"value\", \"target\"], () => order.refresh())\n    share.asset.trap(\"liabilities\", () => order.refresh())\n    return order\n  }\n\n  constructor (method, orderbook, ...parameters) {\n    super()\n    this.algorithm = algorithm[method]\n    this.operations = new Mirrorable()\n    this.orderbook = orderbook\n    this.parameters = parameters\n\n    this.orderbook.listen(\"update\", () => this.refresh())\n    this.operations.listen(\"update\", () =>\n      this.compute([\"cosmicLink\", \"description\"])\n    )\n\n    this.refresh()\n  }\n\n  refresh () {\n    this.operations.splice(0, this.operations.length)\n    this.operations.trigger(\"update\")\n    this.type = \"\"\n    this.compute(\"offers\")\n    this.algorithm(this, ...this.parameters)\n    this.trigger(\"refresh\")\n  }\n\n  /**\n   * Operations Management\n   */\n\n  getOperation (offer, make) {\n    const id = `${offer.balance.anchor.id}:${make ? offer.price : \"take\"}`\n    const operation = this.operations.find(x => x.id === id)\n    if (operation) {\n      return operation\n    } else {\n      const newOperation = { id }\n      this.operations.push(newOperation)\n      return newOperation\n    }\n  }\n\n  addOperation (offer, amount) {\n    const operation = this.getOperation(offer, amount > 0)\n    this.setOperation(operation, offer, Number(amount) || operation.amount)\n  }\n\n  setOperation (operation, offer, amount) {\n    operation.amount = amount\n    operation.cost = amount * offer.price\n    operation.offer = offer\n    this.operations.trigger(\"update\")\n  }\n}\n\nOrder.define(\"cosmicLink\", \"operations\", function () {\n  return Order.operationsToCosmicLink(this.operations)\n})\nOrder.define(\"description\", \"operations\", function () {\n  return Order.operationsToDescription(this.operations)\n})\n\n/**\n * Utilities\n */\n\nOrder.operationsToCosmicLink = function (operations = []) {\n  const cosmicLink = new CosmicLink({\n    memo: \"Equilibre.io\",\n    source: global.portfolio.accountId\n  })\n  operations.forEach(operation => {\n    cosmicLink.addOperation(\"manageOffer\", operationToOdesc(operation))\n  })\n\n  return cosmicLink\n}\n\nOrder.operationsToDescription = function (operations = []) {\n  const desc = []\n  operations.forEach(op => {\n    if (operationDirection(op) === \"buy\") {\n      desc.push(`\n${__(\"Buy\")} ${nice(op.amount)} ${op.offer.balance.code} ${__(\"at\")} \\\n${nice(op.offer.price)} ${global.currency}\n      `)\n    } else {\n      desc.push(`\n${__(\"Sell\")} ${nice(op.amount)} ${op.offer.balance.code} ${__(\"at\")} \\\n${nice(op.offer.price)} ${global.currency}\n      `)\n    }\n  })\n  return desc\n}\n\n/**\n * Helpers\n */\n\nfunction operationDirection (op) {\n  if (\n    op.amount > 0 && op.offer.side === \"bids\"\n    || op.amount < 0 && op.offer.side === \"asks\"\n  ) {\n    return \"buy\"\n  } else {\n    return \"sell\"\n  }\n}\n\nfunction operationToOdesc (operation) {\n  const offer = operation.offer\n  const base = offer.balance.code + \":\" + offer.balance.anchor.address\n  const quote = \"XLM\"\n\n  let odesc\n  if (operationDirection(operation) === \"buy\") {\n    odesc = {\n      buying: base,\n      selling: quote,\n      amount: operation.amount * offer.price_r.n / offer.price_r.d,\n      price: { n: offer.price_r.d, d: offer.price_r.n }\n    }\n  } else {\n    odesc = {\n      buying: quote,\n      selling: base,\n      amount: operation.amount,\n      price: offer.price_r\n    }\n  }\n  odesc.amount = Math.abs(odesc.amount).toFixed(7)\n  odesc.offerId = operation.offer.id\n\n  return odesc\n}\n\nfunction floorPrice (offer, price) {\n  const refPrice = offer.balance.asset.price\n  const side = offer.side\n  if (side === \"bids\") return minMax(price, refPrice * 0.975, refPrice)\n  else return minMax(price, refPrice, refPrice * 1.025)\n}\n\nfunction minMax (value, min, max) {\n  return nice(Math.min(Math.max(value, min), max), 7)\n}\n\n/**\n * Create a copy of **offer** with a delta to global price reduced by\n * **percentage**.\n */\nfunction tightenSpread (offer, percentage = 1) {\n  const quote = offer.balance.orderbook.quote\n  const clone = Object.assign({}, offer)\n  const diff = (offer.balance.asset.price - offer.price) / 100 * percentage\n  clone.price = floorPrice(offer, nice(offer.price + diff, { significant: 9 }))\n  clone.price_r = {\n    n: nice(clone.price * 1000000000, 0),\n    d: nice(quote.price * 1000000000, 0)\n  }\n  // Ten characters maximum\n  while (clone.price_r.n > 999999999 || clone.price_r.d > 999999999) {\n    clone.price_r.n = nice(clone.price_r.n / 10, 0)\n    clone.price_r.d = nice(clone.price_r.d / 10, 0)\n  }\n  return clone\n}\n\n/**\n * Orders types\n */\n\nconst algorithm = {}\n\nalgorithm.balance = function (order, share) {\n  const asset = share.asset\n  const orderbook = asset.orderbook\n  const offers = asset.offers\n\n  if (asset.liabilities) {\n    const currentOffers = offers.filter(offer => !offer.outdated)\n    if (currentOffers.length) {\n      order.description = [__(\"Rebalancing...\")]\n      return\n    }\n  }\n\n  if (!orderbook.bids || !orderbook.asks || !share.target) return\n  if (!orderbook.bids.length || !orderbook.asks.length) return\n\n  const tmp1 = orderbook.findOffer(\"asks\", offer => {\n    const ask = tightenSpread(offer)\n    const sellAmount = (ask.price * asset.amount - share.target) / ask.price\n    return ask.balance.amount > sellAmount && offer.amount > sellAmount * 0.01\n  })\n\n  if (tmp1) {\n    const ask = tightenSpread(tmp1)\n    const sellAmount = (ask.price * asset.amount - share.target) / ask.price\n    const replace = offers.find(offer => offer.selling.asset_code)\n    ask.id = replace && replace.id\n    if (sellAmount * ask.basePrice > 1) order.addOperation(ask, sellAmount)\n  }\n\n  const tmp2 = orderbook.findOffer(\"bids\")\n  const bid = tightenSpread(tmp2)\n  if (bid.price * asset.amount < share.target) {\n    // TODO: don't let buyAmount exceed its share of XLM\n    const buyAmount = (share.target - bid.price * asset.amount) / bid.price\n    const replace = offers.find(offer => offer.buying.asset_code)\n    bid.id = replace && replace.id\n    if (buyAmount * bid.basePrice > 1) order.addOperation(bid, buyAmount)\n  }\n}\n\nalgorithm.limit = function (order, size = order.asset.size) {\n  order.type = \"maker\"\n  if (!order.offers) return\n\n  const offer = order.orderbook.findOffer(this.side)\n  order.addOperation(offer, size)\n}\n\nalgorithm.market = function (order, size = order.asset.size) {\n  order.type = \"taker\"\n  if (!order.offers) return\n  const orderbook = order.orderbook\n  const offer = orderbook.findOffer(this.side, offer => offer.cumul > size)\n  order.addOperation(offer, size)\n}\n\nalgorithm.deepLimit = function (order, size = order.asset.size) {\n  order.type = \"maker\"\n  if (!order.offers) return\n  const orderbook = order.orderbook\n  const offer = orderbook.findOffer(this.side, offer => offer.cumul > size)\n  order.addOperation(offer, size)\n}\n\n/**\n * Append algorithms to Order class\n */\n\nfor (let key in algorithm) {\n  if (!Order[key]) Order[key] = (...parameters) => new Order(key, ...parameters)\n}\n","\"use_strict\"\n/**\n * Compute portfolio data from Account object.\n */\nconst axios = require(\"@cosmic-plus/base/axios\")\nconst cosmicLib = require(\"cosmic-lib\")\nconst Mirrorable = require(\"@cosmic-plus/jsutils/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/projectable\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst Asset = require(\"./asset\")\nconst Balance = require(\"./balance\")\nconst global = require(\"./global\")\n// const History = require(\"./portfolio-history\")\nconst Offers = require(\"./offers\")\n\n/**\n * Class\n */\n\nmodule.exports = class Portfolio extends Projectable {\n  static async resolve (address) {\n    const portfolio = new Portfolio()\n    portfolio.address = cosmicLib.config.source = address\n\n    await testNetwork()\n\n    const destination = await cosmicLib.resolve.address(address)\n    if (destination.memo)\n      throw new Error(__(\"Invalid federated address: shared account.\"))\n    if (await cosmicLib.resolve.isAccountEmpty(destination.account_id))\n      throw new Error(__(\"Empty account\"))\n\n    portfolio.accountId = destination.account_id\n\n    const server = cosmicLib.resolve.server()\n    const callBuilder = server.accounts().accountId(portfolio.accountId)\n    const streamOptions = { onmessage: account => portfolio.ingest(account) }\n    this.close = callBuilder.stream(streamOptions)\n\n    return portfolio\n  }\n\n  constructor () {\n    super()\n\n    // eslint-disable-next-line no-console\n    console.log(this)\n\n    this.assets = new Mirrorable()\n    this.balances = new Mirrorable()\n\n    this.define(\"total\", \"assets\", () => {\n      return this.assets\n        .filter(asset => asset.isSupported)\n        .reduce((sum, x) => sum + x.value, 0)\n    })\n    this.assets.mirror(asset =>\n      asset.trap(\"value\", () => this.compute(\"total\"))\n    )\n\n    this.new = true\n  }\n\n  async ingest (account) {\n    this.account = account\n\n    for (let index in account.balances) {\n      const balance = Balance.ingest(account.balances[index])\n      if (this.assets.indexOf(balance.asset) === -1) {\n        await balance.asset.getInfo()\n        this.assets.push(balance.asset)\n        this.balances.push(balance)\n        // TODO: check if following line trigger too much rebalancing\n        this.trap(\"total\", () => balance.asset.compute(\"share\"))\n      } else if (this.balances.indexOf(balance) === -1) {\n        this.balances.push(balance)\n      }\n    }\n\n    if (this.new) {\n      delete this.new\n      await Asset.refreshPrices()\n      this.offers = await Offers.forPortfolio(this)\n      this.trigger(\"open\")\n    }\n  }\n}\n\n/**\n * Extension\n */\n\nAsset.define(\"share\", \"value\", function () {\n  return global.portfolio && 100 * this.value / global.portfolio.total\n})\n\n/**\n * Helpers\n */\n\nasync function testNetwork () {\n  const horizon = cosmicLib.resolve.horizon()\n  try {\n    await axios.get(horizon)\n  } catch (error) {\n    throw new Error(__(\"Can't connect to the Stellar blockchain\"))\n  }\n}\n","\"use_strict\"\n/**\n * Anchor class\n */\nconst aliases = require(\"@cosmic-plus/base/aliases\")\nconst helpers = require(\"@cosmic-plus/jsutils/misc\")\nconst Projectable = require(\"@cosmic-plus/jsutils/projectable\")\n\n/**\n * Class\n */\n\nconst Anchor = module.exports = class Anchor extends Projectable {\n  static resolve (address) {\n    return Anchor.all[address] || new Anchor(address)\n  }\n\n  constructor (address) {\n    super()\n\n    this.address = address\n    this.alias = aliases.all[address]\n    this.name = helpers.shorter(this.alias || this.address)\n    Anchor.all[address] = this\n\n    this.assets = {}\n  }\n}\n\nAnchor.all = {}\n\n/**\n * Known Anchors\n */\n\nAnchor.known = {\n  \"USD:GDUKMGUGDZQK6YHYA5Z6AY2G4XDSZPSZ3SW5UN3ARVMO6QSRDWP5YLEX\": \"USD\",\n  \"WSD:GDSVWEA7XV6M5XNLODVTPCGMAJTNBLZBXOFNQD3BNPNYALEYBNT6CE2V\": \"USD\",\n  \"USD:GDSRCV5VTM3U7Y3L6DFRP3PEGBNQMGOWSRTGSBWX6Z3H6C7JHRI4XFJP\": \"USD\",\n  \"USD:GBUYUAI75XXWDZEKLY66CFYKQPET5JR4EENXZBUZ3YXZ7DS56Z4OKOFU\": \"USD\",\n  \"USD:GBSTRUSD7IRX73RQZBL3RQUH6KS3O4NYFY3QCALDLZD77XMZOPWAVTUK\": \"USD\",\n  \"CNY:GAREELUB43IRHWEASCFBLKHURCGMHE5IF6XSE7EXDLACYHGRHM43RFOX\": \"CNY\",\n  \"XCN:GCNY5OXYSY4FKHOPT2SPOQZAOEIGXB5LBYW3HVU3OWSTQITS65M5RCNY\": \"CNY\",\n  \"BCNY:GBCNYBHAAPDSU3UIHXXQTHYZVSBJBI4YUNWXMKJBCPDHTVYR75G6NFHD\": \"CNY\",\n  \"EURT:GAP5LETOV6YIE62YAM56STDANPRDO7ZFDBGSNHJQIYGGKSMOZAHOOS2S\": \"EUR\",\n\n  \"SLT:GCKA6K5PCQ6PNF5RQBF7PQDJWRHO6UOGFMRLK3DYHDOI244V47XKQ4GP\": null,\n  \"MOBI:GA6HCMBLTZS5VYYBCATRBRZ3BZJMAFUDKYYF6AH6MVCMGWMRDNSWJPIH\": null,\n  \"SHX:GDSTRSHXHGJ7ZIVRBXEYE5Q74XUVCUSEKEBR7UCHEUUEK72N7I7KJ6JH\": null,\n  \"RMT:GDEGOXPCHXWFYY234D2YZSPEJ24BX42ESJNVHY5H7TWWQSYRN5ZKZE3N\": null,\n  \"TERN:GDGQDVO6XPFSY4NMX75A7AOVYCF5JYGW2SHCJJNWCQWIDGOZB53DGP6C\": null,\n  \"PEDI:GBVUDZLMHTLMZANLZB6P4S4RYF52MVWTYVYXTQ2EJBPBX4DZI2SDOLLY\": null,\n  \"GRAT:GAJ7V3EMD3FRWAPBEJAP7EC4223XI5EACDZ46RFMY5DYOMCIMWEFR5II\": null,\n  \"REPO:GCZNF24HPMYTV6NOEHI7Q5RJFFUI23JKUKY3H3XTQAFBQIBOHD5OXG3B\": null,\n\n  \"BTC:GBSTRH4QOTWNSVA6E4HFERETX4ZLSR3CIUBLK7AXYII277PFJC4BBYOG\": null,\n  \"BTC:GATEMHCCKCY67ZUCKTROYN24ZYT5GK4EQZ65JJLDHKHRUZI3EUEKMTCH\": null,\n  \"BTC:GAUTUYY2THLF7SGITDFMXJVYH3LHDSMGEAKSBU267M2K7A3W543CKUEF\": null,\n  \"BTC:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P\": null,\n  \"BTC:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5\": null,\n  \"ETH:GBSTRH4QOTWNSVA6E4HFERETX4ZLSR3CIUBLK7AXYII277PFJC4BBYOG\": null,\n  \"ETH:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P\": null,\n  \"ETH:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5\": null,\n  \"ETH:GBETHKBL5TCUTQ3JPDIYOZ5RDARTMHMEKIO2QZQ7IOZ4YC5XV3C2IKYU\": null,\n  \"ETH:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null,\n  \"LTC:GC5LOR3BK6KIOK7GKAUD5EGHQCMFOGHJTC7I3ELB66PTDFXORC2VM5LP\": null,\n  \"LTC:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5\": null,\n  \"LTC:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P\": null,\n  \"XRP:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5\": null,\n  \"XRP:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P\": null,\n  \"KIN:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null,\n  \"BAT:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null,\n  \"ZRX:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null,\n  \"BCH:GAEGOS7I6TYZSVHPSN76RSPIVL3SELATXZWLFO4DIAFYJF7MPAHFE7H4\": null,\n  \"STEEM:GB3KBOFUCVTWEZ7YIZ7PAKLQMKPCTGWU3LOMANMCT7V6I3AAK4USTEEM\": null,\n  \"SBD:GB3KBOFUCVTWEZ7YIZ7PAKLQMKPCTGWU3LOMANMCT7V6I3AAK4USTEEM\": null,\n  \"LINK:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null\n}\n","\"use_strict\"\n/**\n * Account offers\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst loopcall = require(\"@cosmic-plus/loopcall\")\nconst Mirrorable = require(\"@cosmic-plus/jsutils/mirrorable\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/projectable\")\nconst { day } = require(\"@cosmic-plus/jsutils/misc\")\n\nconst Asset = require(\"./asset\")\nconst Balance = require(\"./balance\")\n\n/**\n * Class\n */\n\nclass Offer extends Projectable {\n  static async forPortfolio (portfolio) {\n    const offers = new Mirrorable()\n    const server = cosmicLib.resolve.server()\n    const callBuilder = server.offers(\"accounts\", portfolio.accountId)\n    await Offer.update(callBuilder, offers)\n    setInterval(() => Offer.update(callBuilder, offers), 5000)\n    return offers\n  }\n\n  static async update (callBuilder, offers) {\n    offers.forEach(offer => offer.opened = false)\n    await loopcall(callBuilder).then(records => {\n      records.forEach(record => Offer.ingest(record, offers))\n    })\n    offers.filter(offer => !offer.opened).forEach(offer => offer.destroy())\n  }\n\n  static async ingest (record, offers) {\n    const offer = Offer.table[recordToId(record)]\n    if (offer) offer.update(record)\n    else new Offer(record, offers)\n  }\n\n  constructor (record, offers) {\n    super()\n\n    const quote = Asset.resolve(\"XLM\")\n    const asset = record.buying.asset_code ? record.buying : record.selling\n    this.balance = Balance.resolve(asset.asset_code, asset.asset_issuer)\n    this.asset = this.balance.asset\n    this.side = record.buying.asset_code ? \"buy\" : \"sell\"\n    this.intern = recordToId(record)\n\n    this.define(\n      \"price\",\n      \"rawPrice\",\n      this.side === \"sell\"\n        ? () => quote.price * this.rawPrice\n        : () => quote.price / this.rawPrice\n    )\n    quote.trap(\"price\", () => this.compute(\"price\"))\n\n    this.update(record)\n\n    this.balance.offers.push(this)\n    this.asset.offers.push(this)\n    if (offers) offers.push(this)\n    Offer.table[this.intern] = this\n\n    this.listen(\"destroy\", () => {\n      this.balance.offers.splice(this.balance.offers.indexOf(this), 1)\n      this.asset.offers.splice(this.asset.offers.indexOf(this), 1)\n      if (offers) offers.splice(offers.indexOf(this), 1)\n      delete Offer.table[this.intern]\n    })\n  }\n\n  update (record) {\n    this.opened = true\n    Object.assign(this, record)\n    this.rawPrice = record.price\n    this.compute(\"price\")\n    this.rawAmount = record.amount\n    if (this.side === \"buy\") {\n      this.amount = nice(this.rawAmount * this.rawPrice, 7)\n    }\n\n    this.date = day(this.last_modified_time)\n    this.outdated = this.date !== day()\n  }\n}\n\nOffer.table = {}\n\n/**\n * Helpers\n */\n\nfunction recordToId (record) {\n  return `${record.id}/${assetToId(record.buying)}/${assetToId(record.selling)}`\n}\n\nfunction assetToId (asset) {\n  return asset.asset_issuer\n    ? `${asset.asset_code}:${asset.asset_issuer}`\n    : \"XLM\"\n}\n\n/**\n * Export\n */\n\nmodule.exports = Offer\n","\"use_strict\"\n/**\n * Activity Gui\n */\n\nconst Gui = require(\"@cosmic-plus/jsutils/gui\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst Tabs = require(\"@cosmic-plus/jsutils/tabs\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\nconst { CosmicLink } = require(\"cosmic-lib\")\n\nconst SideFrame = require(\"./side-frame\")\nconst global = require(\"./global\")\n\n/**\n * Class\n */\n\nclass ActivityGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section>\n  <h2>${__(\"Activity\")}</h2>\n  %selector\n  %view\n</section>\n    `)\n\n    this.portfolio = portfolio\n\n    const tabs = new Tabs()\n    // tabs.project([\"selector\", \"view\"], this)\n    tabs.project(\"view\", this)\n\n    tabs.add(\n      \"offers\",\n      __(\"Open Orders\"),\n      new ActivityGui.Offers(portfolio),\n      \"select\"\n    )\n    // tabs.add(\"orders\", __(\"Orders\"), new ActivityGui.Orders(portfolio))\n    // tabs.add(\"transfers\", __(\"Transfers\"), new ActivityGui.Transfers(portfolio))\n    // tabs.select(__(\"Orders\"))\n  }\n}\n\nActivityGui.Offers = class ActivityOffers extends Gui {\n  constructor (portfolio) {\n    super(`\n<section>\n  <table>\n    <tr>\n      <th>${__(\"Date\")}</th>\n      <th>${__(\"Asset\")}</th>\n      <th>${__(\"Direction\")}</th>\n      <th>${__(\"Amount\")}</th>\n      <th>${__(\"Price\")} (${global.currency})</th>\n    </tr>\n    %formatOffer:offers...\n    <tr><td colspan=\"5\" align=\"center\" onclick=%cancelOffers>\n      <h3>${__(\"Cancel All\")}</h3>\n    </td></tr>\n  </table>\n</section>\n\n<p class=\"note\">\n  ${__(\"All orders are passed against Stellar Lumens (XLM).\")}\n  ${__(\n    \"For your comfort, prices are displayed in their %%globalCurrency equivalent.\"\n  )}\n  ${__(\n    \"However, those converted values will change according to XLM price movement.\"\n  )}\n</p>\n    `)\n\n    this.portfolio = portfolio\n    this.offers = portfolio.offers\n    this.globalCurrency = global.currency\n  }\n\n  formatOffer (offer) {\n    return new ActivityGui.Offer(offer)\n  }\n\n  cancelOffers () {\n    if (!this.offers.length) return\n\n    const memo = \"Equilibre.io\"\n    const network = \"public\"\n    const source = this.portfolio.accountId\n    const operations = this.offers.map(offer => {\n      return { type: \"manageOffer\", offerId: offer.id, amount: 0 }\n    })\n\n    const cosmicLink = new CosmicLink({ memo, network, source, operations })\n    new SideFrame(cosmicLink.uri)\n  }\n}\n\nActivityGui.Offer = class ActivityOffer extends Gui {\n  constructor (offer) {\n    super(\n      `\n<tr>\n  <td>%formatDate:last_modified_time</td>\n  <td>\n    <img src=%image alt=\"\">\n    <span>%name / %anchor</span>\n  </td>\n  <td>%side</td>\n  <td align=\"right\">%nice:amount</td>\n  <td align=\"right\">%nice:price</td>\n</tr>\n    `,\n      offer\n    )\n\n    this.offer = offer\n\n    this.image = offer.asset.image\n    this.name = offer.asset.code\n    this.side = offer.side === \"buy\" ? __(\"Buy\") : __(\"Sell\")\n    this.anchor = offer.balance.anchor.name\n    this.date = new Date(offer.last_modified_time).toLocaleDateString()\n  }\n\n  nice (number) {\n    return nice(number)\n  }\n\n  formatDate (value) {\n    const date = value ? new Date(value) : new Date()\n    return date.toLocaleDateString()\n  }\n}\n\nActivityGui.Orders = class ActivityOrders extends Gui {\n  constructor (portfolio) {\n    super(`\n<table>\n  <tr>\n    <th>${__(\"Date\")}</th>\n    <th>${__(\"Asset\")}</th>\n    <th>${__(\"Direction\")}</th>\n    <th>${__(\"Amount\")}</th>\n    <th>${__(\"Price\")}</th>\n  </tr>\n  <tr>\n    <td colspan=\"6\"><h3><i18n>${__(\"Open Orders\")}</i18n></h3></td>\n  </tr>\n  %openOrders...\n  <tr>\n    <td colspan=\"6\"><h3><i18n>${__(\"Completed Orders\")}</i18n></h3></td>\n  </tr>\n  %completedOrders...\n</table>\n    `)\n    this.portfolio = portfolio\n  }\n}\n\nActivityGui.Transfers = class ActivityTransfers extends Gui {\n  constructor (portfolio) {\n    super(`\n<table>\n  <tr>\n    <th>${__(\"Date\")}</th>\n    <th>${__(\"Asset\")}</th>\n    <th>${__(\"With\")}</th>\n    <th>${__(\"Amount\")}</th>\n  </tr>\n  %transfers...\n</table>\n    `)\n    this.portfolio = portfolio\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = ActivityGui\n","\"use_strict\"\n/**\n * Portfolio Graphical User Interface\n */\nconst Highcharts = require(\"highcharts/highstock\")\n\nconst Gui = require(\"@cosmic-plus/jsutils/gui\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst Tabs = require(\"@cosmic-plus/jsutils/tabs\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst AssetGui = require(\"./asset-gui\")\nconst global = require(\"./global\")\nconst marketData = require(\"./market-data\")\n\n/**\n * Class\n */\n\nclass PortfolioGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section><h2>${__(\"Portfolio\")}: %total %currency</h2>\n  %summary\n  %chart\n\n  <p class=\"note\" align=\"center\">\n    ${__(\"Anchor prices are from Stellar DEX\")} /\n    ${__(\"Global prices are from %%coingecko when available.\")}\n    </p>\n\n</section>`)\n\n    this.portfolio = portfolio\n\n    portfolio.project(\"total\", this, x => nice(x, 2))\n    this.currency = global.currency\n    this.summary = new PortfolioGui.Summary(this)\n    this.coingecko = new Gui(\n      `<a target=\"_blank\" rel=\"noopener\" href=\"https://coingecko.com\">coingecko</a>`\n    )\n  }\n\n  select (asset) {\n    if (this.chart) this.chart.destroy()\n    if (asset && asset.globalPrice && asset.code !== global.currency) {\n      this.chart = new PortfolioGui.Chart(asset)\n    } else {\n      this.chart = null\n    }\n  }\n}\n\nPortfolioGui.Summary = class PortfolioSummary extends Gui {\n  constructor (parent) {\n    const tabs = new Tabs()\n    super(`%selector <section>%view</section>`, tabs)\n\n    tabs.add(\"table\", __(\"Table\"), new PortfolioGui.Table(parent))\n    tabs.add(\"graph\", __(\"Graph\"), () => new PortfolioGui.Graph(parent))\n    tabs.listen(\"select\", id => localStorage[\"PortfolioSummary.tab\"] = id)\n    tabs.select(localStorage[\"PortfolioSummary.tab\"] || \"table\")\n  }\n}\n\nPortfolioGui.Table = class PortfolioTable extends Gui {\n  constructor (parent) {\n    super(`\n<table>\n  <tr>\n    <th>${__(\"Name\")}</th>\n    <th>${__(\"Anchor\")}</th>\n    <th>${__(\"Amount\")}</th>\n    <th>${__(\"Price\")}</th>\n    <th>${__(\"Value\")}</th>\n  </tr>\n  %assetsGui...\n</table>\n`)\n\n    this.parent = parent\n\n    this.assetsGui = parent.portfolio.assets.mirror(asset => {\n      const assetGui = new AssetGui(asset)\n      assetGui.domNode.onclick = () => this.select(assetGui)\n      return assetGui\n    })\n\n    parent.portfolio.trap(\"total\", () => this.sort())\n  }\n\n  sort () {\n    this.assetsGui.sort((a, b) => b.asset.value - a.asset.value)\n  }\n\n  select (assetGui) {\n    if (this.selected) {\n      this.selected.domNode.className = \"\"\n      this.selected.simpleView()\n    }\n\n    if (this.selected === assetGui) {\n      this.parent.select()\n      this.selected = null\n    } else {\n      this.parent.select(assetGui.asset)\n      assetGui.domNode.className = \"selected\"\n      this.selected = assetGui\n      assetGui.detailledView()\n    }\n  }\n}\n\nPortfolioGui.Graph = class PortfolioGraph extends Gui {\n  constructor (parent) {\n    super(`<div -ref=%container align=\"center\"></div>`)\n    this.parent = parent\n    this.listen(\"destroy\", () => this.chart && this.chart.destroy())\n    parent.portfolio.trap(\"total\", () => {\n      // For some unknow reason the timeout makes the chart draw better.\n      setTimeout(() => this.makePie(), 1)\n    })\n  }\n\n  makePie () {\n    if (this.chart) this.chart.destroy()\n    this.chart = Highcharts.chart(this.container, {\n      title: \"\",\n      chart: {\n        type: \"pie\",\n        backgroundColor: \"#fbfbfd\"\n      },\n      colors: [\n        \"rgba(231,  76,  60, 0.8)\",\n        \"rgba(230, 126,  34, 0.8)\",\n        \"rgba(242, 202,  39, 0.8)\",\n        \"rgba(46,  204, 112, 0.8)\",\n        \"rgba(52,  152, 219, 0.8)\",\n        \"rgba(155,  89, 182, 0.8)\",\n\n        \"rgba(231,  76,  60, 0.6)\",\n        \"rgba(230, 126,  34, 0.6)\",\n        \"rgba(242, 202,  39, 0.6)\",\n        \"rgba(46,  204, 112, 0.6)\",\n        \"rgba(52,  152, 219, 0.6)\",\n        \"rgba(155,  89, 182, 0.6)\",\n\n        \"rgba(231,  76,  60, 0.4)\",\n        \"rgba(230, 126,  34, 0.4)\",\n        \"rgba(242, 202,  39, 0.4)\",\n        \"rgba(46,  204, 112, 0.4)\",\n        \"rgba(52,  152, 219, 0.4)\",\n        \"rgba(155,  89, 182, 0.4)\"\n      ],\n      tooltip: {\n        style: { fontSize: \"14px\" },\n        pointFormat: `\n${__(\"Amount\")}: {point.niceAmount} {point.code}<br>\n${__(\"Price\")}: {point.nicePrice} ${global.currency}<br>\n<b>${__(\"Value\")}: {point.y} ${global.currency}</b>\n`\n      },\n      plotOptions: {\n        pie: {\n          allowPointSelect: true,\n          animation: false,\n          cursor: \"pointer\",\n          dataLabels: {\n            enabled: true,\n            format:\n              \"{point.niceAmount} {point.code}<br>({point.percentage:.0f}%)\",\n            style: { fontSize: \"14px\" }\n          },\n          point: {\n            events: {\n              select: x => this.parent.select(x.target.options)\n            }\n          }\n        }\n      },\n      series: [\n        {\n          name: __(\"Amount\"),\n          colorByPoint: true,\n          ignoreHiddenPoint: true,\n          data: this.parent.portfolio.assets\n            .filter(asset => asset.value)\n            .map(makeAssetPoint)\n            .sort((a, b) => b.value - a.value)\n        }\n      ],\n      credits: { enabled: false }\n    })\n  }\n}\n\nfunction makeAssetPoint (asset) {\n  const assetPoint = Object.create(asset)\n  assetPoint.y = Number(nice(asset.value, 2))\n  assetPoint.niceAmount = nice(asset.amount)\n  assetPoint.nicePrice = nice(asset.price)\n  return assetPoint\n}\n\nPortfolioGui.Chart = class PortfolioChart extends Gui {\n  constructor (asset) {\n    super(`\n      <section><h3>${asset.code} ${__(\"to\")} ${global.currency}</h3>\n        <div -ref=%container><p>${__(\"Loading...\")}</p></div>\n      </section>\n    `)\n\n    this.asset = asset\n    this.listen(\"destroy\", () => this.chart && this.chart.destroy())\n    marketData.assetHistory(asset).then(data => this.makeChart(data))\n  }\n\n  makeChart (data) {\n    this.chart = Highcharts.stockChart(this.container, {\n      rangeSelector: { selected: 2 },\n      chart: {\n        backgroundColor: \"#fbfbfd\"\n      },\n      yAxis: [\n        { labels: { align: \"left\" }, height: \"80%\", resize: { enabled: true } },\n        { labels: { align: \"left\" }, top: \"80%\", height: \"20%\", offset: 0 }\n      ],\n      series: [\n        {\n          type: \"spline\",\n          name: \"Price\",\n          data: data.map(x => [x.time, +nice(x.price)])\n        },\n        {\n          type: \"column\",\n          name: \"Volume\",\n          data: data.map(x => [x.time, x.volume]),\n          yAxis: 1\n        }\n      ],\n      credits: { enabled: false }\n    })\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = PortfolioGui\n","\"use_strict\"\n/**\n * Asset GUI\n */\nconst Gui = require(\"@cosmic-plus/jsutils/gui\")\nconst html = require(\"@cosmic-plus/jsutils/html\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst msg = require(\"@cosmic-plus/i18n\").__\n\n/**\n * Class\n */\n\nclass AssetGui extends Gui {\n  constructor (asset) {\n    super(`\n<tr %style>\n  <td align=\"left\">\n    <img src=%image alt=\"\">\n    <span>%name</span>\n  </td>\n  <td align=\"left\">\n    <div hidden=%simple>%anchors...</div>\n    <div %class>%anchorTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%amounts...</div>\n    <div %class>%amountTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%prices...</div>\n    <div %class title=%priceDetails>%priceTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%values...</div>\n    <div %class>%valueTotal</div>\n  </td>\n</tr>\n    `)\n\n    this.asset = asset\n\n    this.image = asset.image\n    this.name = asset.code\n    this.anchors = asset.balances.mirror(x => cell(x.anchor, \"name\"))\n    this.amounts = asset.balances.mirror(x => cell(x, \"amount\", nice))\n    this.prices = asset.balances.mirror(x => priceCell(x, \"price\", nice))\n    this.values = asset.balances.mirror(x => cell(x, \"value\", x => nice(x, 2)))\n    asset.link(\"amount\", this, \"amountTotal\", nice)\n    asset.link(\"price\", this, \"priceTotal\", nice)\n    asset.link(\"value\", this, \"valueTotal\", x => nice(x, 2))\n    asset.anchors.feed(this, \"anchorHeader\", anchorName)\n\n    this.priceDetails = \"\"\n    const orderbook = this.asset.orderbook\n    if (orderbook) {\n      orderbook.trap(\n        [\"bestAsk\", \"bestBid\", \"spread%\"],\n        () => this.priceDetails = priceDetails(orderbook)\n      )\n    }\n\n    this.simpleView()\n  }\n\n  simpleView () {\n    this.simple = true\n    this.class = \"\"\n    this.anchorTotal = this.anchorHeader\n  }\n\n  detailledView () {\n    this.simple = false\n    this.class = \"footer\"\n    this.anchorTotal = \"Total\"\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = AssetGui\n\n/**\n * Helpers\n */\n\nfunction anchorName (anchors) {\n  if (anchors.length === 1) return anchors[0].name\n  else return `${msg(\"Multiple\")} (${anchors.length})`\n}\n\nfunction cell (object, key, func) {\n  const node = html.create(\"div\", null, object[key])\n  object.link(key, node, \"textContent\", func)\n  return node\n}\n\nfunction priceCell (object, key, func) {\n  const node = cell(object, \"price\", func)\n  object.trap(\"orderbook\", () => {\n    if (object.orderbook)\n      object.orderbook.trap(\n        [\"bestAsk\", \"bestBid\", \"spread%\"],\n        () => node.title = priceDetails(object.orderbook)\n      )\n  })\n  return node\n}\n\nfunction priceDetails (orderbook) {\n  if (orderbook.base.code === \"XLM\") return \"\"\n  return `\nBuy: ${nice(orderbook.bestBid)} \\\n- Sell: ${nice(orderbook.bestAsk)} \\\n- Spread: ${nice(orderbook[\"spread%\"], 2)}%\n  `\n}\n","\"use_strict\"\n/**\n * Settings Graphical User Interface\n */\nconst Gui = require(\"@cosmic-plus/jsutils/gui\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./global\")\n\n/**\n * Class\n */\n\nclass SettingsGui extends Gui {\n  constructor () {\n    super(`\n      <section><h2>${__(\"Settings\")}</h2>\n        <section><h3>${__(\"General Settings\")}</h3>\n          <form>\n            <label><span>${__(\"Language\")}:</span>\n              <select value=%language>\n                <option value=\"us\">English</option>\n                <option value=\"fr\">Français</option>\n              </select>\n            </label>\n            <label><span>${__(\"Currency\")}:</span>\n              <select value=%currency>\n                <option value=\"CNY\">CNY</option>\n                <option value=\"EUR\">EUR</option>\n                <option value=\"USD\">USD</option>\n              </select>\n            </label>\n          </form>\n        </section>\n      </section>\n    `)\n\n    // Two-way binding\n    global.project([\"currency\", \"language\"], this)\n    this.project([\"currency\", \"language\"], global)\n\n    // Refresh interface\n    this.listen(\"change:currency\", () => location.reload())\n    this.listen(\"change:language\", () => location.reload())\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = SettingsGui\n","\"use_strict\"\n/**\n * Share Graphical User Interface\n */\nconst Gui = require(\"@cosmic-plus/jsutils/gui\")\nconst i18n = require(\"@cosmic-plus/i18n\")\nconst html = require(\"@cosmic-plus/jsutils/html\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst { __ } = i18n\n\nconst SideFrame = require(\"./side-frame\")\nconst global = require(\"./global\")\nconst Order = require(\"./order\")\nconst Share = require(\"./share\")\n\n/**\n * Class\n */\n\nclass RebalanceGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section class=\"RebalanceGui\">\n  <h2>${__(\"Rebalance\")}</h2>\n  %table\n  <section hidden=%hideSection>\n    <div class=\"errors\">%formatError:errors...</div>\n    <form onsubmit=%rebalance hidden=%hideRebalance>\n      <button type=\"submit\" disabled=%block>${__(\"Rebalance\")}</button>\n    </form>\n    <form onsubmit=%apply hidden=%hideApply>\n      <button type=\"submit\" disabled=%block>${__(\"Apply\")}</button>\n      <button onclick=%cancel>${__(\"Cancel\")}</button>\n    </form>\n  </section>\n  %setupGui\n</section>\n    `)\n\n    this.portfolio = portfolio\n    const template = localStorage[`target:${portfolio.account.id}`]\n    this.share = Share.forPortfolio(portfolio, template)\n\n    this.table = new RebalanceGui.Table(this)\n    this.table.project(\"selected\", this)\n    this.project(\"selected\", this.table)\n\n    this.errors = this.share.errors\n    this.errors.feed(this, \"block\", errors => !!errors.length)\n\n    this.define(\"hideRebalance\", [\"selected\", \"modified\"], () => {\n      return this.selected || this.modified\n    })\n    this.define(\"hideApply\", [\"selected\", \"modified\"], () => {\n      return this.selected || !this.modified\n    })\n    this.define(\"hideSection\", [\"hideRebalance\", \"hideApply\"], () => {\n      return this.hideRebalance && this.hideApply\n    })\n\n    this.share.project(\"modified\", this)\n\n    this.define(\"setupGui\", \"selected\", () => {\n      if (this.setupGui) this.setupGui.destroy()\n      return this.selected && new ShareGui.Setup(this.selected, this)\n    })\n  }\n\n  formatError (error) {\n    return new Gui(`<div class=\"error\">%error</div>`, { error })\n  }\n\n  cancel () {\n    location.reload()\n    return false\n  }\n\n  apply () {\n    try {\n      const accountId = this.portfolio.account.id\n      localStorage[\n        `target:${accountId}`\n      ] = this.share.template = this.share.toString()\n      this.share.modified = false\n    } catch (error) {\n      console.error(error)\n    }\n    return false\n  }\n\n  rebalance () {\n    try {\n      const operations = listOperations(this.share)\n      const outdated = this.portfolio.offers.filter(offer => offer.outdated)\n      const remaining = outdated.filter(offer => {\n        return !operations.find(op => op.offer.id === offer.id)\n      })\n      operations.forEach(op => {\n        if (!op.offer.id && remaining.length) op.offer.id = remaining.pop().id\n      })\n\n      if (!operations.length) return false\n      const cosmicLink = Order.operationsToCosmicLink(operations)\n      remaining.forEach(offer => {\n        cosmicLink.addOperation(\"manageOffer\", { amount: 0, offerId: offer.id })\n      })\n      if (cosmicLink) new SideFrame(cosmicLink.uri)\n    } catch (error) {\n      console.error(error)\n    }\n    return false\n  }\n}\n\nfunction listOperations (share) {\n  let operations = []\n  share.childs.forEach(child => {\n    if (child.order) operations = operations.concat(child.order.operations)\n  })\n  return operations\n}\n\nRebalanceGui.Table = class RebalanceTable extends Gui {\n  constructor (parent) {\n    super(`\n<section class=\"RebalanceTable\">\n  <table>\n    <tr>\n      <th>${__(\"Name\")}</th>\n      <th>${__(\"Goal\")}</th>\n      <th>${__(\"Divergence\")}</th>\n      <th>${__(\"Operation\")}</th>\n    </tr>\n    %formatShare:shares...\n    <tr hidden=true>\n      <td align=\"center\" colspan=\"4\"><h3>${__(\"Add Asset\")}</h3></td>\n    </tr>\n  </table>\n</section>\n    `)\n\n    this.selected = undefined\n    this.shares = parent.share.childs\n    this.sortShares(this.shares)\n    parent.share.listen(\"update\", () => this.sortShares(this.shares))\n  }\n\n  formatShare (share) {\n    const shareGui = new ShareGui(share)\n    shareGui.domNode.onclick = () => this.selected = share\n    return shareGui\n  }\n\n  sortShares (array) {\n    return array.sort((a, b) => b.goal - a.goal || a.globalPrice)\n  }\n}\n\nclass ShareGui extends Gui {\n  constructor (share) {\n    super(`\n<tr class=\"ShareGui\">\n  <td align=\"left\">\n    <img src=%image alt=\"\">\n    <span>%name</span>\n  </td>\n  <td align=\"right\">%goal%</td>\n  <td align=\"right\">%divergence</td>\n  <td align=\"right\">%description...</td>\n</tr>\n    `)\n\n    this.share = share\n\n    this.image = share.asset.image\n    this.name = share.name || share.asset && share.asset.code\n    share.project(\"goal\", this, x => nice(x, 2))\n    share.project(\"divergence\", this, x => {\n      return x == null ? \"-\" : nice(x * 100, 2) + \"%\"\n    })\n\n    share.trap(\"order\", () => {\n      if (!share.order) {\n        this.cosmicLink = this.description = null\n      } else {\n        share.order.project(\"cosmicLink\", this)\n        share.order.project(\"description\", this, descriptionToList)\n      }\n    })\n  }\n}\n\nShareGui.Setup = class ShareSetup extends Gui {\n  constructor (share, parent) {\n    super(`\n<section><h3>%assetName</h3>\n  <hr>\n  <form onsubmit=%close>\n    <label><span>${__(\"Size\")}:</span>\n      <input class=\"half\" type=\"number\" step=\"any\" min=\"0\" %max value=%size\n       placeholder=%goal onchange=%switchMode>\n      <select class=\"half\" onchange=%setMode value=%mode>\n        <option value=\"equal\">${__(\"Equal Share\")}</option>\n        <option value=\"percentage\">${__(\"Percentage\")}</option>\n        <option value=\"amount\">${__(\"Amount\")}</option>\n      </select>\n    </label>\n\n    <hr>\n\n    <input type=\"submit\" value=\"${__(\"Close\")}\">\n  </form>\n</section>\n    `)\n\n    this.parent = parent\n    this.share = share\n\n    this.assetName = share.asset.name\n\n    share.project(\"goal\", this, x => nice(x, 2))\n\n    share.project(\"size\", this)\n    this.project(\"size\", share, x => x != null ? Number(x) : null)\n\n    share.project(\"mode\", this, mode => mode || \"equal\")\n    this.project(\"mode\", share)\n  }\n\n  switchMode () {\n    if (this.size && this.mode === \"equal\") this.mode = \"percentage\"\n  }\n\n  setMode () {\n    switch (this.mode) {\n    case \"equal\":\n      this.size = null\n      break\n    case \"percentage\":\n      this.size = +nice(100 * this.share.value / global.portfolio.total, 2)\n      this.max = 100\n      break\n    case \"amount\":\n      this.size = this.share.asset.amount\n      this.max = null\n      break\n    }\n  }\n\n  close () {\n    this.switchMode()\n    this.parent.selected = null\n    return false\n  }\n}\n\n/**\n * Helpers\n */\n\nfunction descriptionToList (description) {\n  return description.map(e => html.create(\"div\", null, e))\n}\n\n/**\n * Export\n */\n\nmodule.exports = RebalanceGui\n","\"use_strict\"\n/**\n * Share class.\n *\n * A (portfolio) Share object represents a statically or dynamically allocated\n * share of the user portfolio. It is a theoric goal that the rebalancing\n * process aims to reach as much as possible.\n *\n * A Share may be composed by several Share subentries, in such a way that the\n * complete portfolio balancing target ends up being a tree made of Shares.\n */\nconst Mirrorable = require(\"@cosmic-plus/jsutils/mirrorable\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/projectable\")\n\nconst Asset = require(\"./asset\")\nconst Order = require(\"./order\")\nconst strategy = require(\"./strategy\")\n\n/**\n * Share sizing attributes:\n * size, sizeMin, sizeMax, sizeLock\n * amountMin, amountMax, amountLock\n *\n * Strategies: equal, marketCap,... (inertia, change7D, RSI)\n * Filters: change30d, RSI\n */\n\nconst Share = module.exports = class Share extends Projectable {\n  static forPortfolio (portfolio, template) {\n    const share = template ? Share.fromString(template) : new Share()\n    share.portfolio = portfolio\n    share.errors = new Mirrorable()\n    share.goal = 100\n\n    portfolio.share = share\n    portfolio.trap(\"total\", () => share.compute(portfolio.total))\n\n    // Add/Remove assets after trustline change.\n    portfolio.assets.forEach(asset => {\n      if (\n        !share.childs.find(child => asset === child.asset)\n        && asset.isSupported\n      )\n        share.childs.push(new Share(asset))\n    })\n    share.childs.forEach((child, index) => {\n      if (\n        !portfolio.assets.find(asset => asset === child.asset)\n        || !child.asset.isSupported\n      )\n        share.childs.splice(index, 1)\n    })\n    portfolio.assets.listen(\"add\", asset => {\n      if (asset.isValid) share.childs.push(new Share(asset))\n    })\n    portfolio.assets.listen(\"remove\", asset => {\n      const index = share.childs.findIndex(child => child.asset === asset)\n      share.childs.splice(index, 1)\n    })\n\n    return share\n  }\n\n  constructor (asset) {\n    super()\n\n    if (asset) {\n      this.asset = asset\n      this.mode = \"amount\"\n      this.size = asset.amount\n      this.order = Order.rebalance(this)\n      asset.shares.push(this)\n      asset.project(\"value\", this)\n    } else {\n      this.childs = new Mirrorable()\n      this.childs.listen(\"add\", child => {\n        child.parent = this\n        this.compute()\n      })\n    }\n\n    // Normalize & compute\n    this.trap(\"size\", () => {\n      if (this.size) {\n        this.size = Math.max(0, this.size)\n        if (this.mode === \"percentage\") this.size = Math.min(100, this.size)\n      }\n      this.compute()\n    })\n  }\n\n  get root () {\n    if (this.parent) return this.parent.root\n    else return this\n  }\n\n  compute () {\n    if (this.parent) {\n      this.parent.compute()\n    } else if (this.portfolio && this.portfolio.total) {\n      this.errors.splice(0, this.errors.length)\n      this.modified = this.hasChanged()\n      strategy.apply(this, this.portfolio.total)\n    }\n  }\n\n  hasChanged () {\n    return this.template !== this.toString()\n  }\n\n  static fromString (string) {\n    const template = JSON.parse(string)\n    const share = Share.fromTemplate(template)\n    share.template = string\n    return share\n  }\n\n  static fromTemplate (template) {\n    if (typeof template === \"string\") template = { asset: template }\n\n    const share = template.asset\n      ? new Share(Asset.resolve(template.asset))\n      : new Share()\n\n    share.size = template.size\n    share.mode = template.mode\n\n    if (!template.asset) {\n      share.name = template.group\n      template.childs.forEach(entry =>\n        share.childs.push(Share.fromTemplate(entry))\n      )\n    }\n\n    return share\n  }\n\n  toString (beautify) {\n    const template = this.toTemplate()\n    return JSON.stringify(template, null, beautify && 2)\n  }\n\n  toTemplate () {\n    let template = {}\n\n    if (this.size != null) template.size = this.size\n    if (this.mode != null && this.mode !== \"equal\") template.mode = this.mode\n\n    if (this.asset) {\n      template.asset = this.asset.code\n      if (Object.keys(template).length === 1) template = template.asset\n    } else if (this.childs) {\n      if (this.name) template.group = this.name\n      template.childs = this.childs.map(share => share.toTemplate())\n    }\n\n    return template\n  }\n}\n\nShare.define(\"delta\", [\"value\", \"target\"], function () {\n  return +nice(this.value - this.target, 7)\n})\nShare.define(\"divergence\", [\"delta\", \"target\"], function () {\n  return this.target ? this.delta / this.target : null\n})\n\n/*\n[\n  {\n    \"group\": \"Fiats\"\n    \"size\": \"50\",\n    \"childs\": [\n      { \"asset\": \"USD\", \"size\": \"30\", \"min\": { \"amount\": \"2000\" }},\n      { \"asset\": \"EUR\", \"size\": \"20\", \"min\": { \"amount\": \"500\" }},\n      { \"asset\": \"CNY\", \"size\": \"20\" },\n      { \"asset\": \"GBP\", \"size\": \"20\" }\n  },\n  {\n    //\"group\": \"Native\"\n    \"size\": \"25\",\n    \"strategy\": \"marketCap\",\n    \"childs\": [\"XLM\", \"SLT\", \"MOBI\"]\n  },\n  {\n    //\"group\": \"Tether\",\n    \"size\": \"25\",\n    \"strategy\": [[\"marketCap\", 25], [\"equal\", 25], [\"change7D\", 25], [\"inertia\", 25]],\n    \"childs\": [{ \"asset\": \"BTC\", \"min\": { \"amount\": \"0.05\", \"size\": \"20\" }}, \"ETH\", [10, \"byMarketCap\"]]\n  }\n]\n\n[\n  {\n    \"group\": \"Fiat\",\n    \"size\": 50,\n    \"strategy\": \"equal\",\n    \"childs\": [\"USD\", \"EUR\", \"GBP\", \"CNY\"]\n  },\n  {\n    \"group\": \"Native\",\n    \"size\": 20,\n    \"strategy\": [[\"marketCap\", 25], [\"equal\", 25], [\"inertia\", 50]]\n  }\n  { \"asset\": \"BTC\", \"size\": 10 },\n  { \"asset\": \"ETH\", \"size\": 5 },\n  { \"asset\": \"XRP\", \"size\": 3 }\n]\n\n*/\n","\"use_strict\"\n/**\n * Rebalancing strategies\n */\nconst strategy = exports\n\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nstrategy.apply = function (share, total) {\n  if (!share.childs) return share.target = total\n\n  let used = 0\n  const computed = []\n  const remaining = []\n  const strat = share.mode || \"equal\"\n\n  share.childs.forEach(child => {\n    if (child.mode === \"skip\" || child.mode === \"amount\") {\n      child.target =\n        child.size != null\n          ? child.asset.price * child.size\n          : child.asset.price * child.asset.amount\n      child.goal = 100 * child.target / total\n      if (child.goal > 100) {\n        child.root.errors.push(\n          `${child.asset.code}: ${__(\"Order over portfolio total\")}`\n        )\n      }\n      used += child.goal\n    } else if (child.size != null) {\n      child.goal = child.size\n      used += child.size\n      computed.push(child)\n    } else {\n      remaining.push(child)\n    }\n  })\n\n  if (total < 0) throw new Error(\"Rebalancing impossible\")\n\n  if (used > 100 || used !== 100 && !remaining.length) {\n    makeTotal100(computed, used)\n    remaining.forEach(share => share.goal = 0)\n  } else if (remaining.length) {\n    method[strat](remaining, 100 - used)\n  }\n\n  computed.concat(remaining).forEach(child => {\n    strategy.apply(child, total * child.goal / 100)\n  })\n}\n\nfunction makeTotal100 (targets, used) {\n  const space = 100 - used\n  targets.forEach(target => target.goal += space * target.goal / used)\n}\n\n/*******************************************************************************\n * Strategies\n */\n\nconst method = {}\n\nmethod.equal = function (shares, space) {\n  const goal = space / shares.length\n  shares.forEach(share => share.goal = goal)\n}\n","\"use_strict\"\n/**\n * Footer\n */\nconst { CosmicLink } = require(\"cosmic-lib\")\n\nconst Gui = require(\"@cosmic-plus/jsutils/gui\")\nconst html = require(\"@cosmic-plus/jsutils/html\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst SideFrame = require(\"./side-frame\")\n\nconst MYPUBKEY = \"GAWO2C52D57XBT7SQL6YB3XPHFLFD2J4Z5RN7HPFZSHXJMXH72HRXNV3\"\n\n/**\n * Class\n */\n\nclass Footer extends Gui {\n  constructor (icons, links) {\n    super(\n      `\n      <footer id=\"footer\" class=\"scrollable\">\n        <div class=\"nobreak\">%icons...</div>\n        %links\n      </footer>\n    `,\n      { icons, links }\n    )\n  }\n}\n\n/**\n * Footer Icons\n */\n\nclass Icon extends Gui {\n  constructor (title, href, svg) {\n    super(\n      `<a class=\"Icon\" %href %title target=\"_blank\" rel=\"noopener\">%svg</a>`,\n      { title, href, svg }\n    )\n  }\n}\n\n/**\n * Donate\n */\n\nfunction donate () {\n  const amount = prompt(`\\\n${__(\"Equilibre.io runs on donation.\")}\n\n${__(\n    \"Please contribute to its development according to what you think the service worth.\"\n  )}\n\n${__(\"Enter an amount (in Lumens)\")}:\n`)\n\n  if (isNaN(Number(amount))) {\n    confirm(`${__(\"Not a valid amount\")}: ${amount}`)\n  } else if (amount) {\n    const cosmicLink = new CosmicLink({\n      memo: __(\"Donation to Equilibre.io\"),\n      network: \"public\"\n    }).addOperation(\"payment\", { amount, destination: MYPUBKEY })\n    new SideFrame(cosmicLink.uri)\n  }\n}\n\nconst donateIcon = new Gui(`<a class=\"Icon\" %title %onclick>%svg</a>`, {\n  title: __(\"Donate\"),\n  svg: new Gui(\n    `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path fill=\"none\" d=\"M0 0h512v512H0z\"/><path d=\"M211.719 367.797C219.469 379.281 224 393.109 224 408c0 39.734-32.266 72-72 72-39.758 0-72-32.266-72-72 0-23.172 11.148-43.563 28.164-56.734 1.852 5.594 4.336 11.125 8.289 15.906 7.055 8.516 20.336 18.266 43.531 16.344 7.578-.641 15.844-2.547 24.586-5.641 8.875-3.078 18.508-6.5 27.149-10.078zM389.875 32.578c-13.344 3.797-24.156 10.672-38.813 18.328-90 47-196.25 39.25-220 77-27.469 51.672-48.883 89.203-48.945 107.625-.016.063-.055.094-.07.141.586 19.953 19.625 58.438 29.07 75.969 6.789-15.516 17.492-29.219 32.25-40.688 7.414-5.766 13.289-9.922 18.617-13.5-3.016-9.25-6.945-20.016-10.875-28.203 10.742-7.391 26.078-26.484 31.398-40.313 13.227.094 30.25-3.172 44.773-6.938 6.406 6.844 12.977 13.563 21.766 20.016-3.961 14.344-7.07 27.063-23.438 38.359-22.313 15.438-42.734 21.578-69.484 43.109-16.086 12.953-26.07 28.203-30.625 45.641-3.148 12.094 4.734 53.016 58 33.141 10.023-3.75 23.398-8.531 34.875-14.25 23.797-11.813 52.922-40.781 61-44.828 15.234-7.641 49.813-10.656 86.313-35.016 12.531-8.375 22.063-20.688 26.477-33.625 33.242-64.828 60.883-59.656 68.633-72.563C477.734 133.734 423.563 23 389.875 32.578z\"/></svg>`\n  ),\n  onclick: donate\n})\n\n/**\n * Icons\n *\n * SVG from @fortawesome/font-awesome-free\n * CC BY 4.0 License (https://creativecommons.org/licenses/by/4.0/)\n */\n\nconst icons = [\n  new Icon(\n    \"Keybase\",\n    \"https://keybase.io/team/cosmic_plus\",\n    new Gui(\n      `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 412.3 512\"><path d=\"M177.2 430.9c0 9.8-8 17.8-17.8 17.8s-17.8-8-17.8-17.8 8-17.8 17.8-17.8c9.8-.1 17.8 7.9 17.8 17.8zM270 413c-9.8 0-17.8 8-17.8 17.8s8 17.8 17.8 17.8 17.8-8 17.8-17.8-8-17.8-17.8-17.8zm142.3-36c0 38.9-7.6 73.9-22.2 103h-27.3c23.5-38.7 30.5-94.8 22.4-134.3-16.1 29.5-52.1 38.6-85.9 28.8-127.8-37.5-192.5 19.7-234.6 50.3l18.9-59.3-39.9 42.3c4.8 26.7 15.7 51.3 31.2 72.3H46.1c-9.7-15.8-17.2-33-22.2-51.3L.1 454c0-74.9-5.5-147.6 61.5-215.2 20.2-20.4 43.7-36.2 69.1-46.7-6.8-13.5-9.5-29.2-7.8-46l-19.9-1.2c-17.9-1.1-31.6-16.5-30.6-34.4v-.1L74 84.2c1.1-17.1 15.4-30.6 32.5-30.6 1.3 0-.3-.1 28.2 1.7 13.9.8 21.5 9.8 22.8 11.4 7.1-10.4 14.5-20.5 24.6-34.5l20.6 12.1c-13.6 29-9.1 36.2-9 36.3 3.9 0 13.9-.5 32.4 5.7C246 92.9 262 107 271 126c.4.9 15.5 29 1.2 62.6 19 6.1 51.3 19.9 82.4 51.8 36.6 37.6 57.7 87.4 57.7 136.6zM128 122.3c3.2-10 7.7-19.7 13.1-29.4.1-2 2.2-13.1-7.8-13.8-28.5-1.8-26.3-1.6-26.7-1.6-4.6 0-8.3 3.5-8.6 8.1l-1.6 26.2c-.3 4.7 3.4 8.8 8.1 9.1l23.5 1.4zm25.8 61.8c5.6 9.4 14.1 16.1 22.3 20 0-21.2 28.5-41.9 52.8-17.5l8.4 10.3c20.8-18.8 19.4-45.3 12.1-60.9-13.8-29.1-46.9-32-54.3-31.7-10.3.4-19.7-5.4-23.7-15.3-13.7 21.2-37.2 62.5-17.6 95.1zm82.9 68.4L217 268.6c-1.9 1.6-2.2 4.4-.6 6.3l8.9 10.9c1 1.2 3.8 2.7 6.3.6l19.6-16 5.5 6.8c4.9 6 13.8-1.4 9-7.3-63.6-78.3-41.5-51.1-55.3-68.1-4.7-6-13.9 1.4-9 7.3 1.9 2.3 18.4 22.6 19.8 24.3l-9.6 7.9c-4.6 3.8 2.6 13.3 7.4 9.4l9.7-8 8 9.8zm118.4 25.7c-16.9-23.7-42.6-46.7-73.4-60.4-7.9-3.5-15-6.1-22.9-8.6-2 2.2-4.1 4.3-6.4 6.2l31.9 39.2c10.4 12.7 8.5 31.5-4.2 41.9-1.3 1.1-13.1 10.7-29 4.9-2.9 2.3-10.1 9.9-22.2 9.9-8.6 0-16.6-3.8-22.1-10.5l-8.9-10.9c-6.3-7.8-7.9-17.9-5-26.8-8.2-9.9-8.3-21.3-4.6-30-7.2-1.3-26.7-6.2-42.7-21.4-55.8 20.7-88 64.4-101.3 91.2-14.9 30.2-18.8 60.9-19.9 90.2 8.2-8.7-3.9 4.1 114-120.9l-29.9 93.6c57.8-31.1 124-36 197.4-14.4 23.6 6.9 45.1 1.6 56-13.9 11.1-15.6 8.5-37.7-6.8-59.3zM110.6 107.3l15.6 1 1-15.6-15.6-1-1 15.6z\"/></svg>`\n    )\n  ),\n  new Icon(\n    \"Telegram\",\n    \"https://t.me/cosmic_plus\",\n    new Gui(\n      `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\"><path d=\"M446.7 98.6l-67.6 318.8c-5.1 22.5-18.4 28.1-37.3 17.5l-103-75.9-49.7 47.8c-5.5 5.5-10.1 10.1-20.7 10.1l7.4-104.9 190.9-172.5c8.3-7.4-1.8-11.5-12.9-4.1L117.8 284 16.2 252.2c-22.1-6.9-22.5-22.1 4.6-32.7L418.2 66.4c18.4-6.9 34.5 4.1 28.5 32.2z\"/></svg>`\n    )\n  ),\n  new Icon(\n    \"Reddit\",\n    \"https://reddit.com/r/cosmic_plus\",\n    new Gui(\n      `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path d=\"M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z\"/></svg>`\n    )\n  ),\n  new Icon(\n    \"Twitter\",\n    \"https://twitter.com/cosmic_plus\",\n    new Gui(\n      `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path d=\"M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z\"/></svg>`\n    )\n  ),\n  new Icon(\n    \"Medium\",\n    \"https://medium.com/cosmic-plus\",\n    new Gui(\n      `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\"><path d=\"M0 32v448h448V32H0zm372.2 106.1l-24 23c-2.1 1.6-3.1 4.2-2.7 6.7v169.3c-.4 2.6.6 5.2 2.7 6.7l23.5 23v5.1h-118V367l24.3-23.6c2.4-2.4 2.4-3.1 2.4-6.7V199.8l-67.6 171.6h-9.1L125 199.8v115c-.7 4.8 1 9.7 4.4 13.2l31.6 38.3v5.1H71.2v-5.1l31.6-38.3c3.4-3.5 4.9-8.4 4.1-13.2v-133c.4-3.7-1-7.3-3.8-9.8L75 138.1V133h87.3l67.4 148L289 133.1h83.2v5z\"/></svg>`\n    )\n  ),\n  new Icon(\n    \"GitHub\",\n    \"https://github.com/cosmic-plus/webapp-equilibre-io\",\n    new Gui(\n      `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 496 512\"><path d=\"M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z\"/></svg>`\n    )\n  ),\n  new Icon(\n    __(\"Website\"),\n    \"https://cosmic.plus\",\n    new Gui(\n      `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 496 512\"><path d=\"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z\"/></svg>`\n    )\n  ),\n  new Icon(\n    __(\"Email\"),\n    \"mailto:mister.ticot@cosmic.plus\",\n    new Gui(\n      `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path d=\"M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z\"/></svg>`\n    )\n  ),\n  donateIcon\n]\n\n/**\n * Demo Page\n */\nfunction displayDemo () {\n  localStorage[`target:${MYPUBKEY}`] = demoConfig\n  location.href = `?address=${MYPUBKEY}`\n}\n\nconst demoConfig = `{\"childs\":[\"EUR\",\"CNY\",\"USD\",{\"size\":12.5,\"mode\":\"percentage\",\"asset\":\"XLM\"},{\"size\":12.5,\"mode\":\"percentage\",\"asset\":\"ETH\"},{\"size\":12.5,\"mode\":\"percentage\",\"asset\":\"BTC\"},{\"size\":4,\"mode\":\"percentage\",\"asset\":\"SLT\"},{\"size\":4,\"mode\":\"percentage\",\"asset\":\"REPO\"},{\"size\":2.25,\"mode\":\"percentage\",\"asset\":\"PEDI\"},{\"size\":2.25,\"mode\":\"percentage\",\"asset\":\"TERN\"}]}`\n\n/**\n * Links\n */\nconst links = new Gui(\n  `\n  <p>\n    <a target=\"_blank\" rel=\"noopener\" href=\"https://cosmic.plus\">${__(\n    \"A Cosmic.Plus Software\"\n  )}</a>\n    − <a onclick=%displayDemo>Demo</a>\n    − <a target=\"_blank\" rel=\"noopener\" href=\"https://nucleo.fi/leaderboard/top/?span=3m\">Performance</a>\n  </p>\n`,\n  { displayDemo }\n)\n\n/**\n * Create footer\n */\n\nconst footer = new Footer(icons, links)\nhtml.append(document.body, footer)\n"],"sourceRoot":""}