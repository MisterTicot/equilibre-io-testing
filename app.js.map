{"version":3,"sources":["webpack:///./src/app.js","webpack:///./src/asset.js","webpack:///./src/side-frame.js","webpack:///./src/market-data.js","webpack:///./src/orderbook.js","webpack:///./src/balance.js","webpack:///./src/order.js","webpack:///./src/click-wall.js","webpack:///./src/portfolio.js","webpack:///./src/anchor.js","webpack:///./src/offers.js","webpack:///./src/helpers.js","webpack:///./src/activity-gui.js","webpack:///./src/portfolio-gui.js","webpack:///./src/highcharts-theme.js","webpack:///./src/asset-gui.js","webpack:///./src/settings-gui.js","webpack:///./src/share-gui.js","webpack:///./src/share.js","webpack:///./src/strategy.js","webpack:///./src/html/license.html","webpack:///./src/html/welcome.html","webpack:///./src/footer.js","webpack:///./src/svg/donate.svg"],"names":["dom","require","Form","Gui","html","Tabs","params","__","clickWall","global","Portfolio","isOverflowing","ActivityGui","PortfolioGui","SettingsGui","ShareGui","license","welcome","tabs","nav","header","view","main","add","loginForm","select","location","hash","selected","fitScreen","replace","domNode","selector","ledger","addValidator","login","_callee","_regeneratorRuntime","wrap","_context","prev","next","Promise","all","__webpack_require__","e","then","t","bind","default","sent","setInfo","connect","loginAddressBox","value","publicKey","t0","console","error","setError","stop","_callee2","address","_args2","arguments","_context2","length","undefined","Error","disconnect","$set","enable","resolve","portfolio","concat","setTimeout","listen","initGui","disable","remove","href","show","autocomplete","ledgerLoginButton","onclick","loginWithLedgerWallet","page","window","scrollTo","FIAT_BASEURL","FIAT_IMAGEFORMAT","Mirrorable","Projectable","marketData","Orderbook","Asset","module","exports","_Projectable","id","_this","_classCallCheck","this","_getPrototypeOf","call","table","_assertThisInitialized","image","info","code","_Object$assign","type","fiats","push","toLowerCase","cryptos","name","anchors","balances","offers","shares","mirror","balance","anchor","trap","compute","orderbook","forAsset","define","globalPrice","price","_inherits","_createClass","key","_getInfo","_asyncToGenerator","mark","abrupt","crypto","small","apply","addChild","reduce","sum","el","amount","rawLiabilities","entry","buying","selling","refreshPrices","_ref","array","refreshCryptoPrices","refreshFiatPrices","filter","asset","map","_x","_callee3","assets","prices","_args3","_context3","forEach","_callee4","_args4","_context4","fiat","USD","EUR","CNY","BTC","ETH","XRP","XLM","KIN","BAT","ZRX","BCH","STEEM","SBD","LINK","SLT","MOBI","SHX","RMT","TERN","PEDI","GRAT","REPO","currency","setInterval","log","SideFrame","url","current","close","create","title","src","sandbox","hidden","style","append","document","body","htmlOverflow","documentElement","overflow","bodyOverflow","shadow","hide","destroy","addEventListener","event","frameWindow","contentWindow","source","data","position","zIndex","right","top","width","maxWidth","height","border","background","backgroundImage","backgroundRepeat","backgroundPosition","padding","color","fontSize","fontWeight","cursor","borderBottomLeftRadius","insertBefore","firstChild","axios","nice","day","coingeckoCall","get","exchangeratesCall","_callee8","symbols","_args8","_context8","base","x","join","response","start_at","rates","cacheHistory","localStorage","_JSON$stringify","cachedHistory","json","JSON","parse","assetHistory","limit","history","list","symbol","toUpperCase","stellarNative","tickers","coin_id","_ref3","localization","market_data","community_data","developer_data","sparkline","_ref4","ids","quote","vs_currencies","assetData","_x2","_ref5","_callee5","_args5","_context5","vs_currency","days","record","index","time","volume","total_volumes","_x3","_ref6","_callee6","_context6","_x6","_ref7","_callee7","cached","end_at","today","_args7","_context7","Date","toISOString","slice","setDate","getDate","_Object$keys","sort","date","getTime","_x7","cosmicLib","StellarSdk","_possibleConstructorReturn","updateOffersPrices","childs","addOrderbook","baseAsset","quoteAsset","native","callBuilder","server","streamOptions","onmessage","ingest","stream","areOffersEquals","bids","normalizeOffers","asks","set","merged","arr","sortOffers","a","b","cumul","row","mergedRow","_this2","mergeOffers","array1","array2","side","baseVolume","basePrice","quoteAmount","quoteVolume","bestBid","bestAsk","marketPrice","spread","prototype","findOffer","last","childsNum","offer","findAsk","findBid","depth","Anchor","Balance","entryId","asset_code","asset_issuer","known","buying_liabilities","selling_liabilities","project","forBalance","issuer","CosmicLink","Order","method","algorithm","operations","_len","parameters","Array","_key","refresh","share","order","rebalancingStrategy","splice","trigger","_toConsumableArray","make","operation","find","newOperation","getOperation","setOperation","Number","cost","operationDirection","op","tightenSpread","percentage","clone","diff","refPrice","clamp","clampOfferPrice","price_r","n","d","updateOfferPriceR","min","max","Math","operationsToCosmicLink","operationsToDescription","cosmicLink","memo","accountId","addOperation","odesc","abs","toFixed","offerId","operationToOdesc","desc","rebalanceSide","direction","targetAmount","delta","liabilities","outdated","description","target","mode","size","_len2","_key2","_construct","_loop","overlay","Offers","testNetwork","horizon","isSupported","new","_resolve","destination","config","isAccountEmpty","account_id","accounts","account","_ingest","indexOf","getInfo","keys","t1","done","delegateYield","forPortfolio","total","aliases","helpers","alias","shorter","USD:GDUKMGUGDZQK6YHYA5Z6AY2G4XDSZPSZ3SW5UN3ARVMO6QSRDWP5YLEX","WSD:GDSVWEA7XV6M5XNLODVTPCGMAJTNBLZBXOFNQD3BNPNYALEYBNT6CE2V","USD:GDSRCV5VTM3U7Y3L6DFRP3PEGBNQMGOWSRTGSBWX6Z3H6C7JHRI4XFJP","USD:GBUYUAI75XXWDZEKLY66CFYKQPET5JR4EENXZBUZ3YXZ7DS56Z4OKOFU","USD:GBSTRUSD7IRX73RQZBL3RQUH6KS3O4NYFY3QCALDLZD77XMZOPWAVTUK","CNY:GAREELUB43IRHWEASCFBLKHURCGMHE5IF6XSE7EXDLACYHGRHM43RFOX","XCN:GCNY5OXYSY4FKHOPT2SPOQZAOEIGXB5LBYW3HVU3OWSTQITS65M5RCNY","BCNY:GBCNYBHAAPDSU3UIHXXQTHYZVSBJBI4YUNWXMKJBCPDHTVYR75G6NFHD","EURT:GAP5LETOV6YIE62YAM56STDANPRDO7ZFDBGSNHJQIYGGKSMOZAHOOS2S","SLT:GCKA6K5PCQ6PNF5RQBF7PQDJWRHO6UOGFMRLK3DYHDOI244V47XKQ4GP","MOBI:GA6HCMBLTZS5VYYBCATRBRZ3BZJMAFUDKYYF6AH6MVCMGWMRDNSWJPIH","SHX:GDSTRSHXHGJ7ZIVRBXEYE5Q74XUVCUSEKEBR7UCHEUUEK72N7I7KJ6JH","RMT:GDEGOXPCHXWFYY234D2YZSPEJ24BX42ESJNVHY5H7TWWQSYRN5ZKZE3N","TERN:GDGQDVO6XPFSY4NMX75A7AOVYCF5JYGW2SHCJJNWCQWIDGOZB53DGP6C","PEDI:GBVUDZLMHTLMZANLZB6P4S4RYF52MVWTYVYXTQ2EJBPBX4DZI2SDOLLY","GRAT:GAJ7V3EMD3FRWAPBEJAP7EC4223XI5EACDZ46RFMY5DYOMCIMWEFR5II","REPO:GCZNF24HPMYTV6NOEHI7Q5RJFFUI23JKUKY3H3XTQAFBQIBOHD5OXG3B","BTC:GBSTRH4QOTWNSVA6E4HFERETX4ZLSR3CIUBLK7AXYII277PFJC4BBYOG","BTC:GATEMHCCKCY67ZUCKTROYN24ZYT5GK4EQZ65JJLDHKHRUZI3EUEKMTCH","BTC:GAUTUYY2THLF7SGITDFMXJVYH3LHDSMGEAKSBU267M2K7A3W543CKUEF","BTC:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P","BTC:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5","ETH:GBSTRH4QOTWNSVA6E4HFERETX4ZLSR3CIUBLK7AXYII277PFJC4BBYOG","ETH:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P","ETH:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5","ETH:GBETHKBL5TCUTQ3JPDIYOZ5RDARTMHMEKIO2QZQ7IOZ4YC5XV3C2IKYU","ETH:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","LTC:GC5LOR3BK6KIOK7GKAUD5EGHQCMFOGHJTC7I3ELB66PTDFXORC2VM5LP","LTC:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5","LTC:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P","XRP:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5","XRP:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P","KIN:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","BAT:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","ZRX:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","BCH:GAEGOS7I6TYZSVHPSN76RSPIVL3SELATXZWLFO4DIAFYJF7MPAHFE7H4","STEEM:GB3KBOFUCVTWEZ7YIZ7PAKLQMKPCTGWU3LOMANMCT7V6I3AAK4USTEEM","SBD:GB3KBOFUCVTWEZ7YIZ7PAKLQMKPCTGWU3LOMANMCT7V6I3AAK4USTEEM","LINK:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR","loopcall","Offer","intern","recordToId","rawPrice","update","opened","records","rawAmount","last_modified_time","assetToId","element","scrollHeight","clientHeight","scrollWidth","clientWidth","_Gui2","ActivityOffers","globalCurrency","network","uri","_Gui3","ActivityOffer","_this3","toLocaleDateString","number","Orders","_Gui4","ActivityOrders","_this4","Transfers","_Gui5","ActivityTransfers","_this5","Highcharts","Highstock","AssetGui","summary","Summary","coingecko","chart","Chart","makeAssetPoint","y","PortfolioSummary","parent","Table","Graph","PortfolioTable","assetsGui","assetGui","className","simpleView","detailledView","PortfolioGraph","makePie","container","legend","enabled","tooltip","pointFormat","plotOptions","pie","dataLabels","format","point","events","options","legendItemClick","series","colorByPoint","ignoreHiddenPoint","PortfolioChart","_this6","makeChart","stockChart","rangeSelector","backgroundColor","yAxis","labels","align","resize","offset","credits","theme","allowPointSelect","animation","responsive","rules","condition","chartOptions","showInLegend","distance","colors","setOptions","msg","cell","amounts","node","object","priceDetails","values","link","feed","anchorName","simple","class","anchorTotal","anchorHeader","func","reload","i18n","Share","RebalanceGui","template","errors","modified","hideRebalance","hideApply","setupGui","Setup","toString","child","listOperations","remaining","pop","RebalanceTable","sortShares","shareGui","goal","descriptionToList","ShareSetup","assetName","switchMode","strategy","rebalance","fromString","isValid","findIndex","hasChanged","beautify","toTemplate","group","root","string","fromTemplate","used","computed","strat","targets","space","makeTotal100","MYPUBKEY","Footer","icons","links","Icon","action","match","rel","prompt","isNaN","confirm","demoConfig","footer","displayDemo","displayLicense","displayAbout"],"mappings":"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","file":"app.js","sourcesContent":["\"use_strict\"\n/**\n * Login interface\n */\nconst dom = require(\"@cosmic-plus/jsutils/dom\")\nconst Form = require(\"@cosmic-plus/jsutils/form\")\nconst Gui = require(\"@cosmic-plus/jsutils/gui\")\nconst html = require(\"@cosmic-plus/jsutils/html\")\nconst Tabs = require(\"@cosmic-plus/jsutils/tabs\")\nconst params = require(\"@cosmic-plus/jsutils/params\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst clickWall = require(\"./click-wall\")\nconst global = require(\"./global\")\nconst Portfolio = require(\"./portfolio\")\nconst { isOverflowing } = require(\"./helpers\")\n\nconst ActivityGui = require(\"./activity-gui\")\nconst PortfolioGui = require(\"./portfolio-gui\")\nconst SettingsGui = require(\"./settings-gui\")\nconst ShareGui = require(\"./share-gui\")\n\nconst license = new Gui(require(\"./html/license.html\"))\nconst welcome = new Gui(require(\"./html/welcome.html\"))\n\nrequire(\"./footer\")\n\n/**\n * Init\n */\nconst tabs = global.tabs = new Tabs({ nav: dom.header, view: dom.main })\ntabs.add(\"#welcome\", __(\"Welcome\"), welcome)\ntabs.add(\"#login\", __(\"Login\"), dom.loginForm)\ntabs.add(\"#license\", null, license)\ntabs.add(\"#about\", null, welcome)\n\ntabs.select(location.hash)\nif (!tabs.selected) tabs.select(\"#welcome\")\n\ntabs.fitScreen = function () {\n  if (isOverflowing(dom.header)) {\n    html.replace(tabs.nav.domNode, tabs.selector.domNode)\n  }\n}\ntabs.fitScreen()\n\nconst loginForm = new Form(dom.loginForm).addValidator(login)\nhtml.show(dom.loginForm)\ndom.loginForm.autocomplete = \"on\"\nif (params.address) {\n  tabs.select(\"#login\")\n  dom.loginAddressBox.value = params.address\n  login()\n} else {\n  dom.ledgerLoginButton.onclick = () => loginWithLedgerWallet()\n}\n\ntabs.listen(\"select\", page => {\n  location.hash = page\n  window.scrollTo(0, 0)\n})\n\n/**\n * Functions\n */\n\nlet ledger\nasync function loginWithLedgerWallet () {\n  ledger = await getLedgerModule()\n  loginForm.setInfo(__(\"Please open the Stellar App in your Ledger Wallet\"))\n  try {\n    await ledger.connect()\n    dom.loginAddressBox.value = ledger.publicKey\n    login()\n  } catch (error) {\n    console.error(error)\n    loginForm.setError(error)\n  }\n}\n\nasync function login (address = dom.loginAddressBox.value) {\n  if (!address) throw new Error(__(\"Please enter an address.\"))\n  if (ledger) ledger.disconnect()\n\n  loginForm.setInfo(__(\"Connecting to your account...\"))\n  params.$set({ address })\n  clickWall.enable()\n\n  try {\n    global.portfolio = await Portfolio.resolve(address)\n    loginForm.setInfo(`${__(\"Fetching market data\")}...`)\n    setTimeout(\n      () => loginForm.setInfo(`${__(\"Sorry, it takes a while (^.^)\\\"\")}...`),\n      10000\n    )\n    setTimeout(() => loginForm.setInfo(`${__(\"Almost there\")}...`), 20000)\n    setTimeout(\n      () => loginForm.setInfo(`${__(\"I'm running, I'm running\")}...`),\n      30000\n    )\n    global.portfolio.listen(\"open\", () => {\n      initGui()\n      clickWall.disable()\n    })\n  } catch (error) {\n    console.error(error)\n    loginForm.setError(error)\n    clickWall.disable()\n  }\n}\n\nfunction initGui () {\n  const portfolio = global.portfolio\n\n  const selected = location.hash\n  tabs.remove(\"#welcome\")\n  tabs.remove(\"#login\")\n  tabs.add(\"#portfolio\", __(\"Portfolio\"), new PortfolioGui(portfolio))\n  tabs.add(\"#rebalance\", __(\"Rebalance\"), new ShareGui(portfolio))\n  tabs.add(\"#activity\", __(\"Activity\"), new ActivityGui(portfolio))\n  tabs.add(\"#settings\", __(\"Settings\"), new SettingsGui())\n  tabs.add(\"#logout\", __(\"Logout\"), () => {\n    location.replace(location.href.replace(/\\?.*$/, \"#login\"))\n  })\n  tabs.fitScreen()\n\n  tabs.select(selected)\n  if (!tabs.selected) tabs.select(\"#portfolio\")\n}\n\n/**\n * Module loading\n */\n\nfunction getLedgerModule () {\n  return import(/* webpackChunkName: \"ledger\" */ \"@cosmic-plus/ledger-wallet\").then(\n    ledger => ledger.default\n  )\n}\n","\"use_strict\"\n/**\n * Asset class\n */\n\nconst AUTO_REFRESH_PRICES = true\nconst CRYPTO_PRICES_REFRESH_DELAY = 60 * 1000\nconst FIAT_PRICES_REFRESH_DELAY = 60 * 60 * 1000\nconst FIAT_BASEURL = \"https://www.xe.com/themes/xe/images/flags/svg/\"\nconst FIAT_IMAGEFORMAT = \".svg\"\n\nconst Mirrorable = require(\"@cosmic-plus/jsutils/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/projectable\")\n\nconst global = require(\"./global\")\nconst marketData = require(\"./market-data\")\nconst Orderbook = require(\"./orderbook\")\n\n/**\n * Class\n */\n\nconst Asset = module.exports = class Asset extends Projectable {\n  static resolve (id) {\n    return Asset.table[id] || new Asset(id)\n  }\n\n  constructor (id) {\n    super()\n\n    this.id = id\n    Asset.table[id] = this\n\n    // Empty image by default\n    this.image = \"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=\"\n\n    if (Asset.info[id]) {\n      this.code = id\n      Object.assign(this, Asset.info[id])\n      if (this.type === \"fiat\") {\n        Asset.fiats.push(this)\n        this.image = `${FIAT_BASEURL}${id.toLowerCase()}${FIAT_IMAGEFORMAT}`\n      } else {\n        Asset.cryptos.push(this)\n        this.type = \"crypto\"\n      }\n    } else {\n      this.code = id.replace(/:.*/, \"\")\n      this.name = this.code\n      this.type = \"unknown\"\n    }\n\n    this.anchors = new Mirrorable()\n    this.balances = new Mirrorable()\n    this.offers = new Mirrorable()\n    this.shares = new Mirrorable()\n\n    this.balances.mirror(balance => {\n      this.anchors.push(balance.anchor)\n      balance.trap(\"amount\", () => this.compute(\"amount\"))\n      balance.trap([\"buying\", \"selling\"], () => this.compute(\"liabilities\"))\n    })\n\n    this.orderbook = Orderbook.forAsset(this)\n    this.define(\"price\", \"globalPrice\", () => {\n      return this.globalPrice || this.orderbook.price\n    })\n    this.orderbook.trap(\"price\", () => this.compute(\"price\"))\n  }\n\n  async getInfo () {\n    // Happens once & only for cryptos.\n    if (this.name || this.type !== \"crypto\") return\n    this.info = await marketData.crypto.info(this)\n    this.name = this.info.name\n    this.image = this.info.image.small\n  }\n\n  addOrderbook (orderbook) {\n    this.orderbook.addChild(orderbook)\n  }\n}\n\nAsset.define(\"amount\", \"balances\", function () {\n  return this.balances && this.balances.reduce((sum, el) => sum + el.amount, 0)\n})\n\nAsset.define(\"value\", [\"amount\", \"price\"], function () {\n  return this.amount === 0 ? 0 : this.amount * this.price\n})\n\nAsset.define(\"liabilities\", [\"balances\", \"price\"], function () {\n  if (this.balances) {\n    const rawLiabilities = this.balances.reduce(\n      (sum, entry) => sum + entry.buying - entry.selling,\n      0\n    )\n    return this.price * rawLiabilities\n  }\n})\n\nAsset.define(\"isSupported\", [\"type\", \"price\"], function () {\n  return !!(this.type !== \"unknown\" || this.price)\n})\n\n/**\n * Utilities\n */\n\nAsset.refreshPrices = async function (array) {\n  if (!array) {\n    await Asset.refreshCryptoPrices()\n    await Asset.refreshFiatPrices()\n  } else {\n    await Asset.refreshCryptoPrices(\n      array.filter(asset => asset.type === \"crypto\").map(asset => asset.code)\n    )\n    await Asset.refreshFiatPrices(\n      array.filter(asset => asset.type === \"fiat\").map(asset => asset.code)\n    )\n  }\n}\n\nAsset.refreshCryptoPrices = async function (assets = Asset.cryptos) {\n  if (!assets.length) return\n  const prices = await marketData.crypto.prices(assets)\n  assets.forEach(asset => asset.globalPrice = prices[asset.code])\n}\n\nAsset.refreshFiatPrices = async function (fiats = Asset.fiats) {\n  if (!fiats.length) return\n  const prices = await marketData.fiat.prices(fiats)\n  fiats.forEach(asset => asset.price = asset.globalPrice = prices[asset.code])\n}\n\n/**\n * Known Assets\n */\n\nAsset.info = {\n  USD: { type: \"fiat\", name: \"US Dollar\" },\n  EUR: { type: \"fiat\", name: \"Euro\" },\n  CNY: { type: \"fiat\", name: \"Renminbi\" },\n\n  BTC: { id: \"bitcoin\" },\n  ETH: { id: \"ethereum\" },\n  XRP: { id: \"ripple\" },\n  XLM: { id: \"stellar\" },\n  KIN: { id: \"kin\" },\n  BAT: { id: \"basic-attention-token\" },\n  ZRX: { id: \"0x\" },\n  BCH: { id: \"bitcoin-cash\" },\n  STEEM: { id: \"steem\" },\n  SBD: { id: \"steem-dollar\" },\n  LINK: { id: \"chainlink\" },\n\n  SLT: { id: \"smartlands\" },\n  MOBI: { id: \"mobius\" },\n  SHX: { id: \"stronghold-token\" },\n  RMT: { id: \"sureremit\" },\n  TERN: { id: \"ternio\" },\n  PEDI: { id: \"pedity\" },\n  GRAT: { id: \"gratz\" },\n  REPO: { id: \"repo\" }\n}\n\n/**\n * Init\n */\n\nAsset.table = {}\nAsset.cryptos = []\nAsset.fiats = []\nnew Asset(global.currency)\n\n// Automatic global price refresh\nif (AUTO_REFRESH_PRICES) {\n  setInterval(Asset.refreshCryptoPrices, CRYPTO_PRICES_REFRESH_DELAY)\n  setInterval(Asset.refreshFiatPrices, FIAT_PRICES_REFRESH_DELAY)\n}\n\n// eslint-disable-next-line no-console\nconsole.log(Asset.table)\n","\"use_strict\"\n/**\n * Signing Side Frame\n */\nconst html = require(\"@cosmic-plus/jsutils/html\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\n/**\n * Class\n */\n\nclass SideFrame {\n  constructor (url) {\n    if (SideFrame.current) SideFrame.current.close()\n    SideFrame.current = this\n\n    this.domNode = html.create(\"iframe\", {\n      title: \"Signing Frame\",\n      src: url,\n      sandbox: \"allow-same-origin allow-scripts allow-forms allow-popups\",\n      hidden: true\n    })\n    Object.assign(this.domNode.style, SideFrame.style)\n    html.append(document.body, this.domNode)\n\n    this.show()\n  }\n\n  show () {\n    if (!this.domNode.hidden) return\n\n    this.htmlOverflow = document.documentElement.style.overflow\n    this.bodyOverflow = document.body.style.overflow\n    document.documentElement.style.overflow = \"hidden\"\n    document.body.style.overflow = \"hidden\"\n\n    SideFrame.shadow.onclick = () => this.close()\n    SideFrame.close.onclick = () => this.close()\n    html.show(SideFrame.shadow, SideFrame.close, this.domNode)\n  }\n\n  hide () {\n    if (this.domNode.hidden) return\n\n    document.documentElement.style.overflow = this.htmlOverflow\n    document.body.style.overflow = this.bodyOverflow\n\n    SideFrame.shadow.onclick = null\n    html.hide(SideFrame.shadow, SideFrame.close, this.domNode)\n  }\n\n  close () {\n    SideFrame.current = null\n    this.hide()\n    html.destroy(this.domNode)\n  }\n}\n\n/**\n * Event\n */\n\nwindow.addEventListener(\"message\", event => {\n  const frameWindow =\n    SideFrame.current && SideFrame.current.domNode.contentWindow\n\n  if (event.source === frameWindow) {\n    switch (event.data) {\n    case \"show\":\n      SideFrame.current.show()\n      break\n    case \"hide\":\n      SideFrame.current.hide()\n      break\n    case \"close\":\n      SideFrame.current.close()\n      break\n    }\n  }\n})\n\n/**\n * Frame style\n */\n\nSideFrame.style = {\n  position: \"fixed\",\n  zIndex: 998,\n  right: 0,\n  top: 0,\n  width: \"30em\",\n  maxWidth: \"100%\",\n  height: \"100vh\",\n  border: \"0.1em solid hsl(240, 10%, 75%)\",\n  background: \"hsl(240, 40%, 98%)\",\n  backgroundImage: `url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12em\" height=\"12em\" viewBox=\"0 0 18055.55 18055.55\" shape-rendering=\"geometricPrecision\" text-rendering=\"geometricPrecision\" image-rendering=\"optimizeQuality\" fill-rule=\"evenodd\" clip-rule=\"evenodd\"><path d=\"M6184.01 6244.26l-5076.93 5077.09c-1542.18 1542.18-1542.18 4042.74 0 5584.91 1542.18 1542.18 4042.74 1542.18 5584.91 0l5050.06-5050.22c-946.39 926.55-2243.37 1281.63-3458.3 1065.06l-2788.46 2788.46c-881.29 881.29-2310.22 881.29-3191.52 0-881.29-881.29-881.29-2310.22 0-3191.51l2788.62-2788.62 2311.35-2311.19c883.05-858.58 2294.87-850.9 3168.48 22.71 880.17 880.17 881.29 2306.54 3.52 3188.31l2288.31-2288.47c-136.75-767.89-501.74-1503.15-1095.13-2096.54-593.23-593.23-1328.33-958.22-2096.22-1095.13-1271.39-226.64-2574.93 181.38-3488.69 1095.13z\" fill=\"#c1c1c1\"/><path d=\"M11772.44 11825.98l5076.93-5077.09c1542.18-1542.18 1542.18-4042.74 0-5584.91-1542.18-1542.18-4042.74-1542.18-5584.91 0L6214.4 6214.2c946.39-926.56 2243.37-1281.63 3458.3-1065.07l2788.46-2788.46c881.29-881.29 2310.22-881.29 3191.52 0 881.29 881.29 881.29 2310.22 0 3191.52l-2788.62 2788.62L10552.71 10652c-883.05 858.57-2294.87 850.9-3168.48-22.71-880.17-880.17-881.29-2306.55-3.52-3188.31L5092.4 9729.45c136.75 767.89 501.74 1503.15 1095.13 2096.54 593.23 593.23 1328.33 958.22 2096.22 1095.13 1271.39 226.64 2574.93-181.37 3488.69-1095.13z\" fill=\"#9f9f9f\"/><path d=\"M12651.33 7587.95l-1418.38 1418.38c7.84 577.72-204.89 1157.83-638.02 1603.44l2269.12-2268.96c-45.58-255.91-116.44-508.14-212.72-752.85zm-909.28 4268.09c-810.76 793.48-1919.32 1194.94-3038.77 1116.89-139.79-9.76-279.9-26.87-419.53-51.82l-509.1 509.1c365.47 95.48 749.17 146.35 1144.56 146.35 448 0 880.65-65.26 1289.15-186.81l1533.7-1533.7z\" fill=\"#a6a6a6\"/><path d=\"M6214.4 6214.2c810.76-793.48 1919.32-1194.94 3038.77-1116.89 139.79 9.76 279.9 26.87 419.53 51.82l439.2-439.2c-379.87-103.8-779.89-159.3-1192.7-159.3-416.81 0-820.35 56.46-1203.57 162.34L6214.4 6214.2zm509.1 2788.78c7.36-557.41 220.08-1112.57 638.02-1542.5L5092.4 9729.44c42.87 240.56 108.12 478.07 195.77 708.87L6723.5 9002.98z\" fill=\"#888888\"/></svg>')`,\n  backgroundRepeat: \"no-repeat\",\n  backgroundPosition: \"center\",\n  padding: 0\n}\n\n/**\n * Closing button\n */\n\nSideFrame.close = html.create(\"span\", { hidden: true }, `× ${__(\"Close\")}`)\nObject.assign(SideFrame.close.style, {\n  position: \"fixed\",\n  zIndex: 999,\n  top: \"0.1em\",\n  right: \"0.1em\",\n  color: \"hsl(0, 0%, 40%)\",\n  fontSize: \"0.9em\",\n  fontWeight: \"bold\",\n  cursor: \"pointer\",\n  background: \"hsl(0, 0%, 95%)\",\n  borderBottomLeftRadius: \"0.1em\",\n  padding: \"0.1em 0.3em\"\n})\ndocument.body.insertBefore(SideFrame.close, document.body.firstChild)\n\n/**\n * Shadow Layer\n */\n\nSideFrame.shadow = html.create(\"div\", { hidden: true })\nObject.assign(SideFrame.shadow.style, {\n  position: \"fixed\",\n  zIndex: 997,\n  top: 0,\n  width: \"100%\",\n  height: \"100%\",\n  background: \"rgba(0,0,0,0.2)\"\n})\ndocument.body.insertBefore(SideFrame.shadow, document.body.firstChild)\n\n/**\n * Export\n */\n\nmodule.exports = SideFrame\n","\"use_strict\"\n/**\n * Markets statistics & data\n *\n * @exports marketData\n */\nconst marketData = exports\n\nconst axios = require(\"@cosmic-plus/base/axios\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst { day } = require(\"@cosmic-plus/jsutils/misc\")\n\nconst global = require(\"./global\")\n\n/**\n * Generic price/history\n */\n\nmarketData.assetHistory = function (asset, limit = 1000) {\n  if (asset.type === \"crypto\") return marketData.crypto.history(asset, limit)\n  else if (asset.type === \"fiat\") return marketData.fiat.history(asset, limit)\n}\n\n/**\n * Crypto price/history by \"https://www.coingecko.com\"\n */\n\nmarketData.crypto = {}\n\nfunction coingeckoCall (page, params) {\n  return axios.get(`https://api.coingecko.com/api/v3/${page}`, { params })\n}\n\nmarketData.crypto.list = async function () {\n  const response = await coingeckoCall(\"coins/list\")\n  const list = {}\n  response.data.forEach(entry => {\n    const symbol = entry.symbol.toUpperCase()\n    list[symbol] = { id: entry.id, name: entry.name }\n  })\n  return list\n}\n\nmarketData.crypto.stellarNative = async function () {\n  const response = await coingeckoCall(\"exchanges/stellar_term\")\n  return response.data.tickers.map(x => x.coin_id).filter(x => x)\n}\n\nmarketData.crypto.info = async function (asset) {\n  const response = await coingeckoCall(`coins/${asset.id}`, {\n    localization: false,\n    tickers: false,\n    market_data: false,\n    community_data: false,\n    developer_data: false,\n    sparkline: false\n  })\n  return response.data\n}\n\nmarketData.crypto.prices = async function (assets) {\n  const ids = assets.map(asset => asset.id).join(\",\")\n  const quote = global.currency.toLowerCase()\n  const response = await coingeckoCall(\"simple/price\", {\n    ids,\n    vs_currencies: quote\n  })\n  const prices = {}\n  assets.forEach(asset => {\n    const assetData = response.data[asset.id]\n    if (assetData) prices[asset.code] = assetData[quote]\n  })\n  return prices\n}\n\nmarketData.crypto.history = async function (asset, limit = 1000) {\n  const response = await coingeckoCall(`coins/${asset.id}/market_chart`, {\n    vs_currency: global.currency,\n    days: limit\n  })\n  const data = response.data.prices.map((record, index) => {\n    return {\n      time: record[0],\n      price: record[1],\n      // volume: response.data.total_volumes[index][1]\n      volume: +nice(response.data.total_volumes[index][1] / record[1])\n    }\n  })\n  return data\n}\n\n/**\n * Fiat prices / history by \"https://exchangeratesapi.io\"\n */\n\nmarketData.fiat = {}\n\nasync function exchangeratesCall (page, symbols, params = {}) {\n  params.base = global.currency\n  if (typeof symbols === \"string\") {\n    params.symbols = symbols\n  } else {\n    if (global.currency === \"EUR\") symbols = symbols.filter(x => x !== \"EUR\")\n    params.symbols = symbols.join(\",\")\n  }\n  params.source = \"equilibre.io\"\n\n  return axios\n    .get(`https://api.exchangeratesapi.io/${page}`, { params })\n    .then(response => {\n      if (global.currency === \"EUR\" && !response.data.start_at) {\n        response.data.rates.EUR = 1\n      }\n      return response\n    })\n}\n\nmarketData.fiat.prices = async function (assets) {\n  const symbols = assets.map(asset => asset.code)\n  const response = await exchangeratesCall(\"latest\", symbols)\n  const data = response.data.rates\n  for (let symbol in data) {\n    data[symbol] = nice(1 / data[symbol], 8)\n  }\n  return data\n}\n\nmarketData.fiat.history = async function (asset, limit = 1000) {\n  const cached = cachedHistory(asset)\n  if (cached) return cached\n\n  const end_at = new Date().toISOString().slice(0, 10)\n  const today = new Date(end_at)\n  today.setDate(today.getDate() - limit)\n  const start_at = today.toISOString().slice(0, 10)\n  const response = await exchangeratesCall(\"history\", asset.code, {\n    start_at,\n    end_at\n  })\n\n  const data = Object.keys(response.data.rates)\n    .sort()\n    .map(date => {\n      return {\n        time: new Date(date).getTime(),\n        price: +nice(1 / response.data.rates[date][asset.code], 8)\n      }\n    })\n  cacheHistory(asset, data)\n  return data\n}\n\n/**\n * Helpers\n */\n\nfunction cacheHistory (asset, data) {\n  localStorage[`prices.${asset.code}`] = JSON.stringify([day(), data])\n}\n\nfunction cachedHistory (asset) {\n  const json = localStorage[`prices.${asset.code}`]\n  if (!json) return\n  const data = JSON.parse(json)\n  if (data[0] === day()) return data[1]\n}\n","\"use_strict\"\n/**\n * Orderbook class\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/projectable\")\nconst StellarSdk = require(\"@cosmic-plus/base/stellar-sdk\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst Orderbook = module.exports = class Orderbook extends Projectable {\n  static forBalance (balance, quote) {\n    if (balance.asset === quote) return\n    const orderbook = new Orderbook(balance.asset, quote)\n    balance.orderbook = orderbook\n    balance.asset.addOrderbook(orderbook)\n    orderbook.balance = balance\n\n    const baseAsset = new StellarSdk.Asset(balance.code, balance.anchor.address)\n    const quoteAsset = StellarSdk.Asset.native()\n\n    const server = cosmicLib.resolve.server()\n    const callBuilder = server.orderbook(baseAsset, quoteAsset)\n    const streamOptions = { onmessage: offers => orderbook.ingest(offers) }\n    this.close = callBuilder.stream(streamOptions)\n\n    return orderbook\n  }\n\n  static forAsset (asset) {\n    return new Orderbook(asset)\n  }\n\n  constructor (base, quote) {\n    super()\n\n    this.base = base\n    this.quote = quote\n\n    if (quote) {\n      this.type = \"native\"\n      this.name = `${base.code}/${quote.code}`\n      this.quote.trap(\"price\", () => this.updateOffersPrices())\n    } else {\n      this.type = \"agregated\"\n      this.name = `${base.code} (${__(\"Agregated\")})`\n      this.childs = []\n    }\n  }\n\n  ingest (offers) {\n    if (!areOffersEquals(this.bids, offers.bids)) {\n      this.bids = normalizeOffers(offers.bids, this.quote, this.balance, \"bids\")\n    }\n    if (!areOffersEquals(this.asks, offers.asks)) {\n      this.asks = normalizeOffers(offers.asks, this.quote, this.balance, \"asks\")\n    }\n  }\n\n  updateOffersPrices () {\n    if (this.bids) {\n      this.set(\"bids\", updateOffersPrices(this.bids, this.quote))\n    }\n    if (this.asks) {\n      this.set(\"asks\", updateOffersPrices(this.asks, this.quote))\n    }\n  }\n\n  mergeOffers (type) {\n    if (this.childs.length < 2) {\n      this.set(type, this.childs[0] && this.childs[0][type])\n      return\n    }\n\n    /// Merge order books\n    const merged = this.childs.reduce((arr, x) => {\n      return x[type] ? arr.concat(x[type]) : arr\n    }, [])\n    if (!merged.length) {\n      this[type] = null\n      return\n    }\n\n    const sortOffers =\n      type === \"bids\"\n        ? (a, b) => b.price - a.price\n        : (a, b) => a.price - b.price\n\n    /// Update cumulative properties\n    let cumul = 0,\n      volume = 0\n    this.set(\n      type,\n      merged.sort(sortOffers).map(row => {\n        const mergedRow = Object.assign({}, row)\n        mergedRow.cumul = cumul += +row.amount\n        mergedRow.volume = volume += +row.amount * row.price\n        return mergedRow\n      })\n    )\n  }\n\n  addChild (orderbook) {\n    this.childs.push(orderbook)\n    orderbook.trap(\"bids\", () => this.mergeOffers(\"bids\"))\n    orderbook.trap(\"asks\", () => this.mergeOffers(\"asks\"))\n  }\n}\n\nOrderbook.define(\"bestBid\", \"bids\", function () {\n  return this.bids && this.bids[0] && this.bids[0].price\n})\nOrderbook.define(\"bestAsk\", \"asks\", function () {\n  return this.asks && this.asks[0] && this.asks[0].price\n})\nOrderbook.define(\"price\", [\"bestBid\", \"bestAsk\"], function () {\n  if (this.base.globalPrice) return (this.bestBid + this.bestAsk) / 2\n  else return this.marketPrice()\n})\nOrderbook.define(\"spread\", [\"bestBid\", \"bestAsk\"], function () {\n  return this.bestAsk - this.bestBid\n})\nOrderbook.define(\"spread%\", [\"spread\", \"bestAsk\"], function () {\n  return 100 * this.spread / this.bestAsk\n})\n\n/**\n * Utilities\n */\n\n/**\n * Look for the best first offer in **orderbook** **side** that match **filter**\n * (if provided) among child orderbooks.\n *\n * @param  {Orderbook} orderbook [description]\n * @param  {String}    side      `bids` or `asks`\n * @param  {Function}  [filter]  A filter that is passed by the returned offer\n * @return {Object}    An orderbook offer\n */\nOrderbook.prototype.findOffer = function (side, filter) {\n  const offers = this[side]\n  const childsNum = this.childs ? this.childs.length : 1\n  const anchors = {}\n\n  let last\n  for (let index in offers) {\n    const offer = offers[index]\n    if (filter && !filter(offer)) continue\n    const anchor = offer.balance.anchor.address\n    if (!anchors[anchor]) {\n      anchors[anchor] = true\n      last = offer\n    }\n    if (Object.keys(anchors).length === childsNum) break\n  }\n  return last\n}\n\nOrderbook.prototype.findAsk = function (filter) {\n  return this.findOffer(\"asks\", filter)\n}\nOrderbook.prototype.findBid = function (filter) {\n  return this.findOffer(\"bids\", filter)\n}\n\n/**\n * Returns the price of asset at **depth** XLM of orderbook's **side**.\n *\n * @param  {String} [side=\"bids\"] Either \"bids\" or \"asks\"\n * @param  {Number} [depth] The depth to look at, in term of XLM\n * @return {Number} Offer price at requested depth\n */\nOrderbook.prototype.marketPrice = function (side = \"bids\", depth = 50) {\n  const offer = this.findOffer(side, offer => offer.quoteVolume > depth)\n  return offer ? offer.price : 0\n}\n\n/**\n * Helpers\n */\n\nfunction areOffersEquals (array1, array2) {\n  if (!array1) return false\n  if (array1.length !== array2.length) return false\n  for (let index in array1.length) {\n    if (array1[index].amount !== array2[index].amount) return false\n    if (array1[index].price !== array2[index].price) return false\n  }\n  return true\n}\n\nfunction normalizeOffers (offers, quote, balance, side) {\n  offers.forEach(row => {\n    row.volume = undefined\n    row.baseVolume = undefined\n    row.basePrice = +row.price\n    row.quoteAmount = +row.amount\n    row.quoteVolume = undefined\n    row.balance = balance\n    row.side = side\n  })\n  return updateOffersPrices(offers, quote)\n}\n\nfunction updateOffersPrices (offers, quote) {\n  let volume = 0,\n    quoteVolume = 0,\n    baseVolume = 0\n  offers.forEach(row => {\n    if (row.side === \"asks\") {\n      row.quoteAmount = +nice(row.amount * row.basePrice, 7)\n    } else {\n      row.amount = +nice(row.quoteAmount / row.basePrice, 7)\n    }\n    row.volume = volume += +nice(row.amount * row.price, 7)\n    row.baseVolume = baseVolume += +row.amount\n    row.quoteVolume = quoteVolume += +row.quoteAmount\n    row.price = +nice(row.basePrice * quote.price, 7)\n  })\n  return offers\n}\n","\"use_strict\"\n/**\n * Balance entry\n */\nconst Mirrorable = require(\"@cosmic-plus/jsutils/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/projectable\")\n\nconst Anchor = require(\"./anchor\")\nconst Asset = require(\"./asset\")\nconst Orderbook = require(\"./orderbook\")\n\nconst Balance = module.exports = class Balance extends Projectable {\n  static resolve (code, issuer) {\n    const id = code ? `${code}:${issuer}` : \"XLM\"\n    return Balance.table[id]\n  }\n\n  static ingest (entry) {\n    const id = entryId(entry)\n    const balance = Balance.table[id]\n    if (!balance) return new Balance(entry, id)\n\n    balance.amount = +entry.balance\n    balance.buying = +entry.buying_liabilities\n    balance.selling = +entry.selling_liabilities\n    return balance\n  }\n\n  constructor (entry) {\n    super()\n\n    this.id = entryId(entry)\n    this.code = entry.asset_code || \"XLM\"\n    this.anchor = Anchor.resolve(entry.asset_issuer || \"stellar.org\")\n    Balance.table[this.id] = this\n\n    if (this.id === \"XLM\" || this.id in Anchor.known) {\n      this.asset = Asset.resolve(Anchor.known[this.id] || this.code)\n      this.known = true\n    } else {\n      this.asset = Asset.resolve(this.id)\n      this.known = false\n    }\n    this.amount = +entry.balance\n    this.buying = +entry.buying_liabilities\n    this.offers = new Mirrorable()\n    this.selling = +entry.selling_liabilities\n\n    this.asset.balances.push(this)\n\n    if (this.code === \"XLM\") {\n      this.asset.project(\"price\", this)\n    } else {\n      this.orderbook = Orderbook.forBalance(this, Asset.resolve(\"XLM\"))\n      this.orderbook.project(\"price\", this)\n    }\n  }\n}\n\nBalance.table = {}\nBalance.define(\"value\", [\"amount\", \"price\"], function () {\n  return this.amount === 0 ? 0 : this.amount * this.price\n})\n\n/**\n * Helpers\n */\n\nfunction entryId (entry) {\n  return entry.asset_code ? `${entry.asset_code}:${entry.asset_issuer}` : \"XLM\"\n}\n","\"use_strict\"\n/**\n * Order class\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst CosmicLink = cosmicLib.CosmicLink\nconst Mirrorable = require(\"@cosmic-plus/jsutils/mirrorable\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/projectable\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./global\")\n\nconst Order = module.exports = class Order extends Projectable {\n  static rebalance (share) {\n    if (share.asset.code === \"XLM\") return\n\n    const order = new Order(\n      global.rebalancingStrategy,\n      share.asset.orderbook,\n      share\n    )\n    share.trap([\"value\", \"target\"], () => order.refresh())\n    share.asset.trap(\"liabilities\", () => order.refresh())\n    return order\n  }\n\n  constructor (method, orderbook, ...parameters) {\n    super()\n    this.algorithm = algorithm[method]\n    this.operations = new Mirrorable()\n    this.orderbook = orderbook\n    this.parameters = parameters\n\n    this.orderbook.listen(\"update\", () => this.refresh())\n    this.operations.listen(\"update\", () =>\n      this.compute([\"cosmicLink\", \"description\"])\n    )\n\n    this.refresh()\n  }\n\n  refresh () {\n    this.operations.splice(0, this.operations.length)\n    this.operations.trigger(\"update\")\n    this.type = \"\"\n    this.compute(\"offers\")\n    this.algorithm(this, ...this.parameters)\n    this.trigger(\"refresh\")\n  }\n\n  /**\n   * Operations Management\n   */\n\n  getOperation (offer, make) {\n    const id = `${offer.balance.anchor.id}:${make ? offer.price : \"take\"}`\n    const operation = this.operations.find(x => x.id === id)\n    if (operation) {\n      return operation\n    } else {\n      const newOperation = { id }\n      this.operations.push(newOperation)\n      return newOperation\n    }\n  }\n\n  addOperation (offer, amount) {\n    const operation = this.getOperation(offer, amount > 0)\n    this.setOperation(operation, offer, Number(amount) || operation.amount)\n  }\n\n  setOperation (operation, offer, amount) {\n    operation.amount = amount\n    operation.cost = amount * offer.price\n    operation.offer = offer\n    this.operations.trigger(\"update\")\n  }\n}\n\nOrder.define(\"cosmicLink\", \"operations\", function () {\n  return Order.operationsToCosmicLink(this.operations)\n})\nOrder.define(\"description\", \"operations\", function () {\n  return Order.operationsToDescription(this.operations)\n})\n\n/**\n * Utilities\n */\n\nOrder.operationsToCosmicLink = function (operations = []) {\n  const cosmicLink = new CosmicLink({\n    memo: \"Equilibre.io\",\n    source: global.portfolio.accountId\n  })\n  operations.forEach(operation => {\n    cosmicLink.addOperation(\"manageOffer\", operationToOdesc(operation))\n  })\n\n  return cosmicLink\n}\n\nOrder.operationsToDescription = function (operations = []) {\n  const desc = []\n  operations.forEach(op => {\n    if (operationDirection(op) === \"buy\") {\n      desc.push(`\n${__(\"Buy\")} ${nice(op.amount)} ${op.offer.balance.code} ${__(\"at\")} \\\n${nice(op.offer.price)} ${global.currency}\n      `)\n    } else {\n      desc.push(`\n${__(\"Sell\")} ${nice(op.amount)} ${op.offer.balance.code} ${__(\"at\")} \\\n${nice(op.offer.price)} ${global.currency}\n      `)\n    }\n  })\n  return desc\n}\n\n/**\n * Helpers\n */\n\nfunction operationDirection (op) {\n  if (\n    op.amount > 0 && op.offer.side === \"bids\"\n    || op.amount < 0 && op.offer.side === \"asks\"\n  ) {\n    return \"buy\"\n  } else {\n    return \"sell\"\n  }\n}\n\nfunction operationToOdesc (operation) {\n  const offer = operation.offer\n  const base = offer.balance.code + \":\" + offer.balance.anchor.address\n  const quote = \"XLM\"\n\n  let odesc\n  if (operationDirection(operation) === \"buy\") {\n    odesc = {\n      buying: base,\n      selling: quote,\n      amount: operation.amount * offer.price_r.n / offer.price_r.d,\n      price: { n: offer.price_r.d, d: offer.price_r.n }\n    }\n  } else {\n    odesc = {\n      buying: quote,\n      selling: base,\n      amount: operation.amount,\n      price: offer.price_r\n    }\n  }\n  odesc.amount = Math.abs(odesc.amount).toFixed(7)\n  odesc.offerId = operation.offer.id\n\n  return odesc\n}\n\n/**\n * Create a copy of **offer** with a delta to global market price reduced by\n * **percentage**.\n */\nfunction tightenSpread (offer, percentage = 0.01) {\n  const clone = Object.assign({}, offer)\n  const diff = percentage * offer.balance.asset.orderbook[\"spread%\"] / 100\n\n  if (offer.side === \"bids\") clone.price = offer.price * (1 + diff)\n  else clone.price = offer.price * (1 - diff)\n\n  if (offer.balance.asset.globalPrice) clampOfferPrice(clone)\n  updateOfferPriceR(clone)\n\n  return clone\n}\n\n/**\n * Floor/ceil **offer**'s price to maintain a maximum spread of **spread**\n * from its price.\n *\n * @param {Object} offer offer to price-cap\n * @param {Number} [spread=0.025] Maximum spread from asset price (in percent)\n */\nfunction clampOfferPrice (offer, spread = 0.025) {\n  const refPrice = offer.balance.asset.price\n  if (offer.side === \"bids\") {\n    offer.price = clamp(offer.price, refPrice * (1 - spread), refPrice)\n  } else {\n    offer.price = clamp(offer.price, refPrice, refPrice * (1 + spread))\n  }\n}\n\n/**\n * Returns a number whose value is limited to the given range.\n *\n * @param  {Number} value An arbitrary number\n * @param  {Number} min Lower boundary\n * @param  {[type]} max Upper boundary\n * @return {Number}\n */\nfunction clamp (value, min, max) {\n  return Math.min(Math.max(value, min), max)\n}\n\n/**\n * Set `offer.price_r` according to `offer.price`.\n *\n * @param  {Object} offer\n */\nfunction updateOfferPriceR (offer) {\n  const quote = offer.balance.orderbook.quote\n\n  offer.price_r = {\n    n: nice(offer.price * 10000000000, 0),\n    d: nice(quote.price * 10000000000, 0)\n  }\n\n  // Ten characters maximum\n  while (offer.price_r.n > 999999999 || offer.price_r.d > 999999999) {\n    offer.price_r.n = nice(offer.price_r.n / 10, 0)\n    offer.price_r.d = nice(offer.price_r.d / 10, 0)\n  }\n}\n\n/**\n * Orders types\n */\n\nconst algorithm = {}\n\nalgorithm.balance = function (order, share) {\n  const asset = share.asset\n  const orderbook = asset.orderbook\n\n  if (asset.liabilities) {\n    const currentOffers = asset.offers.filter(offer => !offer.outdated)\n    if (currentOffers.length) {\n      order.description = [__(\"Rebalancing...\")]\n      return\n    }\n  }\n\n  if (!orderbook.bestBid || !orderbook.bestAsk || share.target == null) return\n\n  if (share.mode === \"amount\" || share.target === 0) {\n    algorithm.limit(order, share.size - asset.amount)\n    return\n  } else if (share.delta > 0) {\n    rebalanceSide(\"asks\", order, share)\n  } else if (share.delta < 0) {\n    rebalanceSide(\"bids\", order, share)\n  }\n}\n\nfunction rebalanceSide (side, order, share) {\n  const orderbook = share.asset.orderbook\n  const direction = side === \"asks\" ? \"selling\" : \"buying\"\n  const targetAmount = nice(Math.abs(share.delta) / share.asset.price, 7)\n\n  const offer = orderbook.findOffer(side, offer => {\n    return (\n      offer.volume > targetAmount / 10\n      && (side === \"bids\" || offer.balance.amount > targetAmount)\n    )\n  })\n\n  if (offer) {\n    const prev = share.asset.offers.find(offer => offer[direction].asset_code)\n    offer.id = prev && prev.id\n    if (targetAmount * offer.basePrice > 1) {\n      order.addOperation(tightenSpread(offer), targetAmount)\n    }\n  }\n}\n\nalgorithm.limit = function (order, size) {\n  if (!size) return\n\n  const side = size > 0 ? \"bids\" : \"asks\"\n  const offer = order.orderbook.findOffer(side)\n  order.addOperation(tightenSpread(offer), Math.abs(size))\n}\n\n// Outdated code\n//\n// algorithm.market = function (order, size = order.asset.size) {\n//   order.type = \"taker\"\n//   if (!order.offers) return\n//   const orderbook = order.orderbook\n//   const offer = orderbook.findOffer(this.side, offer => offer.cumul > size)\n//   order.addOperation(offer, size)\n// }\n\n// algorithm.deepLimit = function (order, size = order.asset.size) {\n//   order.type = \"maker\"\n//   if (!order.offers) return\n//   const orderbook = order.orderbook\n//   const offer = orderbook.findOffer(this.side, offer => offer.cumul > size)\n//   order.addOperation(offer, size)\n// }\n\n/**\n * Append algorithms to Order class\n */\n\nfor (let key in algorithm) {\n  if (!Order[key]) Order[key] = (...parameters) => new Order(key, ...parameters)\n}\n","\"use_strict\"\n/**\n * Overlay that prevent user interaction\n */\nconst clickWall = module.exports\n\nconst html = require(\"@cosmic-plus/jsutils/html\")\n\nconst overlay = html.create(\"div\", { hidden: true })\nhtml.append(document.body, overlay)\n\nObject.assign(overlay.style, {\n  position: \"fixed\",\n  zIndex: 999,\n  top: 0,\n  width: \"100%\",\n  height: \"100%\"\n})\n\nclickWall.enable = () => html.show(overlay)\nclickWall.disable = () => html.hide(overlay)\n","\"use_strict\"\n/**\n * Compute portfolio data from Account object.\n */\nconst axios = require(\"@cosmic-plus/base/axios\")\nconst cosmicLib = require(\"cosmic-lib\")\nconst Mirrorable = require(\"@cosmic-plus/jsutils/mirrorable\")\nconst Projectable = require(\"@cosmic-plus/jsutils/projectable\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst Asset = require(\"./asset\")\nconst Balance = require(\"./balance\")\nconst global = require(\"./global\")\n// const History = require(\"./portfolio-history\")\nconst Offers = require(\"./offers\")\n\n/**\n * Class\n */\n\nmodule.exports = class Portfolio extends Projectable {\n  static async resolve (address) {\n    const portfolio = new Portfolio()\n    portfolio.address = cosmicLib.config.source = address\n\n    await testNetwork()\n\n    const destination = await cosmicLib.resolve.address(address)\n    if (destination.memo)\n      throw new Error(__(\"Invalid federated address: shared account.\"))\n    if (await cosmicLib.resolve.isAccountEmpty(destination.account_id))\n      throw new Error(__(\"Empty account\"))\n\n    portfolio.accountId = destination.account_id\n\n    const server = cosmicLib.resolve.server()\n    const callBuilder = server.accounts().accountId(portfolio.accountId)\n    const streamOptions = { onmessage: account => portfolio.ingest(account) }\n    this.close = callBuilder.stream(streamOptions)\n\n    return portfolio\n  }\n\n  constructor () {\n    super()\n\n    // eslint-disable-next-line no-console\n    console.log(this)\n\n    this.assets = new Mirrorable()\n    this.balances = new Mirrorable()\n\n    this.define(\"total\", \"assets\", () => {\n      return this.assets\n        .filter(asset => asset.isSupported)\n        .reduce((sum, x) => sum + x.value, 0)\n    })\n    this.assets.mirror(asset =>\n      asset.trap([\"value\", \"isSupported\"], () => this.compute(\"total\"))\n    )\n\n    this.new = true\n  }\n\n  async ingest (account) {\n    this.account = account\n\n    for (let index in account.balances) {\n      const balance = Balance.ingest(account.balances[index])\n      if (this.assets.indexOf(balance.asset) === -1) {\n        await balance.asset.getInfo()\n        this.assets.push(balance.asset)\n        this.balances.push(balance)\n        // TODO: check if following line trigger too much rebalancing\n        this.trap(\"total\", () => balance.asset.compute(\"share\"))\n      } else if (this.balances.indexOf(balance) === -1) {\n        this.balances.push(balance)\n      }\n    }\n\n    if (this.new) {\n      delete this.new\n      await Asset.refreshPrices()\n      this.offers = await Offers.forPortfolio(this)\n      this.trigger(\"open\")\n    }\n  }\n}\n\n/**\n * Extension\n */\n\nAsset.define(\"share\", \"value\", function () {\n  return global.portfolio && 100 * this.value / global.portfolio.total\n})\n\n/**\n * Helpers\n */\n\nasync function testNetwork () {\n  const horizon = cosmicLib.resolve.horizon()\n  try {\n    await axios.get(horizon)\n  } catch (error) {\n    throw new Error(__(\"Can't connect to the Stellar blockchain\"))\n  }\n}\n","\"use_strict\"\n/**\n * Anchor class\n */\nconst aliases = require(\"@cosmic-plus/base/aliases\")\nconst helpers = require(\"@cosmic-plus/jsutils/misc\")\nconst Projectable = require(\"@cosmic-plus/jsutils/projectable\")\n\n/**\n * Class\n */\n\nconst Anchor = module.exports = class Anchor extends Projectable {\n  static resolve (address) {\n    return Anchor.all[address] || new Anchor(address)\n  }\n\n  constructor (address) {\n    super()\n\n    this.address = address\n    this.alias = aliases.all[address]\n    this.name = helpers.shorter(this.alias || this.address)\n    Anchor.all[address] = this\n\n    this.assets = {}\n  }\n}\n\nAnchor.all = {}\n\n/**\n * Known Anchors\n */\n\nAnchor.known = {\n  \"USD:GDUKMGUGDZQK6YHYA5Z6AY2G4XDSZPSZ3SW5UN3ARVMO6QSRDWP5YLEX\": \"USD\",\n  \"WSD:GDSVWEA7XV6M5XNLODVTPCGMAJTNBLZBXOFNQD3BNPNYALEYBNT6CE2V\": \"USD\",\n  \"USD:GDSRCV5VTM3U7Y3L6DFRP3PEGBNQMGOWSRTGSBWX6Z3H6C7JHRI4XFJP\": \"USD\",\n  \"USD:GBUYUAI75XXWDZEKLY66CFYKQPET5JR4EENXZBUZ3YXZ7DS56Z4OKOFU\": \"USD\",\n  \"USD:GBSTRUSD7IRX73RQZBL3RQUH6KS3O4NYFY3QCALDLZD77XMZOPWAVTUK\": \"USD\",\n  \"CNY:GAREELUB43IRHWEASCFBLKHURCGMHE5IF6XSE7EXDLACYHGRHM43RFOX\": \"CNY\",\n  \"XCN:GCNY5OXYSY4FKHOPT2SPOQZAOEIGXB5LBYW3HVU3OWSTQITS65M5RCNY\": \"CNY\",\n  \"BCNY:GBCNYBHAAPDSU3UIHXXQTHYZVSBJBI4YUNWXMKJBCPDHTVYR75G6NFHD\": \"CNY\",\n  \"EURT:GAP5LETOV6YIE62YAM56STDANPRDO7ZFDBGSNHJQIYGGKSMOZAHOOS2S\": \"EUR\",\n\n  \"SLT:GCKA6K5PCQ6PNF5RQBF7PQDJWRHO6UOGFMRLK3DYHDOI244V47XKQ4GP\": null,\n  \"MOBI:GA6HCMBLTZS5VYYBCATRBRZ3BZJMAFUDKYYF6AH6MVCMGWMRDNSWJPIH\": null,\n  \"SHX:GDSTRSHXHGJ7ZIVRBXEYE5Q74XUVCUSEKEBR7UCHEUUEK72N7I7KJ6JH\": null,\n  \"RMT:GDEGOXPCHXWFYY234D2YZSPEJ24BX42ESJNVHY5H7TWWQSYRN5ZKZE3N\": null,\n  \"TERN:GDGQDVO6XPFSY4NMX75A7AOVYCF5JYGW2SHCJJNWCQWIDGOZB53DGP6C\": null,\n  \"PEDI:GBVUDZLMHTLMZANLZB6P4S4RYF52MVWTYVYXTQ2EJBPBX4DZI2SDOLLY\": null,\n  \"GRAT:GAJ7V3EMD3FRWAPBEJAP7EC4223XI5EACDZ46RFMY5DYOMCIMWEFR5II\": null,\n  \"REPO:GCZNF24HPMYTV6NOEHI7Q5RJFFUI23JKUKY3H3XTQAFBQIBOHD5OXG3B\": null,\n\n  \"BTC:GBSTRH4QOTWNSVA6E4HFERETX4ZLSR3CIUBLK7AXYII277PFJC4BBYOG\": null,\n  \"BTC:GATEMHCCKCY67ZUCKTROYN24ZYT5GK4EQZ65JJLDHKHRUZI3EUEKMTCH\": null,\n  \"BTC:GAUTUYY2THLF7SGITDFMXJVYH3LHDSMGEAKSBU267M2K7A3W543CKUEF\": null,\n  \"BTC:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P\": null,\n  \"BTC:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5\": null,\n  \"ETH:GBSTRH4QOTWNSVA6E4HFERETX4ZLSR3CIUBLK7AXYII277PFJC4BBYOG\": null,\n  \"ETH:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P\": null,\n  \"ETH:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5\": null,\n  \"ETH:GBETHKBL5TCUTQ3JPDIYOZ5RDARTMHMEKIO2QZQ7IOZ4YC5XV3C2IKYU\": null,\n  \"ETH:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null,\n  \"LTC:GC5LOR3BK6KIOK7GKAUD5EGHQCMFOGHJTC7I3ELB66PTDFXORC2VM5LP\": null,\n  \"LTC:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5\": null,\n  \"LTC:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P\": null,\n  \"XRP:GBVOL67TMUQBGL4TZYNMY3ZQ5WGQYFPFD5VJRWXR72VA33VFNL225PL5\": null,\n  \"XRP:GCNSGHUCG5VMGLT5RIYYZSO7VQULQKAJ62QA33DBC5PPBSO57LFWVV6P\": null,\n  \"KIN:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null,\n  \"BAT:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null,\n  \"ZRX:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null,\n  \"BCH:GAEGOS7I6TYZSVHPSN76RSPIVL3SELATXZWLFO4DIAFYJF7MPAHFE7H4\": null,\n  \"STEEM:GB3KBOFUCVTWEZ7YIZ7PAKLQMKPCTGWU3LOMANMCT7V6I3AAK4USTEEM\": null,\n  \"SBD:GB3KBOFUCVTWEZ7YIZ7PAKLQMKPCTGWU3LOMANMCT7V6I3AAK4USTEEM\": null,\n  \"LINK:GBDEVU63Y6NTHJQQZIKVTC23NWLQVP3WJ2RI2OTSJTNYOIGICST6DUXR\": null\n}\n","\"use_strict\"\n/**\n * Account offers\n */\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst loopcall = require(\"@cosmic-plus/loopcall\")\nconst Mirrorable = require(\"@cosmic-plus/jsutils/mirrorable\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/projectable\")\nconst { day } = require(\"@cosmic-plus/jsutils/misc\")\n\nconst Asset = require(\"./asset\")\nconst Balance = require(\"./balance\")\n\n/**\n * Class\n */\n\nclass Offer extends Projectable {\n  static async forPortfolio (portfolio) {\n    const offers = new Mirrorable()\n    const server = cosmicLib.resolve.server()\n    const callBuilder = server.offers(\"accounts\", portfolio.accountId)\n    await Offer.update(callBuilder, offers)\n    setInterval(() => Offer.update(callBuilder, offers), 5000)\n    return offers\n  }\n\n  static async update (callBuilder, offers) {\n    offers.forEach(offer => offer.opened = false)\n    await loopcall(callBuilder).then(records => {\n      records.forEach(record => Offer.ingest(record, offers))\n    })\n    offers.filter(offer => !offer.opened).forEach(offer => offer.destroy())\n  }\n\n  static async ingest (record, offers) {\n    const offer = Offer.table[recordToId(record)]\n    if (offer) offer.update(record)\n    else new Offer(record, offers)\n  }\n\n  constructor (record, offers) {\n    super()\n\n    const quote = Asset.resolve(\"XLM\")\n    const asset = record.buying.asset_code ? record.buying : record.selling\n    this.balance = Balance.resolve(asset.asset_code, asset.asset_issuer)\n    this.asset = this.balance.asset\n    this.side = record.buying.asset_code ? \"buy\" : \"sell\"\n    this.intern = recordToId(record)\n\n    this.define(\n      \"price\",\n      \"rawPrice\",\n      this.side === \"sell\"\n        ? () => quote.price * this.rawPrice\n        : () => quote.price / this.rawPrice\n    )\n    quote.trap(\"price\", () => this.compute(\"price\"))\n\n    this.update(record)\n\n    this.balance.offers.push(this)\n    this.asset.offers.push(this)\n    if (offers) offers.push(this)\n    Offer.table[this.intern] = this\n\n    this.listen(\"destroy\", () => {\n      this.balance.offers.splice(this.balance.offers.indexOf(this), 1)\n      this.asset.offers.splice(this.asset.offers.indexOf(this), 1)\n      if (offers) offers.splice(offers.indexOf(this), 1)\n      delete Offer.table[this.intern]\n    })\n  }\n\n  update (record) {\n    this.opened = true\n    Object.assign(this, record)\n    this.rawPrice = record.price\n    this.compute(\"price\")\n    this.rawAmount = record.amount\n    if (this.side === \"buy\") {\n      this.amount = nice(this.rawAmount * this.rawPrice, 7)\n    }\n\n    this.date = day(this.last_modified_time)\n    this.outdated = this.date !== day()\n  }\n}\n\nOffer.table = {}\n\n/**\n * Helpers\n */\n\nfunction recordToId (record) {\n  return `${record.id}/${assetToId(record.buying)}/${assetToId(record.selling)}`\n}\n\nfunction assetToId (asset) {\n  return asset.asset_issuer\n    ? `${asset.asset_code}:${asset.asset_issuer}`\n    : \"XLM\"\n}\n\n/**\n * Export\n */\n\nmodule.exports = Offer\n","\"use_strict\"\n/**\n * Various helpers\n */\n\nconst helpers = exports\n\nhelpers.isOverflowing = function (element) {\n  return (\n    element.scrollHeight > element.clientHeight\n    || element.scrollWidth > element.clientWidth\n  )\n}\n","\"use_strict\"\n/**\n * Activity Gui\n */\n\nconst Gui = require(\"@cosmic-plus/jsutils/gui\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst Tabs = require(\"@cosmic-plus/jsutils/tabs\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\nconst { CosmicLink } = require(\"cosmic-lib\")\n\nconst SideFrame = require(\"./side-frame\")\nconst global = require(\"./global\")\n\n/**\n * Class\n */\n\nclass ActivityGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section>\n  <h2>${__(\"Activity\")}</h2>\n  %selector\n  %view\n</section>\n    `)\n\n    this.portfolio = portfolio\n\n    const tabs = new Tabs()\n    // tabs.project([\"selector\", \"view\"], this)\n    tabs.project(\"view\", this)\n\n    tabs.add(\n      \"offers\",\n      __(\"Open Orders\"),\n      new ActivityGui.Offers(portfolio),\n      \"select\"\n    )\n    // tabs.add(\"orders\", __(\"Orders\"), new ActivityGui.Orders(portfolio))\n    // tabs.add(\"transfers\", __(\"Transfers\"), new ActivityGui.Transfers(portfolio))\n    // tabs.select(__(\"Orders\"))\n  }\n}\n\nActivityGui.Offers = class ActivityOffers extends Gui {\n  constructor (portfolio) {\n    super(`\n<section>\n  <table>\n    <tr>\n      <th>${__(\"Date\")}</th>\n      <th>${__(\"Asset\")}</th>\n      <th>${__(\"Direction\")}</th>\n      <th>${__(\"Amount\")}</th>\n      <th>${__(\"Price\")} (${global.currency})</th>\n    </tr>\n    %formatOffer:offers...\n    <tr><td colspan=\"5\" align=\"center\" onclick=%cancelOffers>\n      <h3>${__(\"Cancel All\")}</h3>\n    </td></tr>\n  </table>\n</section>\n\n<p class=\"note\">\n  ${__(\"All orders are passed against Stellar Lumens (XLM).\")}\n  ${__(\n    \"For your comfort, prices are displayed in their %%globalCurrency equivalent.\"\n  )}\n  ${__(\n    \"However, those converted values will change according to XLM price movement.\"\n  )}\n</p>\n    `)\n\n    this.portfolio = portfolio\n    this.offers = portfolio.offers\n    this.globalCurrency = global.currency\n  }\n\n  formatOffer (offer) {\n    return new ActivityGui.Offer(offer)\n  }\n\n  cancelOffers () {\n    if (!this.offers.length) return\n\n    const memo = \"Equilibre.io\"\n    const network = \"public\"\n    const source = this.portfolio.accountId\n    const operations = this.offers.map(offer => {\n      return { type: \"manageOffer\", offerId: offer.id, amount: 0 }\n    })\n\n    const cosmicLink = new CosmicLink({ memo, network, source, operations })\n    new SideFrame(cosmicLink.uri)\n  }\n}\n\nActivityGui.Offer = class ActivityOffer extends Gui {\n  constructor (offer) {\n    super(\n      `\n<tr>\n  <td>%formatDate:last_modified_time</td>\n  <td>\n    <img src=%image alt=\"\">\n    <span>%name / %anchor</span>\n  </td>\n  <td>%side</td>\n  <td align=\"right\">%nice:amount</td>\n  <td align=\"right\">%nice:price</td>\n</tr>\n    `,\n      offer\n    )\n\n    this.offer = offer\n\n    this.image = offer.asset.image\n    this.name = offer.asset.code\n    this.side = offer.side === \"buy\" ? __(\"Buy\") : __(\"Sell\")\n    this.anchor = offer.balance.anchor.name\n    this.date = new Date(offer.last_modified_time).toLocaleDateString()\n  }\n\n  nice (number) {\n    return nice(number)\n  }\n\n  formatDate (value) {\n    const date = value ? new Date(value) : new Date()\n    return date.toLocaleDateString()\n  }\n}\n\nActivityGui.Orders = class ActivityOrders extends Gui {\n  constructor (portfolio) {\n    super(`\n<table>\n  <tr>\n    <th>${__(\"Date\")}</th>\n    <th>${__(\"Asset\")}</th>\n    <th>${__(\"Direction\")}</th>\n    <th>${__(\"Amount\")}</th>\n    <th>${__(\"Price\")}</th>\n  </tr>\n  <tr>\n    <td colspan=\"6\"><h3><i18n>${__(\"Open Orders\")}</i18n></h3></td>\n  </tr>\n  %openOrders...\n  <tr>\n    <td colspan=\"6\"><h3><i18n>${__(\"Completed Orders\")}</i18n></h3></td>\n  </tr>\n  %completedOrders...\n</table>\n    `)\n    this.portfolio = portfolio\n  }\n}\n\nActivityGui.Transfers = class ActivityTransfers extends Gui {\n  constructor (portfolio) {\n    super(`\n<table>\n  <tr>\n    <th>${__(\"Date\")}</th>\n    <th>${__(\"Asset\")}</th>\n    <th>${__(\"With\")}</th>\n    <th>${__(\"Amount\")}</th>\n  </tr>\n  %transfers...\n</table>\n    `)\n    this.portfolio = portfolio\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = ActivityGui\n","\"use_strict\"\n/**\n * Portfolio Graphical User Interface\n */\nconst Highcharts = require(\"highcharts\")\nconst Highstock = require(\"highcharts/highstock\")\nrequire(\"./highcharts-theme\")\n\nconst Gui = require(\"@cosmic-plus/jsutils/gui\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst Tabs = require(\"@cosmic-plus/jsutils/tabs\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst AssetGui = require(\"./asset-gui\")\nconst global = require(\"./global\")\nconst marketData = require(\"./market-data\")\n\n/**\n * Class\n */\n\nclass PortfolioGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section><h2>${__(\"Portfolio\")}: %total %currency</h2>\n  %summary\n  %chart\n\n  <p class=\"note\" align=\"center\">\n    ${__(\"Anchor prices are from Stellar DEX\")} /\n    ${__(\"Global prices are from %%coingecko when available.\")}\n    </p>\n\n</section>`)\n\n    this.portfolio = portfolio\n\n    portfolio.project(\"total\", this, x => nice(x, 2))\n    this.currency = global.currency\n    this.summary = new PortfolioGui.Summary(this)\n    this.coingecko = new Gui(\n      `<a target=\"_blank\" rel=\"noopener\" href=\"https://coingecko.com\">coingecko</a>`\n    )\n  }\n\n  select (asset) {\n    if (this.chart) this.chart.destroy()\n    if (asset && asset.globalPrice && asset.code !== global.currency) {\n      this.chart = new PortfolioGui.Chart(asset)\n    } else {\n      this.chart = null\n    }\n  }\n}\n\nPortfolioGui.Summary = class PortfolioSummary extends Gui {\n  constructor (parent) {\n    const tabs = new Tabs()\n    super(`%nav <section>%view</section>`, tabs)\n\n    tabs.add(\"table\", __(\"Table\"), new PortfolioGui.Table(parent))\n    tabs.add(\"graph\", __(\"Graph\"), () => new PortfolioGui.Graph(parent))\n    tabs.listen(\"select\", id => localStorage[\"PortfolioSummary.tab\"] = id)\n    tabs.select(localStorage[\"PortfolioSummary.tab\"] || \"table\")\n  }\n}\n\nPortfolioGui.Table = class PortfolioTable extends Gui {\n  constructor (parent) {\n    super(`\n<table>\n  <tr>\n    <th>${__(\"Name\")}</th>\n    <th>${__(\"Anchor\")}</th>\n    <th>${__(\"Amount\")}</th>\n    <th>${__(\"Price\")}</th>\n    <th>${__(\"Value\")}</th>\n  </tr>\n  %assetsGui...\n</table>\n`)\n\n    this.parent = parent\n\n    this.assetsGui = parent.portfolio.assets.mirror(asset => {\n      const assetGui = new AssetGui(asset)\n      assetGui.domNode.onclick = () => this.select(assetGui)\n      return assetGui\n    })\n\n    parent.portfolio.trap(\"total\", () => this.sort())\n  }\n\n  sort () {\n    this.assetsGui.sort((a, b) => b.asset.value - a.asset.value)\n  }\n\n  select (assetGui) {\n    if (this.selected) {\n      this.selected.domNode.className = \"\"\n      this.selected.simpleView()\n    }\n\n    if (this.selected === assetGui) {\n      this.parent.select()\n      this.selected = null\n    } else {\n      this.parent.select(assetGui.asset)\n      assetGui.domNode.className = \"selected\"\n      this.selected = assetGui\n      assetGui.detailledView()\n    }\n  }\n}\n\nPortfolioGui.Graph = class PortfolioGraph extends Gui {\n  constructor (parent) {\n    super(`<div -ref=%container align=\"center\"></div>`)\n    this.parent = parent\n\n    this.listen(\"destroy\", () => this.chart && this.chart.destroy())\n    parent.portfolio.trap(\"total\", () => {\n      // For some unknow reason the timeout makes the chart draw better.\n      setTimeout(() => this.makePie(), 1)\n    })\n  }\n\n  makePie () {\n    if (this.chart) this.chart.destroy()\n\n    this.chart = Highcharts.chart(this.container, {\n      title: \"\",\n      legend: { enabled: false },\n      chart: { type: \"pie\" },\n      tooltip: {\n        pointFormat: `\n${__(\"Amount\")}: {point.amount} {point.code}<br>\n${__(\"Price\")}: {point.price} ${global.currency}<br>\n<b>${__(\"Value\")}: {point.y} ${global.currency}</b>\n`\n      },\n\n      plotOptions: {\n        pie: {\n          dataLabels: {\n            format: \"{point.amount} {point.code}<br>({point.percentage:.0f}%)\"\n          },\n          point: {\n            events: {\n              select: x => this.parent.select(x.target.options.asset),\n              legendItemClick: () => false\n            }\n          }\n        }\n      },\n\n      series: [\n        {\n          name: __(\"Amount\"),\n          colorByPoint: true,\n          ignoreHiddenPoint: true,\n          data: this.parent.portfolio.assets\n            .filter(asset => asset.value)\n            .map(makeAssetPoint)\n            .sort((a, b) => b.y - a.y)\n        }\n      ]\n    })\n  }\n}\n\nfunction makeAssetPoint (asset) {\n  return {\n    name: asset.name,\n    code: asset.code,\n    asset: asset,\n    y: +nice(asset.value, 2),\n    amount: nice(asset.amount),\n    price: nice(asset.price),\n    percentage: asset.percentage\n  }\n}\n\nPortfolioGui.Chart = class PortfolioChart extends Gui {\n  constructor (asset) {\n    super(`\n      <section><h3>${asset.code} ${__(\"to\")} ${global.currency}</h3>\n        <div -ref=%container><p>${__(\"Loading...\")}</p></div>\n      </section>\n    `)\n\n    this.asset = asset\n    this.listen(\"destroy\", () => this.chart && this.chart.destroy())\n    marketData.assetHistory(asset).then(data => this.makeChart(data))\n  }\n\n  makeChart (data) {\n    this.chart = Highstock.stockChart(this.container, {\n      rangeSelector: { selected: 2 },\n      chart: {\n        backgroundColor: \"#fbfbfd\"\n      },\n      yAxis: [\n        { labels: { align: \"left\" }, height: \"80%\", resize: { enabled: true } },\n        { labels: { align: \"left\" }, top: \"80%\", height: \"20%\", offset: 0 }\n      ],\n      series: [\n        {\n          type: \"spline\",\n          name: \"Price\",\n          data: data.map(x => [x.time, +nice(x.price)])\n        },\n        {\n          type: \"column\",\n          name: \"Volume\",\n          data: data.map(x => [x.time, x.volume]),\n          yAxis: 1\n        }\n      ],\n      credits: { enabled: false }\n    })\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = PortfolioGui\n","\"use_strict\"\n/**\n * Theme for Highchart\n */\n\nconst Highcharts = require(\"highcharts\")\n\nHighcharts.theme = {\n  chart: { backgroundColor: \"#fbfbfd\" },\n  tooltip: { style: { fontSize: \"14px\" } },\n  credits: { enabled: false },\n\n  plotOptions: {\n    pie: {\n      allowPointSelect: true,\n      animation: false,\n      cursor: \"pointer\",\n      dataLabels: { style: { fontSize: \"14px\" } }\n    }\n  },\n\n  responsive: {\n    rules: [\n      {\n        condition: {\n          maxWidth: 500\n        },\n        chartOptions: {\n          legend: { enabled: true },\n          plotOptions: {\n            pie: {\n              showInLegend: true,\n              dataLabels: {\n                format: \"{point.percentage:.0f}%\",\n                distance: -20\n              }\n            }\n          }\n        }\n      }\n    ]\n  },\n\n  colors: [\n    \"rgba(231,  76,  60, 0.8)\",\n    \"rgba(230, 126,  34, 0.8)\",\n    \"rgba(242, 202,  39, 0.8)\",\n    \"rgba(46,  204, 112, 0.8)\",\n    \"rgba(52,  152, 219, 0.8)\",\n    \"rgba(155,  89, 182, 0.8)\",\n\n    \"rgba(231,  76,  60, 0.6)\",\n    \"rgba(230, 126,  34, 0.6)\",\n    \"rgba(242, 202,  39, 0.6)\",\n    \"rgba(46,  204, 112, 0.6)\",\n    \"rgba(52,  152, 219, 0.6)\",\n    \"rgba(155,  89, 182, 0.6)\",\n\n    \"rgba(231,  76,  60, 0.4)\",\n    \"rgba(230, 126,  34, 0.4)\",\n    \"rgba(242, 202,  39, 0.4)\",\n    \"rgba(46,  204, 112, 0.4)\",\n    \"rgba(52,  152, 219, 0.4)\",\n    \"rgba(155,  89, 182, 0.4)\"\n  ]\n}\n\nHighcharts.setOptions(Highcharts.theme)\n","\"use_strict\"\n/**\n * Asset GUI\n */\nconst Gui = require(\"@cosmic-plus/jsutils/gui\")\nconst html = require(\"@cosmic-plus/jsutils/html\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst msg = require(\"@cosmic-plus/i18n\").__\n\n/**\n * Class\n */\n\nclass AssetGui extends Gui {\n  constructor (asset) {\n    super(`\n<tr %style>\n  <td align=\"left\">\n    <img src=%image alt=\"\">\n    <span>%name</span>\n  </td>\n  <td align=\"left\">\n    <div hidden=%simple>%anchors...</div>\n    <div %class>%anchorTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%amounts...</div>\n    <div %class>%amountTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%prices...</div>\n    <div %class title=%priceDetails>%priceTotal</div>\n  </td>\n  <td align=\"right\">\n    <div hidden=%simple>%values...</div>\n    <div %class>%valueTotal</div>\n  </td>\n</tr>\n    `)\n\n    this.asset = asset\n\n    this.image = asset.image\n    this.name = asset.code\n    this.anchors = asset.balances.mirror(x => cell(x.anchor, \"name\"))\n    this.amounts = asset.balances.mirror(x => cell(x, \"amount\", nice))\n    this.prices = asset.balances.mirror(x => priceCell(x, \"price\", nice))\n    this.values = asset.balances.mirror(x => cell(x, \"value\", x => nice(x, 2)))\n    asset.link(\"amount\", this, \"amountTotal\", nice)\n    asset.link(\"price\", this, \"priceTotal\", nice)\n    asset.link(\"value\", this, \"valueTotal\", x => nice(x, 2))\n    asset.anchors.feed(this, \"anchorHeader\", anchorName)\n\n    this.priceDetails = \"\"\n    const orderbook = this.asset.orderbook\n    if (orderbook) {\n      orderbook.trap(\n        [\"bestAsk\", \"bestBid\", \"spread%\"],\n        () => this.priceDetails = priceDetails(orderbook)\n      )\n    }\n\n    this.simpleView()\n  }\n\n  simpleView () {\n    this.simple = true\n    this.class = \"\"\n    this.anchorTotal = this.anchorHeader\n  }\n\n  detailledView () {\n    this.simple = false\n    this.class = \"footer\"\n    this.anchorTotal = \"Total\"\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = AssetGui\n\n/**\n * Helpers\n */\n\nfunction anchorName (anchors) {\n  if (anchors.length === 1) return anchors[0].name\n  else return `${msg(\"Multiple\")} (${anchors.length})`\n}\n\nfunction cell (object, key, func) {\n  const node = html.create(\"div\", null, object[key])\n  object.link(key, node, \"textContent\", func)\n  return node\n}\n\nfunction priceCell (object, key, func) {\n  const node = cell(object, \"price\", func)\n  object.trap(\"orderbook\", () => {\n    if (object.orderbook)\n      object.orderbook.trap(\n        [\"bestAsk\", \"bestBid\", \"spread%\"],\n        () => node.title = priceDetails(object.orderbook)\n      )\n  })\n  return node\n}\n\nfunction priceDetails (orderbook) {\n  if (orderbook.base.code === \"XLM\") return \"\"\n  return `\nBuy: ${nice(orderbook.bestBid)} \\\n- Sell: ${nice(orderbook.bestAsk)} \\\n- Spread: ${nice(orderbook[\"spread%\"], 2)}%\n  `\n}\n","\"use_strict\"\n/**\n * Settings Graphical User Interface\n */\nconst Gui = require(\"@cosmic-plus/jsutils/gui\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./global\")\n\n/**\n * Class\n */\n\nclass SettingsGui extends Gui {\n  constructor () {\n    super(`\n      <section><h2>${__(\"Settings\")}</h2>\n        <section><h3>${__(\"General Settings\")}</h3>\n          <form>\n            <label><span>${__(\"Language\")}:</span>\n              <select value=%language>\n                <option value=\"us\">English</option>\n                <option value=\"fr\">Français</option>\n              </select>\n            </label>\n            <label><span>${__(\"Currency\")}:</span>\n              <select value=%currency>\n                <option value=\"CNY\">CNY</option>\n                <option value=\"EUR\">EUR</option>\n                <option value=\"USD\">USD</option>\n              </select>\n            </label>\n          </form>\n        </section>\n      </section>\n    `)\n\n    // Two-way binding\n    global.project([\"currency\", \"language\"], this)\n    this.project([\"currency\", \"language\"], global)\n\n    // Refresh interface\n    this.listen(\"change:currency\", () => location.reload())\n    this.listen(\"change:language\", () => location.reload())\n  }\n}\n\n/**\n * Export\n */\n\nmodule.exports = SettingsGui\n","\"use_strict\"\n/**\n * Share Graphical User Interface\n */\nconst Gui = require(\"@cosmic-plus/jsutils/gui\")\nconst i18n = require(\"@cosmic-plus/i18n\")\nconst html = require(\"@cosmic-plus/jsutils/html\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst { __ } = i18n\n\nconst SideFrame = require(\"./side-frame\")\nconst global = require(\"./global\")\nconst Order = require(\"./order\")\nconst Share = require(\"./share\")\n\n/**\n * Class\n */\n\nclass RebalanceGui extends Gui {\n  constructor (portfolio) {\n    super(`\n<section class=\"RebalanceGui\">\n  <h2>${__(\"Rebalance\")}</h2>\n  %table\n  <section hidden=%hideSection>\n    <div class=\"errors\">%formatError:errors...</div>\n    <form onsubmit=%rebalance hidden=%hideRebalance>\n      <button type=\"submit\" disabled=%block>${__(\"Rebalance\")}</button>\n    </form>\n    <form onsubmit=%apply hidden=%hideApply>\n      <button type=\"submit\" disabled=%block>${__(\"Apply\")}</button>\n      <button onclick=%cancel>${__(\"Cancel\")}</button>\n    </form>\n  </section>\n  %setupGui\n</section>\n    `)\n\n    this.portfolio = portfolio\n    const template = localStorage[`target:${portfolio.account.id}`]\n    this.share = Share.forPortfolio(portfolio, template)\n\n    this.table = new RebalanceGui.Table(this)\n    this.table.project(\"selected\", this)\n    this.project(\"selected\", this.table)\n\n    this.errors = this.share.errors\n    this.errors.feed(this, \"block\", errors => !!errors.length)\n\n    this.define(\"hideRebalance\", [\"selected\", \"modified\"], () => {\n      return this.selected || this.modified\n    })\n    this.define(\"hideApply\", [\"selected\", \"modified\"], () => {\n      return this.selected || !this.modified\n    })\n    this.define(\"hideSection\", [\"hideRebalance\", \"hideApply\"], () => {\n      return this.hideRebalance && this.hideApply\n    })\n\n    this.share.project(\"modified\", this)\n\n    this.define(\"setupGui\", \"selected\", () => {\n      if (this.setupGui) this.setupGui.destroy()\n      return this.selected && new ShareGui.Setup(this.selected, this)\n    })\n  }\n\n  formatError (error) {\n    return new Gui(`<div class=\"error\">%error</div>`, { error })\n  }\n\n  cancel () {\n    location.reload()\n    return false\n  }\n\n  apply () {\n    try {\n      const accountId = this.portfolio.account.id\n      localStorage[\n        `target:${accountId}`\n      ] = this.share.template = this.share.toString()\n      this.share.modified = false\n    } catch (error) {\n      console.error(error)\n    }\n    return false\n  }\n\n  rebalance () {\n    try {\n      const operations = listOperations(this.share)\n      const outdated = this.portfolio.offers.filter(offer => offer.outdated)\n      const remaining = outdated.filter(offer => {\n        return !operations.find(op => op.offer.id === offer.id)\n      })\n      operations.forEach(op => {\n        if (!op.offer.id && remaining.length) op.offer.id = remaining.pop().id\n      })\n\n      if (!operations.length) return false\n      const cosmicLink = Order.operationsToCosmicLink(operations)\n      remaining.forEach(offer => {\n        cosmicLink.addOperation(\"manageOffer\", { amount: 0, offerId: offer.id })\n      })\n      if (cosmicLink) new SideFrame(cosmicLink.uri)\n    } catch (error) {\n      console.error(error)\n    }\n    return false\n  }\n}\n\nfunction listOperations (share) {\n  let operations = []\n  share.childs.forEach(child => {\n    if (child.order) operations = operations.concat(child.order.operations)\n  })\n  return operations\n}\n\nRebalanceGui.Table = class RebalanceTable extends Gui {\n  constructor (parent) {\n    super(`\n<section class=\"RebalanceTable\">\n  <table>\n    <tr>\n      <th>${__(\"Name\")}</th>\n      <th>${__(\"Goal\")}</th>\n      <th>${__(\"Divergence\")}</th>\n      <th>${__(\"Operation\")}</th>\n    </tr>\n    %formatShare:shares...\n    <tr hidden=true>\n      <td align=\"center\" colspan=\"4\"><h3>${__(\"Add Asset\")}</h3></td>\n    </tr>\n  </table>\n</section>\n    `)\n\n    this.selected = undefined\n    this.shares = parent.share.childs\n    this.sortShares(this.shares)\n    parent.share.listen(\"update\", () => this.sortShares(this.shares))\n  }\n\n  formatShare (share) {\n    const shareGui = new ShareGui(share)\n    shareGui.domNode.onclick = () => this.selected = share\n    return shareGui\n  }\n\n  sortShares (array) {\n    return array.sort((a, b) => b.goal - a.goal || a.globalPrice)\n  }\n}\n\nclass ShareGui extends Gui {\n  constructor (share) {\n    super(`\n<tr class=\"ShareGui\">\n  <td align=\"left\">\n    <img src=%image alt=\"\">\n    <span>%name</span>\n  </td>\n  <td align=\"right\">%goal%</td>\n  <td align=\"right\">%divergence</td>\n  <td align=\"right\">%description...</td>\n</tr>\n    `)\n\n    this.share = share\n\n    this.image = share.asset.image\n    this.name = share.name || share.asset && share.asset.code\n    share.project(\"goal\", this, x => nice(x, 2))\n    share.project(\"divergence\", this, x => {\n      return x == null ? \"-\" : nice(x * 100, 2) + \"%\"\n    })\n\n    share.trap(\"order\", () => {\n      if (!share.order) {\n        this.cosmicLink = this.description = null\n      } else {\n        share.order.project(\"cosmicLink\", this)\n        share.order.project(\"description\", this, descriptionToList)\n      }\n    })\n  }\n}\n\nShareGui.Setup = class ShareSetup extends Gui {\n  constructor (share, parent) {\n    super(`\n<section>\n  <form onsubmit=%close>\n    <h3>%assetName</h3>\n    <hr>\n    <label><span>${__(\"Size\")}:</span>\n      <input class=\"half\" type=\"number\" step=\"any\" min=\"0\" %max value=%size\n       placeholder=%goal onchange=%switchMode>\n      <select class=\"half\" onchange=%setMode value=%mode>\n        <option value=\"equal\">${__(\"Equal Share\")}</option>\n        <option value=\"percentage\">${__(\"Percentage\")}</option>\n        <option value=\"amount\">${__(\"Amount\")}</option>\n      </select>\n    </label>\n\n    <hr>\n\n    <input type=\"submit\" value=\"${__(\"Close\")}\">\n  </form>\n</section>\n    `)\n\n    this.parent = parent\n    this.share = share\n\n    this.assetName = share.asset.name\n\n    share.project(\"goal\", this, x => nice(x, 2))\n\n    share.project(\"size\", this)\n    this.project(\"size\", share, x => x != null ? Number(x) : null)\n\n    share.project(\"mode\", this, mode => mode || \"equal\")\n    this.project(\"mode\", share)\n  }\n\n  switchMode () {\n    if (this.size && this.mode === \"equal\") this.mode = \"percentage\"\n  }\n\n  setMode () {\n    switch (this.mode) {\n    case \"equal\":\n      this.size = null\n      break\n    case \"percentage\":\n      this.size = +nice(100 * this.share.value / global.portfolio.total, 2)\n      this.max = 100\n      break\n    case \"amount\":\n      this.size = this.share.asset.amount\n      this.max = null\n      break\n    }\n  }\n\n  close () {\n    this.switchMode()\n    this.parent.selected = null\n    return false\n  }\n}\n\n/**\n * Helpers\n */\n\nfunction descriptionToList (description) {\n  return description.map(e => html.create(\"div\", null, e))\n}\n\n/**\n * Export\n */\n\nmodule.exports = RebalanceGui\n","\"use_strict\"\n/**\n * Share class.\n *\n * A (portfolio) Share object represents a statically or dynamically allocated\n * share of the user portfolio. It is a theoric goal that the rebalancing\n * process aims to reach as much as possible.\n *\n * A Share may be composed by several Share subentries, in such a way that the\n * complete portfolio balancing target ends up being a tree made of Shares.\n */\nconst Mirrorable = require(\"@cosmic-plus/jsutils/mirrorable\")\nconst nice = require(\"@cosmic-plus/jsutils/nice\")\nconst Projectable = require(\"@cosmic-plus/jsutils/projectable\")\n\nconst Asset = require(\"./asset\")\nconst Order = require(\"./order\")\nconst strategy = require(\"./strategy\")\n\n/**\n * Share sizing attributes:\n * size, sizeMin, sizeMax, sizeLock\n * amountMin, amountMax, amountLock\n *\n * Strategies: equal, marketCap,... (inertia, change7D, RSI)\n * Filters: change30d, RSI\n */\n\nconst Share = module.exports = class Share extends Projectable {\n  static forPortfolio (portfolio, template) {\n    const share = template ? Share.fromString(template) : new Share()\n    share.portfolio = portfolio\n    share.errors = new Mirrorable()\n    share.goal = 100\n\n    portfolio.share = share\n    portfolio.trap(\"total\", () => share.compute(portfolio.total))\n\n    // Add/Remove assets after trustline change.\n    portfolio.assets.forEach(asset => {\n      if (\n        !share.childs.find(child => asset === child.asset)\n        && asset.isSupported\n      )\n        share.childs.push(new Share(asset))\n    })\n    share.childs.forEach((child, index) => {\n      if (\n        !portfolio.assets.find(asset => asset === child.asset)\n        || !child.asset.isSupported\n      )\n        share.childs.splice(index, 1)\n    })\n    portfolio.assets.listen(\"add\", asset => {\n      if (asset.isValid) share.childs.push(new Share(asset))\n    })\n    portfolio.assets.listen(\"remove\", asset => {\n      const index = share.childs.findIndex(child => child.asset === asset)\n      share.childs.splice(index, 1)\n    })\n\n    return share\n  }\n\n  constructor (asset) {\n    super()\n\n    if (asset) {\n      this.asset = asset\n      this.mode = \"amount\"\n      this.size = asset.amount\n      this.order = Order.rebalance(this)\n      asset.shares.push(this)\n      asset.project(\"value\", this)\n    } else {\n      this.childs = new Mirrorable()\n      this.childs.listen(\"add\", child => {\n        child.parent = this\n        this.compute()\n      })\n    }\n\n    // Normalize & compute\n    this.trap(\"size\", () => {\n      if (this.size) {\n        this.size = Math.max(0, this.size)\n        if (this.mode === \"percentage\") this.size = Math.min(100, this.size)\n      }\n      this.compute()\n    })\n  }\n\n  get root () {\n    if (this.parent) return this.parent.root\n    else return this\n  }\n\n  compute () {\n    console.error(\"compute\")\n    if (this.parent) {\n      this.parent.compute()\n    } else if (this.portfolio && this.portfolio.total) {\n      this.errors.splice(0, this.errors.length)\n      this.modified = this.hasChanged()\n      strategy.apply(this, this.portfolio.total)\n    }\n  }\n\n  hasChanged () {\n    return this.template !== this.toString()\n  }\n\n  static fromString (string) {\n    const template = JSON.parse(string)\n    const share = Share.fromTemplate(template)\n    share.template = string\n    return share\n  }\n\n  static fromTemplate (template) {\n    if (typeof template === \"string\") template = { asset: template }\n\n    const share = template.asset\n      ? new Share(Asset.resolve(template.asset))\n      : new Share()\n\n    share.size = template.size\n    share.mode = template.mode\n\n    if (!template.asset) {\n      share.name = template.group\n      template.childs.forEach(entry =>\n        share.childs.push(Share.fromTemplate(entry))\n      )\n    }\n\n    return share\n  }\n\n  toString (beautify) {\n    const template = this.toTemplate()\n    return JSON.stringify(template, null, beautify && 2)\n  }\n\n  toTemplate () {\n    let template = {}\n\n    if (this.size != null) template.size = this.size\n    if (this.mode != null && this.mode !== \"equal\") template.mode = this.mode\n\n    if (this.asset) {\n      if (this.asset.type === \"unknown\") template.asset = this.asset.id\n      else template.asset = this.asset.code\n      if (Object.keys(template).length === 1) template = template.asset\n    } else if (this.childs) {\n      if (this.name) template.group = this.name\n      template.childs = this.childs.map(share => share.toTemplate())\n    }\n\n    return template\n  }\n}\n\nShare.define(\"delta\", [\"value\", \"target\"], function () {\n  return +nice(this.value - this.target, 7)\n})\nShare.define(\"divergence\", [\"delta\", \"target\"], function () {\n  return this.target ? this.delta / this.target : null\n})\n\n/*\n[\n  {\n    \"group\": \"Fiats\"\n    \"size\": \"50\",\n    \"childs\": [\n      { \"asset\": \"USD\", \"size\": \"30\", \"min\": { \"amount\": \"2000\" }},\n      { \"asset\": \"EUR\", \"size\": \"20\", \"min\": { \"amount\": \"500\" }},\n      { \"asset\": \"CNY\", \"size\": \"20\" },\n      { \"asset\": \"GBP\", \"size\": \"20\" }\n  },\n  {\n    //\"group\": \"Native\"\n    \"size\": \"25\",\n    \"strategy\": \"marketCap\",\n    \"childs\": [\"XLM\", \"SLT\", \"MOBI\"]\n  },\n  {\n    //\"group\": \"Tether\",\n    \"size\": \"25\",\n    \"strategy\": [[\"marketCap\", 25], [\"equal\", 25], [\"change7D\", 25], [\"inertia\", 25]],\n    \"childs\": [{ \"asset\": \"BTC\", \"min\": { \"amount\": \"0.05\", \"size\": \"20\" }}, \"ETH\", [10, \"byMarketCap\"]]\n  }\n]\n\n[\n  {\n    \"group\": \"Fiat\",\n    \"size\": 50,\n    \"strategy\": \"equal\",\n    \"childs\": [\"USD\", \"EUR\", \"GBP\", \"CNY\"]\n  },\n  {\n    \"group\": \"Native\",\n    \"size\": 20,\n    \"strategy\": [[\"marketCap\", 25], [\"equal\", 25], [\"inertia\", 50]]\n  }\n  { \"asset\": \"BTC\", \"size\": 10 },\n  { \"asset\": \"ETH\", \"size\": 5 },\n  { \"asset\": \"XRP\", \"size\": 3 }\n]\n\n*/\n","\"use_strict\"\n/**\n * Rebalancing strategies\n */\nconst strategy = exports\n\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nstrategy.apply = function (share, total) {\n  if (!share.childs) return share.target = total\n\n  let used = 0\n  const computed = []\n  const remaining = []\n  const strat = share.mode || \"equal\"\n\n  share.childs.forEach(child => {\n    if (child.mode === \"skip\" || child.mode === \"amount\") {\n      child.target =\n        child.size != null\n          ? child.asset.price * child.size\n          : child.asset.price * child.asset.amount\n      child.goal = 100 * child.target / total\n      if (child.goal > 100) {\n        child.root.errors.push(\n          `${child.asset.code}: ${__(\"Order over portfolio total\")}`\n        )\n      }\n      used += child.goal\n    } else if (child.size != null) {\n      child.goal = child.size\n      used += child.size\n      computed.push(child)\n    } else {\n      remaining.push(child)\n    }\n  })\n\n  if (total < 0) throw new Error(\"Rebalancing impossible\")\n\n  if (used > 100 || used !== 100 && !remaining.length) {\n    makeTotal100(computed, used)\n    remaining.forEach(share => share.goal = 0)\n  } else if (remaining.length) {\n    method[strat](remaining, 100 - used)\n  }\n\n  computed.concat(remaining).forEach(child => {\n    strategy.apply(child, total * child.goal / 100)\n  })\n}\n\nfunction makeTotal100 (targets, used) {\n  const space = 100 - used\n  targets.forEach(target => target.goal += space * target.goal / used)\n}\n\n/*******************************************************************************\n * Strategies\n */\n\nconst method = {}\n\nmethod.equal = function (shares, space) {\n  const goal = space / shares.length\n  shares.forEach(share => share.goal = goal)\n}\n","module.exports = \"<section><h2>License</h2>\\n  <section><h3>MIT License</h3>\\n\\n    <p>Copyright (c) 2019 Antoine Bodin &lt;<a\\n    href=\\\"mailto:mister.ticot@cosmic.plus\\\">mister.ticot@cosmic.plus</a>&gt;</p>\\n\\n    <p>Permission is hereby granted, free of charge, to any person obtaining a\\n    copy of this software and associated documentation files (the \\\"Software\\\"),\\n    to deal in the Software without restriction, including without limitation\\n    the rights to use, copy, modify, merge, publish, distribute, sublicense,\\n    and/or sell copies of the Software, and to permit persons to whom the\\n    Software is furnished to do so, subject to the following conditions:</p>\\n\\n    <p>The above copyright notice and this permission notice shall be included\\n    in all copies or substantial portions of the Software.</p>\\n\\n    <p>THE SOFTWARE IS PROVIDED \\\"AS IS\\\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\\n    OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\\n    IN THE SOFTWARE.</p>\\n  </section>\\n</section>\\n\"","module.exports = \"<section><h2>February, 16th − Beta 1 Release</h2>\\n  <section><h3>Welcome!</h3>\\n\\n    <p>Equilibre.io is a portfolio balancer that runs on the Stellar\\n    Decentralized Exchange. It is a convenient trading tool to manage positions\\n    over the long term.</p>\\n\\n    <p>Regularly balancing an investment portfolio is known to boost its\\n    performances, providing you choose wisely the assets to bet on. Equilibre.io\\n    also let you spread your position over several anchors, for a better fund\\n    safety.</p>\\n\\n    <p>Equilibre.io is still under testing & development. If you use it now,\\n    I'll ask you to consider yourself as a tester. Please report any bug you\\n    could encounter, and double-check transactions before signing them.</p>\\n\\n    <p>Your feedback matters to me and will be listened to.</p>\\n\\n    <p>Respectfully, <br>MisterTicot</p>\\n\\n  </section>\\n\\n  <section><h3>To Be Implemented</h3>\\n    <ul>\\n      <li>Interface to add/remove assets</li>\\n      <li>Portfolio historic value</li>\\n      <li>Customizable rebalancing periodicity</li>\\n      <li>Better position spreading over anchors</li>\\n      <li>Pie graph for rebalancing tab</li>\\n    </ul>\\n  </section>\\n\\n  <section><h3>Known Limitations</h3>\\n    <ul>\\n\\n      <li>It is required to \\\"Cancel All\\\" offers between applying a new balance\\n      setup</li>\\n\\n      <li>There may be a delay between validating a rebalancing operation &\\n      having the interface reflecting it.</li>\\n\\n    </ul>\\n  </section>\\n</section>\\n\"","\"use_strict\"\n/**\n * Footer\n */\nconst { CosmicLink } = require(\"cosmic-lib\")\n\nconst Gui = require(\"@cosmic-plus/jsutils/gui\")\nconst html = require(\"@cosmic-plus/jsutils/html\")\nconst { __ } = require(\"@cosmic-plus/i18n\")\n\nconst global = require(\"./global\")\nconst SideFrame = require(\"./side-frame\")\n\nconst MYPUBKEY = \"GAWO2C52D57XBT7SQL6YB3XPHFLFD2J4Z5RN7HPFZSHXJMXH72HRXNV3\"\n\n/**\n * Class\n */\n\nclass Footer extends Gui {\n  constructor (icons, links) {\n    super(\n      `\n<footer id=\"footer\" class=\"scrollable\">\n  <div class=\"nobreak\">%icons...</div>\n  %links\n</footer>\n    `,\n      { icons, links }\n    )\n  }\n}\n\n/**\n * Footer Icons\n */\n\nclass Icon extends Gui {\n  constructor (image, name, action) {\n    super(`<a -ref=%link class=\"Icon\">%image</a>`)\n\n    this.image = typeof image === \"string\" ? new Gui(image) : image\n    this.link.title = name\n\n    if (typeof action === \"function\") {\n      this.link.onclick = action\n    } else if (typeof action === \"string\") {\n      this.link.href = action\n      if (action.match(/^http/)) {\n        this.link.target = \"_blank\"\n        this.link.rel = \"noopener\"\n      }\n    }\n  }\n}\n\n/**\n * Donate\n */\n\nfunction donate () {\n  const amount = prompt(`\\\n${__(\"Equilibre.io runs on donation.\")}\n\n${__(\n    \"Please contribute to its development according to what you think the service worth.\"\n  )}\n\n${__(\"Enter an amount (in Lumens)\")}:\\\n`)\n\n  if (amount === \"0\" || isNaN(+amount)) {\n    confirm(`${__(\"Not a valid amount\")}: ${amount}`)\n  } else if (amount) {\n    const cosmicLink = new CosmicLink({\n      memo: __(\"Donation to Equilibre.io\"),\n      network: \"public\"\n    }).addOperation(\"payment\", { amount, destination: MYPUBKEY })\n    new SideFrame(cosmicLink.uri)\n  }\n}\n\n/**\n * Icons\n *\n * SVG from @fortawesome/font-awesome-free\n * CC BY 4.0 License (https://creativecommons.org/licenses/by/4.0/)\n */\n\nconst icons = [\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/keybase.svg\"),\n    \"Keybase\",\n    \"https://keybase.io/team/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/telegram-plane.svg\"),\n    \"Telegram\",\n    \"https://t.me/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/reddit.svg\"),\n    \"Reddit\",\n    \"https://reddit.com/r/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/twitter.svg\"),\n    \"Twitter\",\n    \"https://twitter.com/cosmic_plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/medium.svg\"),\n    \"Medium\",\n    \"https://medium.com/cosmic-plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/brands/github.svg\"),\n    \"GitHub\",\n    \"https://github.com/cosmic-plus/webapp-equilibre-io\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/solid/globe.svg\"),\n    __(\"Website\"),\n    \"https://cosmic.plus\"\n  ),\n  new Icon(\n    require(\"@fortawesome/fontawesome-free/svgs/solid/envelope.svg\"),\n    __(\"Email\"),\n    \"mailto:mister.ticot@cosmic.plus\"\n  ),\n  new Icon(require(\"./svg/donate.svg\"), __(\"Donate\"), donate)\n]\n\n/**\n * Demo Page\n */\nfunction displayDemo () {\n  localStorage[`target:${MYPUBKEY}`] = demoConfig\n  location.href = `?address=${MYPUBKEY}`\n}\n\nconst demoConfig = `{\"childs\":[\"EUR\",\"CNY\",\"USD\",{\"size\":12.5,\"mode\":\"percentage\",\"asset\":\"XLM\"},{\"size\":12.5,\"mode\":\"percentage\",\"asset\":\"ETH\"},{\"size\":12.5,\"mode\":\"percentage\",\"asset\":\"BTC\"},{\"size\":4,\"mode\":\"percentage\",\"asset\":\"SLT\"},{\"size\":4,\"mode\":\"percentage\",\"asset\":\"REPO\"},{\"size\":2.25,\"mode\":\"percentage\",\"asset\":\"PEDI\"},{\"size\":2.25,\"mode\":\"percentage\",\"asset\":\"TERN\"}]}`\n\n/**\n * Links\n */\nconst links = new Gui(\n  `\n<p>\n  <a target=\"_blank\" rel=\"noopener\" href=\"https://cosmic.plus\">${__(\n    \"A Cosmic.Plus Software\"\n  )}</a>\n  − <a onclick=%displayDemo>${__(\"Demo\")}</a>\n  − <a target=\"_blank\" rel=\"noopener\" href=\"https://nucleo.fi/leaderboard/top/?span=3m\">Performance</a>\n  − <a onclick=%displayLicense>${__(\"License\")}</a>\n  − <a onclick=%displayAbout>${__(\"About\")}</a>\n</p>\n`,\n  {\n    displayDemo,\n    displayLicense: () => global.tabs.select(\"#license\"),\n    displayAbout: () => global.tabs.select(\"#about\")\n  }\n)\n\n/**\n * Create footer\n */\n\nconst footer = new Footer(icons, links)\nhtml.append(document.body, footer)\n","module.exports = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 512 512\\\"><path fill=\\\"none\\\" d=\\\"M0 0h512v512H0z\\\"/><path d=\\\"M211.719 367.797C219.469 379.281 224 393.109 224 408c0 39.734-32.266 72-72 72-39.758 0-72-32.266-72-72 0-23.172 11.148-43.563 28.164-56.734 1.852 5.594 4.336 11.125 8.289 15.906 7.055 8.516 20.336 18.266 43.531 16.344 7.578-.641 15.844-2.547 24.586-5.641 8.875-3.078 18.508-6.5 27.149-10.078zM389.875 32.578c-13.344 3.797-24.156 10.672-38.813 18.328-90 47-196.25 39.25-220 77-27.469 51.672-48.883 89.203-48.945 107.625-.016.063-.055.094-.07.141.586 19.953 19.625 58.438 29.07 75.969 6.789-15.516 17.492-29.219 32.25-40.688 7.414-5.766 13.289-9.922 18.617-13.5-3.016-9.25-6.945-20.016-10.875-28.203 10.742-7.391 26.078-26.484 31.398-40.313 13.227.094 30.25-3.172 44.773-6.938 6.406 6.844 12.977 13.563 21.766 20.016-3.961 14.344-7.07 27.063-23.438 38.359-22.313 15.438-42.734 21.578-69.484 43.109-16.086 12.953-26.07 28.203-30.625 45.641-3.148 12.094 4.734 53.016 58 33.141 10.023-3.75 23.398-8.531 34.875-14.25 23.797-11.813 52.922-40.781 61-44.828 15.234-7.641 49.813-10.656 86.313-35.016 12.531-8.375 22.063-20.688 26.477-33.625 33.242-64.828 60.883-59.656 68.633-72.563C477.734 133.734 423.563 23 389.875 32.578z\\\"/></svg>\\n\""],"sourceRoot":""}